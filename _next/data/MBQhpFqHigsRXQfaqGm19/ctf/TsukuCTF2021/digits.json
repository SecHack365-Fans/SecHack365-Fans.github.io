{"pageProps":{"postData":{"id":"digits","contentHtml":"# digits\n\n> コンピュータは高速に正しく計算してくれますが、昔のコンピュータは今ほど正確に計算できないことがありました。現在もハードウェアの故障などが原因でとても低い確率でコンピュータは計算をミスするでしょう。\n> 運が良いあなたならこの問題が解けるはずです。10 桁の好きな数字をクエリパラメータ `q` に入れて、神に祈りましょう。\n> `https://tsukuctf.sechack365.com/problems/digits`\n> ※この問題では`/problems/digits`以下のみを用います。\n> 他の問題`/problems/<name>`などと混同しないよう注意してください。\n\nプログラムはこれです．\n\n```py\nfrom typing import Optional\nfrom fastapi import FastAPI\nimport random\n\napp = FastAPI()\n\nFLAG = \"TsukuCTF{}\"\n\n\n@app.get(\"/program/digits/\")\ndef main(q: Optional[str] = None):\n    if q == None:\n        return {\n            \"msg\": \"please input param 'q' (0000000000~9999999999).  example: /?q=1234567890\"\n        }\n    if len(q) != 10:\n        return {\"msg\": \"invalid query\"}\n    if \"-\" in q or \"+\" in q:\n        return {\"msg\": \"invalid query\"}\n    try:\n        if not type(int(q)) is int:\n            return {\"msg\": \"invalid query\"}\n    except:\n        return {\"msg\": \"invalid query\"}\n\n    you_are_lucky = 0\n\n    for _ in range(100):\n        idx = random.randrange(4)\n        if q[idx] < \"0\":\n            you_are_lucky += 1\n        if q[idx] > \"9\":\n            you_are_lucky += 1\n\n    if you_are_lucky > 0:\n        return {\"flag\": FLAG}\n    else:\n        return {\"msg\": \"Sorry... You're unlucky.\"}\n```\n\nちなみに FastAPI が使われているのは僕の好みです．\n入力`q`のチェックを一つずつ確認しましょう．\n\n### 1. `q`は`None`であってはならない\n\n何か入れましょう．\n\n### 2. `q`は文字列型である\n\n`def main(q: Optional[str] = None):` と書かれています．\n\n### 3. `q`の長さは 10 であ\n\n`len(q) != 10:` と書かれています．\n\n### 4. `q`に`+`や`-`が含まれない\n\n書いてある通りです．\n\n### 5. `q`のある文字が 0 未満または 9 以上になることがある\n\nつまり，0~9 以外の文字を 1 つでもこの時点で入って入れば良いです．\n\n### まとめ\n\n結論から言うと，`+100000000`や`+++1111111`や`+294287356`など，`+`が 1 つ以上かつその後ろに数字が 1 つ以上入っていれば何でも大丈夫です．\\\nURL には`+`という文字を入れることができます．これはデリミタの一種で，半角スペースの扱いになります．\\\n正解の文字列は長さが 10 で`-`が含まれておらず，`+`は半角スペースに変換されるので`+`も入っておらず，`int`関数で変換可能であり，ある文字が 0 未満または 9 以上になることがあります．\n\n### お詫び\n\nこの問題多くのミスがありすみませんでした．\\\nまず最初はファイルを与えておらず，ブラックボックスになっていました．\\\nまた，最初は`@app.get(\"/program/digits/\")`が`@app.get(\"/program/digits\")`となっていて，`/program/digits/?q=12345678090`とアクセスすると localhost へリダイレクトされるバグがありました．\n\n```txt\nTsukuCTF{you_are_lucky_Tsukushi}\n```\n","title":"digits","description":"Pythonのint関数の型変換をバイパス","author":"ryusei_ishika","genre":"Web","solver":63,"point":100}},"__N_SSG":true}