{"pageProps":{"postData":{"id":"gyOTAKU","contentHtml":"# gyOTAKU\n\nã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªé­šæ‹“ã‚’ã¨ã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãªã‚ˆã†ã ã€‚\\\nğŸŸgyOTAKUğŸŸ\n\n![images/image1.png](./images/image1.png)\n\né­šæ‹“ã‚’ã¨ã‚‹ã¨ç”»åƒãŒé™ã£ã¦ãã‚‹ã€‚\\\n`https://tsukuctf.sechack365.com/problems/gyotaku?url=http://example.com/`\n\n![images/image2.png](./images/image2.png)\\\nã‚½ãƒ¼ã‚¹ã‚’è¦‹ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã§ã‚ã£ãŸã€‚\n\n```python\n~~~\ndef sanitize(text):\n    #RCE is a non-assumed solution. <- This is not a hint.\n    url = \"\"\n    for i in text:\n        if i in string.digits + string.ascii_lowercase + string.ascii_uppercase + \"./_:\":\n            url += i\n    if (url[0:7]!=\"http://\") and (url[0:8]!=\"https://\"):\n        url = \"https://www.google.com\"\n    return url\n~~~\n@app.route(\"/\")\ndef gyotaku():\n    filename = \"\".join([random.choice(string.digits + string.ascii_lowercase + string.ascii_uppercase) for i in range(15)])\n    url = request.args.get(\"url\")\n    if not url:\n        return \"<font size=6>ğŸŸgyOTAKUğŸŸ</font><br><br>You can get gyotaku: <strong>?url={URL}</strong><br>Sorry, we do not yet support other files in the acquired site.\"\n    url = sanitize(url)\n    html = open(f\"{filename}.html\", \"w\")\n    try:\n        html.write(requests.get(url, timeout=1).text + \"<br><font size=7>gyotakued by gyOTAKU</font>\")\n    except:\n        html.write(\"Requests error<br><font size=7>gyotakued by gyOTAKU</font>\")\n    html.close()\n    cmd = f\"chromium-browser --no-sandbox --headless --disable-gpu --screenshot='./gyotaku-{filename}.png' --window-size=1280,1080 '{filename}.html'\"\n    subprocess.run(cmd, shell=True, timeout=1)\n~~~\n```\n\nã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§æ¸¡ã•ã‚ŒãŸã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ get ã—ã€html ã«ä¿å­˜ã—ãŸå¾Œã« chromium-browser ã§ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®ã£ã¦ã„ã‚‹ã‚ˆã†ã ã€‚\\\nã‚¢ãƒ‰ãƒ¬ã‚¹ã¯`http://`ã‹`https://`ã§å§‹ã¾ã‚‹ã‚ˆã†ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã•ã‚Œã¦ã„ã‚‹ã€‚\\\nãƒ•ã‚¡ã‚¤ãƒ«åã‚‚ãƒ©ãƒ³ãƒ€ãƒ ãªã®ã§ OS ã‚³ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚‚é›£ã—ãã†ã ã€‚\\\nã“ã“ã§`alert(1)`ã‚’å‡ºã™ã‚ˆã†ãªã‚µã‚¤ãƒˆã‚’èª­ã¿è¾¼ã‚€ã¨ Internal Server Error ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã«æ°—ã¥ãã€‚\\\nJavaScript ãŒå‹•ãã‚ˆã†ã ã€‚\\\nã“ã“ã§ã€æ¬¡ã®ã‚ˆã†ãª html ã‚’è€ƒãˆã‚‹ã€‚\n\n```html\n<script>\n  location.href = \"/etc/passwd\";\n</script>\n```\n\nã“ã‚ŒãŒ`http://tsukuctf.example.com/index.html`ã¨ã—ã¦é…ç½®ã•ã‚Œã¦ã„ãŸå ´åˆã€`http://tsukuctf.example.com/etc/passwd`ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ã€‚\\\nã—ã‹ã—ã€html ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å ´åˆã€`/etc/passwd`ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚\\\nã“ã® html ã‚’å¤–éƒ¨ã®ã‚µãƒ¼ãƒã«é…ç½®ã—é­šæ‹“ã‚’ã¨ã‚‹ã¨ã€æœ¬ã‚¢ãƒ—ãƒªã«ã‚ˆã£ã¦ html ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã•ã‚Œã€chromium-browser ãŒå•é¡Œã‚µãƒ¼ãƒå†…ã®`/etc/passwd`ã‚’è¡¨ç¤ºã™ã‚‹ã€‚\\\nã“ã‚Œã§å•é¡Œã‚µãƒ¼ãƒå†…ã®ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿å‡ºã›ã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚\\\nå•é¡Œæ–‡ã‚ˆã‚Š root ã§å‹•ã„ã¦ã„ã‚‹ã¨ã®ã“ã¨ãªã®ã§ã€`/root`ä»¥ä¸‹ã‚’æœç´¢ã™ã‚‹ã€‚\\\n`/root/.bash_history`ã‚’èª­ã¿å–ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã§ã‚ã£ãŸã€‚\\\n![images/image3.png](./images/image3.png)\\\nä½•ã‹ãŒ`/root/flagc464f9eba1.txt`ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹ã‚ˆã†ã ã€‚\\\n![images/image4.png](./images/image4.png)\\\nãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã¨ flag ãŒæ›¸ã‹ã‚Œã¦ã„ãŸã€‚\n\n## TsukuCTF{Tsukushi\\_to\\_Sugina\\_no\\_chigai\\_ga\\_wakaran}\n","title":"gyOTAKU","description":"é­šæ‹“ã‚’ã¨ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ä»»æ„ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿","author":"satoki00","genre":"Web","solver":4,"point":496}},"__N_SSG":true}